Predictive mapping with small field sample data 
using semi-supervised machine learning

Fei Du1 ‚ÄÉ|   A-Xing Zhu1,2,3,4‚ÄÉ|   Jing Liu5‚ÄÉ|   Lin Yang6

Abstract

Existing predictive mapping methods usually require a large 

number  of  field  samples  with  good  representativeness  as 

input  to  build  reliable  predictive  models.  In  mapping  prac-

tice,  however,  we  often  face  situations  when  only  small 

sample data are available. In this article, we present a semi-

supervised machine learning approach for predictive map-

ping  in  which  the  natural  aggregation  (clustering)  patterns 

of environmental covariate data are used to supplement lim-

ited samples in prediction. This approach was applied to two 

soil mapping case studies. Compared with field sample only 

approaches (decision trees, logistic regression, and support 

vector  machines),  maps  using  the  proposed  approach  can 

better capture the spatial variation of soil types and achieve 

higher  accuracy  with  limited  samples.  A  cross  validation 

shows further that the proposed approach is less sensitive 

to the specific field sample set used and thus more robust 

when field sample data are small.

DOI: 10.1111/tgis.12598  

R E S E A R C H   A R T I C L E

1Department of Geography, University of 
Wisconsin-Madison, Madison, WI, USA

2School of Geographical Science, Nanjing 
Normal University, Nanjing, China

3Jiangsu Center for Collaborative 
Innovation in Geographical Information 
Resource Development and Application, 
Nanjing, China

4State Key Laboratory of Resources and 
Environmental Information System, Institute 
of Geographical Sciences and Natural 
Resources Research, Chinese Academy of 
Sciences, Beijing, China

5Santa Monica College, Santa Monica, CA, 
USA

6School of Geographic and Oceanographic 
Sciences, Nanjing University, Nanjing, China

Correspondence
A-Xing Zhu, Department of Geography, 
University of Wisconsin-Madison,  
550 North Park Street, Madison,  
WI 53706, USA.
Email: azhu@wisc.edu

Funding information
PAPD; Outstanding Innovation Team 
in Colleges and Universities in Jiangsu 
Province; National Natural Science 
Foundation of China, Grant/Award Number: 
41431177 and 41871300; National Basic 
Research Program of China, Grant/Award 
Number: 2015CB954102

1‚ÄÉ| ‚ÄÉI NTRO D U C TI O N

Predictive methods are often used to map spatial categorical variables (e.g., soil types, suitable/unsuitable habitat 

areas for certain species) that cannot be observed directly by remote sensing techniques. A number of predictive 

methods are available for this purpose. They can be classified into three categories. The first category consists of 

methods that make predictions based on spatial relations; such methods are referred to as spatial relation-based 

Transactions in GIS. 2019;00:1‚Äì17. 

wileyonlinelibrary.com/journal/tgis 

 ‚ÄÉ|‚ÄÉ 1

¬© 2019 John Wiley & Sons Ltd2‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

methods in this article. For example, indicator kriging (Journel, 1983; Kerry & Oliver, 2007) uses spatial autocor-

relation to make predictions. The Markov chain geostatistical method (Li, 2007; Li & Zhang, 2007) leverages a 

spatial transition model to make predictions. The second category is based on feature relations. Methods in this 

category  use  environmental  variables  (e.g.,  topographic  variables,  climate  variables)  that  co-vary  with  a  target 

variable  (e.g.,  soil  spatial  distribution)  to  predict  the  target  variable.  Such  environmental  variables  are  referred 

to as environmental covariates. These methods make use of relations between environmental covariates and a 

target variable to make predictions and are thus called feature relation-based methods. Examples include logis-

tic regression (Debella-Gilo & Etzelm√ºller, 2009; Kempen, Brus, Heuvelink, & Stoorvogel, 2009), artificial neural 

networks (Pearson, Dawson, Berry, & Harrison, 2002; Zhu, 2000), decision trees (Cialella, Dubayah, Lawrence, 

& Levine, 1997; Lees & Ritman, 1991; Qi & Zhu, 2003; Scull, Franklin, & Chadwick, 2005), support vector ma-

chines (SVMs) (Kovaƒçeviƒá, Bajat, & Gajiƒá, 2010; Yao, Tham, & Dai, 2008), and the fuzzy logic-based approach (Zhu, 

Hudson, Burt, Lubich, & Simonson, 2001). The third category is a hybrid of the previous two, using both spatial 

and feature relations for prediction, such as co-kriging (Goovaerts, 1997) and Bayesian maximum entropy (Allard, 

D'Or,  &  Froidevaux,  2011;  Bogaert,  2002;  Brus,  Bogaert,  &  Heuvelink,  2008).  Though  different  methods  have 

different assumptions and principles, most of them, however, require a large number of field samples with well- 

designed sampling schema as input so that the samples have good spatial/attribute representativeness for build-

ing reliable predictive models. This is especially the case for deep learning models (LeCun, Bengio, & Hinton, 2015; 

Schmidhuber, 2015), which have gained enormous popularity recently and achieved great success in various fields.

As geographic sampling is usually costly and sometimes even difficult, it is often hard to obtain large sample 

sets with good representativeness. In mapping practice, we may face situations where only a small amount of field 

samples that have limited spatial/attribute coverage are available (Stockwell & Peterson, 2002; Wisz et al., 2008; 

Zhu et al., 2008; Zhu, Lu, Liu, Qin, & Zhou, 2018).

With limited samples, spatial relation-based methods may be inapplicable. It might be impossible to construct a 

stable spatial model (e.g., semi-variogram, spatial transition model) and/or there are not enough neighborhood field 

samples for spatial interpolation (Oliver & Webster, 2014). Though the feature relation-based methods (e.g., decision 

tree, logistic regression) can be used, they might generate low-quality prediction if the field samples do not have good 

representativeness (Zhu et al., 2015, 2018). Figure 1 illustrates this problem. There are two classes to be predicted, 

based on environmental covariate data. With sparse field samples (squares and triangles) that cannot cover the en-

vironmental niches of the two classes well, it is very difficult to determine where the boundary of the two classes is 

F I G U R E   1 ‚ÄÉThe problem of prediction with small field sample data: it is difficult to determine accurate class 
boundaries

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ3

in the environmental covariate space. Any line in Figure 1 could be the boundary between the two classes. This large 

uncertainty makes the prediction unreliable (i.e., there may be a lot of misclassifications).

In contrast to limited field samples that are very likely to suffer this representativeness issue, environmental 

covariate data (variables that co-vary with a target variable) are usually abundant and stable. Existing feature re-

lation-based predictive methods often use only environmental covariate values at field sample locations to build 

the predictive models, as shown in Figure 1. A lot of useful information in environmental covariate data is not fully 

utilized. In fact, the natural aggregation (e.g., clustering) patterns of environmental covariate data often indicate 

the niches of different classes (Burrough, Wilson, van Gaans, & Hansen, 2001; De Bruin & Stein, 1998; Yang, Zhu, 

Qi, Qin, Li, & Pei, 2013; Young & Hammer, 2000; Zhu et al., 2008). If these patterns can be properly used, they may 

greatly lower the uncertainty of the decision boundaries rather than using limited field samples alone. Figure 2 

shows that after the natural aggregations of environmental covariate data are introduced to supplement the lim-

ited field samples, a classification result with more reliable decision boundaries can be derived.

This article explores the use of the natural aggregation patterns of environmental covariate data to supple-

ment  limited  field  samples  for  mapping  spatial  categorical  variables  through  semi-supervised  machine  learning 

(Chapelle, Sch√∂lkopf, & Zien, 2006; Zhu & Goldberg, 2009). Different from supervised learning and unsupervised 

learning, semi-supervised machine learning is a new machine learning paradigm that sits in between. It makes use 

of unlabeled data together with a small amount of labeled data in the learning process. The next section presents 

the  basic  idea  and  the  detailed  steps  of  the  approach.  Two  case  studies  in  soil  type  mapping  are  described  in 

Section 3. The first case study is used as an example to illustrate how the proposed approach works. The second 

one is more elaborate and is used to evaluate the stability of the proposed method. The sensitivity of parameter 

setting, limitations, and applicability of the proposed approach are discussed at the end.

2‚ÄÉ| ‚ÄÉM E TH O D O LO G Y

2.1‚ÄÉ|‚ÄÉBasic idea

As a machine learning paradigm, semi-supervised learning can be performed in multiple ways, such as self-training, 

co-training, expectation maximization (EM) with generative mixture models and graph-based models, and so on 

(Zhu  &  Goldberg,  2009).  In  this  research,  graph-based  models  are  chosen  for  predictive  mapping  because  of 

their characteristics. Graph-based models are nonparametric and do not assume the shape of the clusters. This 

F I G U R E   2 ‚ÄÉPrediction with the help of covariate data: natural aggregation patterns in covariate data can 
supplement limited field sample to determine more reliable class boundaries

DU et al.4‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

characteristic  makes  them  suitable  to  capture  the  complexity  of  geographic  phenomena,  which  usually  do  not 

follow  well-defined  distributions (e.g., Gaussian distribution). The basic  intuition of  graph-based models is that 

points with similar features tend to be in the same class. During the similarity calculation process, domain/expert/

geographic knowledge can easily be incorporated (e.g., how to decide the similarity between two spatial locations).

The basic idea of using graph-based semi-supervised learning in predictive mapping is shown in Figure 3. A 

similarity graph is defined where nodes are labeled and unlabeled examples (field samples and unlabeled spatial 

locations),  and  edges  reflect  the  similarity  of  examples.  The  natural  aggregations  (groups  of  nodes  with  dense 

connections) are detected in the similarity graph and the label of a natural aggregation can be obtained from the 

labeled examples falling inside it.

The quantification of similarities is important for the success of this prediction process. In order to consider 

both global geographic context and local environmental information, we first use a partitional clustering algorithm 

to  divide  the  locations  of  a  study  area  into  different  major  clusters.  With  the  clustering  results,  the  similarity 

between two locations is set to zero if they are in different clusters, otherwise the similarity is calculated based 

on the environmental covariate values of the two locations. The partitional clustering encodes the global context 

(e.g., major landform partitions in an area) into the similarity quantification, while the comparison of the environ-

mental covariate values of two locations encodes local information into the similarity quantification. If the similar-

ity calculation is purely based on pairwise comparison, we may lose the larger geographic context.

With the quantified similarities, we adopt the label propagation method to detect natural aggregations of 

data  and  assign  labels  to  unlabeled  spatial  locations.  Label  propagation  (Szummer  &  Jaakkola,  2002;  Zhu  & 

Ghahramani, 2002; Zhu, Ghahramani, & Lafferty, 2003; Zhou, Bousquet, Lal, Weston, & Sch√∂lkopf, 2004) con-

ducts a merging process under a probabilistic framework. It iteratively propagates class labels from limited field 

sample locations (used as seeds) to unlabeled locations using a similarity-based transition matrix until conver-

gence (boundaries of natural aggregations are reached). After convergence, each location gets a class label and 

the predictive mapping is achieved.

2.2‚ÄÉ|‚ÄÉProcedure

Following the basic idea, the flow chart of the proposed approach is shown in Figure 4.

Outliers of the environmental covariate data need to be removed and each environmental covariate is stan-

dardized so that its range is 1. After the pre-processing, there are two major steps.

2.2.1‚ÄÉ|‚ÄÉCalculation of similarities

A partitional cluster algorithm is first used to detect major clusters (major natural aggregation) in environmental 

covariates. As a widely adopted clustering algorithm, k-means clustering is used in this research. Given n locations 

where location i (i = 1, 2, ‚Ä¶, n) is characterized by an environmental covariate vector (ei1, ei2, ‚Ä¶, eim) (where m is 

F I G U R E   3 ‚ÄÉUsing graph-based semi-supervised machine learning in predictive mapping

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ5

(1)

(2)

(3)

F I G U R E   4 ‚ÄÉFlow chart of the proposed approach

the number of environmental covariates), k-means clustering aims to partition the n locations into k clusters (k ‚â§ n) 

S = {S1, S2, ‚Ä¶, Sk} so as to minimize the within-cluster sum of squares:

where k is the number of clusters, Œºi is the centroid of cluster Si, and xj is a location that belongs to cluster Si.

As an intuitive choice, the number of clusters can be set the same as the class labels appearing in the field 

sample set. Some cluster evaluation indices, such as the Cali≈Ñski-Harabasz criterion (Cali≈Ñski & Harabasz, 1974) 

and gap statistics (Tibshirani, Walther, & Hastie, 2001), can also help to determine a proper number of clusters. 

The  initialization  of  cluster  centroids  is  important  for  the  k-means  algorithm.  In  this  research,  the  widely  used  

k-mean++ algorithm (Arthur & Vassilvitskii, 2007), which tries to spread out k initial cluster centroids, is leveraged 

to select initial cluster centroids.

With  the  clustering  results,  the  similarity  between  each  pair  of  locations  is  calculated.  If  two  locations  are 

within different clusters, their similarity is set to 0 to avoid merging between different clusters in the next step. If 

they are within the same cluster, their similarity is calculated using the following equation:

where s is the similarity and d(i, j) is the environmental distance between location i and location j in environmental 

covariate  space  (after  standardization).  The  commonly  used  Euclidean  distance  metric  is  used  in  this  research. 

Specifically, environmental covariate values of a location i are extracted and represented as a vector (ei1, ei2, ‚Ä¶, eim) 
and environmental covariate values of a location j are extracted and represented as a vector (ej1, ej2, ‚Ä¶, ejm) where m 
is the number of environmental covariates. The environmental distance is calculated using the following equation:

k

arg min

ÔøΩ
i=1

ÔøΩ
xj‚ààSi ‚Äñ

xj ‚àí ùúái

2

‚Äñ

s =

1
1 + d (i, j)

m

d (i, j) = ‚àö
‚àö
‚àö
‚àö

‚àë
n=1 (

2

ein ‚àí ejn)

DU et al.6‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

2.2.2‚ÄÉ|‚ÄÉLabel propagation from field sample locations to unlabeled locations

Before label propagation, a graph is leveraged to encode the similarities derived from the last step. In the graph, 

each node represents a location in the mapping area, and each edge represents a link between two nodes. Instead 

of a fully linked graph, a k-nearest-neighbor graph is used for simplicity and computational efficiency (note: this k 

is different from the k in the k-means clustering algorithm). Edges only appear between a node and its k nearest 

neighbors (k most similar neighbors) measured in terms of the similarities from the last step. The weights of all 

the edges are set to 1. Mathematically, a sparse matrix W can be used to represent this k-nearest-neighbor graph: 

Wij = 1 if xi is among the k nearest neighbors of xj or vice versa (Wij = 0 otherwise). An example is shown in Figure 5 
(here k = 3 and each arrow points from a node to its three nearest neighbors).

With the graph, a label propagation method is then utilized to propagate class labels from field sample loca-

tions  to  unlabeled  locations  through  a  similarity-based  merging  process  in  which  the  natural  aggregations  are 

detected and class labels are assigned to different natural aggregations. In this research, the following label prop-

agation algorithm (Zhou et al., 2004) is used:

1.  A  class  transition  probability  matrix  is  constructed  from  the  graph  (represented  as  the  sparse  matrix  W).

2.  A class probability matrix Y is initialized by setting the probabilities of field samples in the observed class to 1 

and all other probabilities to 0.

3.  The class transition probability matrix interactively propagates class labels from field samples to other locations 

through matrix multiplication (Y = W √ó Y) until Y converges (Y does not change any more, or the change between 

4.  Normalize the rows of the class probability matrix Y so that the sum of each row is 1 and the ith row represents 

iterations is smaller than a predefined threshold).

the probabilities of location i in different classes.

5.  For each row of the normalized class probability matrix, assign the class label with the highest probability to the 

corresponding location as the final class label.

6.  If the highest probability is 0, assign ‚ÄúNo Data‚Äù to the location.

After label propagation, class labels are spread from field samples to unlabeled locations if they are within 

the same natural aggregation (with high similarities). If an unlabeled location does not belong to the same natural 

aggregations as any field samples, it receives no class label (marked as ‚ÄúNo Data‚Äù in this research). A map of the 

study area is derived.

F I G U R E   5 ‚ÄÉk -Nearest-neighbor graph to encode similarities

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ7

2.3‚ÄÉ|‚ÄÉSoftware packages and tools

In  this  research,  we  use  GDAL,  Numpy,  and  Scipy  for  geospatial  data  processing  and  scikit-learn  for  machine 

learning-related tasks. scikit-learn is a machine learning library for the Python programming language. We use its 

k-means clustering (sklearn.cluster module) and label propagation algorithm (sklearn.semi_supervised module with 

slight modification and customization) to implement the proposed approach. We also use some of its supervised 

machine learning algorithms, including decision trees (sklearn.tree module), logistic regression (sklearn.linear mod-

ule) and SVMs (sklearn.svm module) for evaluation and comparison purposes.

3‚ÄÉ| ‚ÄÉC A S E S T U D I E S I N D I G ITA L S O I L M A PPI N G

Mapping the spatial distribution of soil types is a typical predictive mapping problem. When field samples are very 

limited, existing predictive methods (e.g., geostatistical methods, decision trees) are either inapplicable (e.g., exist-

ing samples are too sparse for spatial interpolation) or unreliable (class boundaries have high uncertainty). In con-

trast, with the development of spatial data capture techniques, high-quality and detailed environmental data that 

characterize soil forming factors (Hudson, 1992; Jenny, 1980; McBratney, Mendon√ßa Santos, & Minasny, 2003) 

are increasingly available from satellite imagery, aerial photography, and digital elevation models. The natural ag-

gregation patterns of these environmental covariate data often indicate niches of different soil types. Therefore, 

soil type mapping provides a good test bed for the proposed approach.

3.1‚ÄÉ|‚ÄÉStudy areas and data

We applied the proposed approach to map soil types in two study areas with different landscapes. Both study 

areas are featured with limited field soil samples. The first case study was relatively simple and was used as an 

example to illustrate how the proposed approach works. In the second case study more field samples are available, 

so a cross validation was conducted to test the robustness/stability of the proposed approach.

The first case study was conducted in Lubrecht Experimental Forest. It is about 50 km northeast of Missoula, 

MT in the U.S. and centered on the North Fork of Elk Creek (around 46¬∞52'14"N, 113¬∞20'29"W). The selected 
area is 16 km2 in size. The elevation ranges from 1,207 to 1,756 m. Most of the slopes are forested and the area is 

not cultivated. The bedrock type for the selected area is granite. There are two soil types (soil series) developed 

on top of this bedrock: Ambrant and Elkner. Figure 6 shows the digital elevation model (DEM) of the study area 

F I G U R E   6 ‚ÄÉDEM and field sample locations of the Lubrecht area

DU et al.8‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

(30 m resolution). The accuracy of the DEM is comparable with that of U.S. Geological Survey 7.5-min DEMs. The 

boundary of the study area is the same as the boundary of the DEM shown in Figure 6. There are 37 soil samples 

collected in the selected area. Among the soil samples, 8 samples (4 for each soil type) were used for training and 

29 were used as the test set. The locations of the field samples are also shown in Figure 6.

The second case study was conducted in an area located in Heshan Farm, which is 25 km south of Nenjiang 
County in northwestern Heilongjiang Province, China (centered around 48¬∞56'26"N, 125¬∞11'56"E). It is 60 km2 in 

size. The elevation in the area ranges from 276 to 363 m. The soils in the area are formed on deposits of silt loam 

loess and have a thick A-horizon with high organic matter content. The land use and soil management are generally 

uniform across the study area. There are six soil types in the area: Mollic Bori-Udic Cambosols (a); Typic Hapli-Udic 

Isohumosols (b); Typic Bori-Udic Cambosols (c); Lithic Udi-Orthic Primosols (d); Pachic Stagni-Udic Isohumosols (e); 

and Fibric Histic-Typic Haplic Stagnic Gleyosols (f). The soil types are identified at subgroup level in the Chinese soil 

taxonomy system (Chinese Soil Taxonomy Research Group 2001). To facilitate discussion, each of these is given a 

short ID as shown in parentheses. Figure 7 shows the DEM (10 m resolution) of the study area. It was created from 

a 1:10,000 topographic map. In this area there are 117 field soil samples in total available with soil type identified 

by a local soil classification expert at each site. The locations of the samples are also shown in Figure 7.

In both study areas, we selected environmental covariate variables based on soil forming factors. The bedrock 

geology can be used as the surrogate to parent material. Since the bedrock type is uniform in both areas, we did 

not include the parent material as an environmental covariate. Climate is either uniform or the micro-climate dif-

ferences are already expressed by topographic variables, so no climate variables were included. The environmen-

tal covariate variables selected for the first areas were: elevation, slope gradient, profile curvature, slope aspect, 

and forest canopy. The elevation, slope gradient, profile curvature, and slope aspect were derived from the 30 m 

DEM of the study area. The forest canopy was approximated with an index derived from thematic mapper (TM) 

F I G U R E   7 ‚ÄÉDEM and field sample locations of the Heshan area

DU et al.remote sensing data (Zhu, 2000). The environmental covariate variables selected for the second area were four 

topographic variables: slope gradient, planform curvature, profile curvature, and topographic wetness index. They 

were created from the 10 m DEM of the study area. The reason for only using topographic variables in the second 

area is that other environmental conditions are uniform overall in this area.

‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ9

3.2‚ÄÉ|‚ÄÉData processing and parameter setting

Environmental  covariate  data  were  pre-processed  to  remove  outliers  and  standardize  the  ranges.  The  outliers 

were data values with low frequency located at the ends of the data histograms, which were mostly errors in-

troduced during the creation of the DEM. These values were replaced with values next to these extremes. For 

standardization, the elevation and slope gradient were stretched to [0, 1]. The profile curvature was stretched to 

[‚àí0.5, 0.5]. Specifically, negative values were stretched to [‚àí0.5, 0) and positive values were stretched to (0, 0.5], 

while 0 values (means linear along the plane of curvature) were unchanged. The slope aspect was converted to 

two variables (cosine and sine of the aspect) to resolve the discontinuity issue at 360‚Äì0¬∫.

When calculating similarities, the number of clusters was set to be the same as the number of soil types ap-

pearing in the field samples. In label propagation, the k is set to 8 in the k-nearest-neighbor graph (a sensitivity 

analysis on how the choice of k influences the result is provided in the discussion section).

3.3‚ÄÉ|‚ÄÉEvaluation methods

In order to evaluate the proposed approach, we chose three commonly used predictive methods as the reference 

methods for comparison: decision trees, logistic regression, and SVMs. We applied these three methods on train-

ing field soil samples to build predictive models, which were then used to make predictions on unlabeled locations.

In the decision tree method, a tree is learned by splitting the training samples into subsets based on an attri-

bute value test. This process is repeated on each derived subset in a recursive manner. The recursion is completed 

when  the  subset  at  a  node  has  all  the  same  soil  types,  or  when  splitting  no  longer  adds  value  to  the  predic-

tions. There are different variations of decision tree learning algorithms. The algorithm used in this research is 

CART (Breiman, Friedman, Stone, & Olshen, 1984). To avoid over-fitting, we set the minimum number of samples 

in a leaf to be two, so that each leaf should have at least two training samples.

Logistic regression is a linear model for classification. For a binary classification problem, it takes the natural 

logarithm of the odds of the target variable being one class (referred to as the logit) to create a continuous crite-

rion as a transformed version of the target variable. The logit is then fitted to the predictors using linear regres-

sion analysis. The one vs. rest approach is used to extend the binary case to the multi-class case. That is, a single 

classifier is trained per class with the samples of that class as positive samples and all other samples as negatives. 

The classifiers are finally integrated to generate the final prediction for each location.

SVMs (Vapnik & Vapnik, 1998) use a kernel function to map training data into higher-dimensional space and 

then learn a linear classifier in that space to separate different classes. In this research, we used C-support vector 

classification, which is implemented in LIBSVM (Chang & Lin, 2011). The RBF kernel was used as the kernel function.

It should be noted that we did not choose any spatial relation-based predictive methods (e.g., kriging) as a com-

parison  method.  This  is  because  the  field  samples  in  both  cases  are  too  sparse  to  build  a  spatial  model  (e.g., 

semi-variogram)  and  to  conduct  spatial  interpolation.  Spatial  relation-based  methods  are  not  applicable  under 

these sparse field sample conditions.

The accuracy of the prediction is assessed using the test sample data using the following equation:

accuracy (%) =

√ó 100

nc
n

(4)

DU et al.10‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

where n is the total number of test samples and nc is the number of correctly predicted samples. As mentioned in 
Section 2.2.2, the proposed approach might also yield ‚ÄúNo Data‚Äù for some locations. If a test sample is assigned to 

‚ÄúNo Data,‚Äù it is treated as an incorrectly predicted sample in the case studies.

Compared to the first case study which has 37 field samples in total, there are 117 field samples in the second 

case study, providing us an opportunity to conduct a cross validation to test the robustness/stability of the pro-

posed approach. Specifically, a 50/50 random split of the 117 field samples was repeated 100 times and thus 100 

training/test dataset pairs were generated. Each training/test dataset pair has 58 training samples. For a study 
area of 60 km2 and a total number of six soil types, a training sample set with only 58 sample points is limited in 

terms of sample size and density (less than one sample per square kilometer). For each of the 100 training/test 

dataset pairs, a soil type map was generated using the proposed approach and the accuracy was calculated on the 

test dataset using Equation (4). For each of the 100 training/test dataset pairs, decision trees, logistic regression, 

and SVMs were also used to build a predictive model with the training samples, and the accuracy was calculated 

on the test samples.

3.4‚ÄÉ|‚ÄÉResults

3.4.1‚ÄÉ|‚ÄÉResults of the first case study

The maps generated from the proposed approach, the three comparison methods, and the existing conventional 

area-class soil survey map of the same area (Zhu, 1997) are shown in Figure 8. It can be seen that the map from 

the proposed approach has quite a different spatial pattern than those from the other three methods. In order to 

see which map can better capture the spatial variation of soil types in the area, we used the existing conventional 

area-class soil survey map as third-party reference. Though soil survey maps usually do not capture much spatial 

detail, they are generally believed to be able to capture the general spatial pattern of soil distribution as they were 

created by soil surveyors. The map from the proposed approach has similar spatial patterns as the soil survey map 

and the maps from the other three methods have quite different spatial patterns from the soil survey map. This 

indicates that the proposed approach captured the spatial patterns while the other three methods did not.

The accuracies of the four methods on test samples were calculated using Equation (4). The result is shown in 

Table 1. The accuracy of the proposed approach is higher than that of the other three methods, which agrees with 

the visual comparison.

From  the  map  and  accuracy  comparisons,  it  can  be  seen  that  using  only  eight  field  samples,  the  proposed 

approach can already capture the spatial variation of the two soil types in the area with the help of the natural ag-

gregation patterns in environmental covariate data. In contrast, decision tree, logistic regression, and SVM failed 

to generate satisfactory results. The eight field samples are not sufficient to represent the environmental niches 

of the two soil types. The derived maps are thus problematic.

3.4.2‚ÄÉ|‚ÄÉResults of the second case study

A total of 100 soil type maps were generated using the proposed method during the cross-validation process. 

Figure 9 shows one of the soil type maps as an example. The soil spatial variation captured by the map agrees 

well with the catenary sequence (the distribution of different soil types along a slope profile) of this area obtained 

from previous studies (Zhu et al., 2008, 2010). Mollic Bori-Udic Cambosols (a) occurs mainly in the summit posi-

tion of the terrain; Typic Hapli-Udic Isohumosols (b) is present at both back slope and foot slope; Typic Bori-Udic 

Cambosols  (c)  also  distributes  in  the  back  slope;  Lithic  Udi-Orthic  Primosols  (d)  is  in  areas  where  the  slope  is 

steepest; Pachic Stagni-Udic Isohumosols (e) and Fibric Histic-Typic Haplic Stagnic Gleyosols (f) are mainly in the 

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ11

F I G U R E   8 ‚ÄÉSoil maps generated by different methods in the Lubrecht area: (a) proposed approach;  
(b) the decision tree; (c) logistic regression; (d) the SVM; and (e) the existing soil survey map

TA B L E   1 ‚ÄÉAccuracy of the four methods in the Lubrecht area

Method

Proposed approach

Decision tree

Logistic regression

Accuracy (%)

79.31

51.72

51.72

SVM

68.97

floodplain. The map also has a few apparent misclassifications. For example, Pachic Stagni-Udic Isohumosols (e), 

which should only occur in the floodplain, also scatters in the back slope. It can also be seen that some areas are 

assigned ‚ÄúNo Data,‚Äù which means that no class label can be assigned to them after label propagation.

Figure 10 shows the accuracy distributions of the 100 runs on the 100 training/test dataset pairs from the 

four methods. The mean accuracy, accuracy range, and accuracy standard deviation of each method are shown 

in Table 2.

It can be seen that the semi-supervised approach has higher peak and mean accuracy compared to the other 

three methods. Also, both the left- and right-bound of the accuracy range are higher than those of the other three 

methods. A t test further shows that the accuracy improvement of the proposed approach is statistically signifi-

cant at the 99% confidence (p value < .01).

DU et al.12‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

F I G U R E   9 ‚ÄÉOne of the 100 soil type maps generated by the proposed approach in the Heshan area

F I G U R E   1 0 ‚ÄÉAccuracy distributions of the four methods on the 100 training/test dataset pairs: (a) proposed 
approach; (b) the decision tree; (c) logistic regression; and (d) the SVM

TA B L E   2 ‚ÄÉComparison of accuracy mean, range, and standard deviation of the four methods in the Heshan 
area

Method

Decision tree

Logistic 

SVM

regression

Mean accuracy (%)

56.36

50.42

50.47

Accuracy range (%)

[54.24, 72.88]

[37.29, 69.49]

[44.07, 67.80]

[44.46, 57.24]

Accuracy standard deviation (%)

3.68

5.84

4.43

1.37

Proposed 
approach

64.12

The accuracy standard deviation of the proposed approach is smaller than those of the decision tree and the 

logistic regression methods. Figure 11 shows the accuracies of the four methods on test sets for each of the 100 

runs. It can be seen that the accuracies of the decision tree and logistic regression have larger fluctuations than 

the proposed method. A few very low accuracies can be observed for the decision tree and the logistic regression 

methods during the 100 runs. The SVM method has the worst performance among the four methods. It seems 

that the limited training samples are not sufficient to find the support vectors of each soil type.

This case study tested the robustness/stability of the proposed method. The lower fluctuation/standard devi-

ation of the accuracy in the cross validation shows that the proposed method is more stable and less sensitive to 

the specific field sample set used. In contrast, the prediction results from the decision tree and logistic regression 

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ13

F I G U R E   1 1 ‚ÄÉAccuracy comparisons of the four methods for individual runs on the 100 training/test dataset 
pairs

TA B L E   3 ‚ÄÉSensitivity analysis on the choice of k when constructing k -nearest-neighbor graph

k

Mean accuracy (%)

Accuracy standard deviation (%)

5.80

2

58.08

4

63.10

4.05

8

64.12

3.68

12

63.49

3.50

20

62.31

3.79

100

57.32

3.15

methods are more likely to be affected by the field sample set used for training. Low accuracies occurred mainly 

because the limited field samples are insufficient to represent the niches of different soil types.

4‚ÄÉ| ‚ÄÉD I S CU S S I O N

4.1‚ÄÉ|‚ÄÉParameter setting and sensitivity analysis

The proposed approach has a few parameters to be set. One parameter is the number of clusters when we run 

the  clustering  algorithm  on  environmental  covariate  data  in  the  similarity  calculation  step.  In  the  case  studies, 

the number of classes appearing in the field samples was used as the number of clusters, which is a practical and 

intuitive choice. However, the determination of a proper cluster number is still a challenge for partitional cluster-

ing algorithms.

Another parameter is k (the number of neighbors) in constructing k-nearest-neighbor graphs to encode sim-

ilarities. Using a k-nearest-neighbor graph instead of a fully linked graph greatly improves the computational ef-

ficiency.  In  both  case  studies  we  set  k  =  8.  A  sensitivity  analysis  was  conducted  in  the  second  case  study  to 

investigate how the choice of k affects the performance of the proposed approach. The result is shown in Table 3.

It can be seen that when k is very small (k = 2), the mean accuracy of the 100 runs is low. A small k means only 

very similar locations (nodes) are connected by edges on the graph. In this case, it is difficult for labels to spread 

DU et al.14‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

between neighbors during the label propagation process. When k becomes very large (k = 100), the mean accuracy 

also decreases. A large k means two locations are still regarded as neighbors even if their similarity might already 

be very low. In that case, a label might be propagated to very dissimilar locations during the label propagation pro-

cess. When the k value stays in a certain range ([4, 20] in the case study), the accuracy is relatively stable. Though 

the determination of k is still an interesting question to study, the general rule is to avoid very small and very large 

k values according to this sensitivity analysis.

4.2‚ÄÉ|‚ÄÉNatural aggregations of environmental covariate data

The proposed approach makes use of the patterns in environmental covariate data together with limited field sam-

ples for predictive mapping. The natural aggregation patterns in environmental covariate data can provide stable 

information that serves as a good supplement to the limited field samples to determine reliable class boundaries.

A  fundamental  requirement  of  applying  this  method  is  that  classes  of  the  target  categorical  variable  have 

naturally aggregated environmental niches. The similarity-based merging process helps to find those natural ag-

gregations using environmental covariate data so that class boundaries can be more accurately determined than 

using field samples alone. In cases where this requirement is not satisfied, the use of environmental covariate data 

cannot help the prediction, and may even introduce more uncertainties/errors.

4.3‚ÄÉ|‚ÄÉDistribution of limited field samples and ‚ÄúNo Data‚Äù areas

In the proposed approach, limited field samples play an important role. They are the ‚Äúseeds‚Äù in the similarity-based 

merging process. After label propagation, the unlabeled locations get the label from the field samples that are 

within the same natural aggregation as them.

Since the field samples are limited, it is likely that some detected natural aggregations do not contain any la-

beled field samples. Locations in these natural aggregations receive no class labels and are marked as ‚ÄúNo Data‚Äù in 

our approach. ‚ÄúNo Data‚Äù areas are essentially areas that cannot be confidently predicted by current field samples, 

so they are left blank instead of being assigned unreliable class labels. These ‚ÄúNo Data‚Äù areas also indicate the 

places where future sampling efforts should be based. That is, these areas should be sampled first if a budget is 

available for new sampling efforts. This is an advantage of the proposed approach.

4.4‚ÄÉ|‚ÄÉLimitations and applicability

The proposed approach assumes equal contributions of different environmental covariates when detecting the 

natural aggregation patterns of environmental covariate data. That is, all environmental variables have the same 

weight in the similarity calculation process. However, in some cases, some environmental variables play a major 

role in differentiating different classes and should have higher weights. Though there are many methods for fea-

ture selection and feature weighting, they are usually not applicable here as the field samples are too limited to 

learn the proper weights for different environmental variables. This is a limitation of the proposed approach.

Though environmental covariate data in general can be used to differentiate different classes, there are some 

cases where they are insufficient. For example, two different classes might have very similar environmental condi-

tions. There are two reasons for this. The first is that the selected environmental covariates data cannot character-

ize well the underlying environmental conditions of the two classes. The second is that there might be some spatial 

processes  that  determine  the  formation  of  different  classes.  Using  static  environmental  covariate  data  cannot 

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ15

capture the dynamic processes. For example, in soil type mapping, the environmental covariate data only capture 

a snapshot but cannot capture the spatial processes (e.g., fluvial process) that form the spatial variation of soils.

The proposed approach can be used in many predictive mapping applications (e.g., soil, habitat, and landslide 

mapping). It is suitable in situations where field samples are very limited and there are high-quality environmental 

covariate  data  which  are  good  indicators  of  the  target  categorical  spatial  variable.  It  should  be  noted  that  the 

proposed approach is not meant to replace existing predictive mapping methods (e.g., geostatistical methods and 

supervised classification methods). These methods have been tested in many studies and have wide applicability. 

Instead, the proposed method provides an effective predictive mapping technique under the constrained condi-

tion of limited field samples.

5‚ÄÉ| ‚ÄÉCO N C LU S I O N S

This article presents a semi-supervised machine learning approach for predictive mapping with limited field sam-

ples.  The  approach  makes  use  of  the  natural  aggregation  patterns  embedded  in  environmental  covariate  data 

to supplement limited field samples. From the soil type mapping case studies, we can conclude that the use of 

the natural aggregation patterns can provide stable information for determining decision boundaries of different 

classes and effectively overcoming the small sample size issue in predictive mapping. When field samples are too 

limited to apply existing predictive methods, the proposed approach can generate maps that capture the spatial 

variation of the target variables. It only predicts the areas that existing samples can represent and marks other 

areas as ‚ÄúNo Data‚Äù to guide further sampling efforts. The performance is less sensitive to the specific field samples 

used and thus more robust.

The proposed approach does not mean to compete with existing predictive methods (such as geostatistical 

and classification methods). It should be used when field samples are too limited to apply existing predictive meth-

ods but there are high-quality environmental covariate data available.

There are a few potential areas of improvement for the presented approach. In the current implementation, 

natural  aggregation  patterns  are  detected  in  environmental  covariate  space.  One  improvement  is  to  take  the 

spatial aspect (e.g., spatial autocorrelation) into account. For example, spatial proximity can be considered when 

calculating similarities. Another possible improvement is in the parameter setting. If some prior knowledge/expert 

knowledge is available, how to more effectively set some key parameters (e.g., cluster number) is worth further 

research. In addition to the improvement of the method itself, we also want to evaluate this method on larger 

areas with more complex environmental conditions, investigate how the proposed approach responds when the 

sample size increases, and apply the method to predict other spatial categorical variables (e.g., suitable/unsuitable 

areas for certain species).

O R C I D

R E F E R E N C E S

Fei Du 

 https://orcid.org/0000-0001-5591-5409 

Allard, D., D'Or, D., & Froidevaux, R. (2011). An efficient maximum entropy approach for categorical variable prediction. 

European Journal of Soil Science, 62, 381‚Äì393.

Arthur,  D.,  &  Vassilvitskii,  S.  (2007).  k-Means++:  The  advantages  of  careful  seeding.  In  Proceedings of the 18th Annual 

ACM‚ÄìSIAM Symposium on Discrete Algorithms, New Orleans, LA (pp. 1027‚Äì1035). Philadelphia, PA: SIAM.

Bogaert,  P.  (2002).  Spatial  prediction  of  categorical  variables:  The  Bayesian  maximum  entropy  approach.  Stochastic 

Environmental Research & Risk Assessment, 16, 425‚Äì448.

Breiman,  L.,  Friedman,  J.,  Stone,  C.  J.,  &  Olshen,  R.  A.  (1984).  Classification  and  regression  trees.  Los  Angeles,  CA: 

Wadsworth.

DU et al.16‚ÄÉ |‚ÄÉ ‚ÄÉ‚ÄÇ

Brus, D. J., Bogaert, P., & Heuvelink, G. B. M. (2008). Bayesian maximum entropy prediction of soil categories using a 

traditional soil map as soft information. European Journal of Soil Science, 59, 166‚Äì177.

Burrough, P. A., Wilson, J. P., van Gaans, P. F., & Hansen, A. J. (2001). Fuzzy k-means classification of topo-climatic data as 

an aid to forest mapping in the Greater Yellowstone Area, USA. Landscape Ecology, 16, 523‚Äì546.

Cali≈Ñski,  T.,  &  Harabasz,  J.  (1974).  A  dendrite  method  for  cluster  analysis.  Communications  in  Statistics  ‚Äì  Theory  & 

Chang, C. C., & Lin, C. J. (2011). LIBSVM: A library for support vector machines. ACM Transactions on Intelligent Systems 

Methods, 3(1), 1‚Äì27.

& Technology, 2(3), 27.

Chapelle, O., Sch√∂lkopf, B., & Zien, A. (2006). Semi-supervised learning. Cambridge, MA: MIT Press.
Cialella, A. T., Dubayah, R., Lawrence, W., & Levine, E. (1997). Predicting soil drainage class using remotely sensed & dig-

ital elevation data. Photogrammetric Engineering and Remote Sensing, 63, 171‚Äì177.

De Bruin, S., & Stein, A. (1998). Soil-landscape modelling using fuzzy c-means clustering of attribute data derived from a 

digital elevation model (DEM). Geoderma, 83, 17‚Äì33.

Debella-Gilo, M., & Etzelm√ºller, B. (2009). Spatial prediction of soil classes using digital terrain analysis and multinomial 

logistic regression modelling integrated in GIS: Examples from Vestfold County, Norway. Catena, 77, 8‚Äì18.

Goovaerts, P. (1997). Geostatistics for natural resources evaluation. New York, NY: Oxford University Press.
Hudson, B. D. (1992). The soil survey as paradigm-based science. Soil Science Society of America Journal, 56, 836‚Äì841.
Jenny, H. (1980). The soil resource: Origin and behavior. New York, NY: Springer.
Journel, A. G. (1983). Nonparametric estimation of spatial distributions. Mathematical Geology, 15, 445‚Äì468.
Kempen, B., Brus, D. J., Heuvelink, G. B., & Stoorvogel, J. J. (2009). Updating the 1:50,000 Dutch soil map using legacy 

soil data: A multinomial logistic regression approach. Geoderma, 151, 311‚Äì326.

Kerry,  R.,  &  Oliver,  M.  A.  (2007).  The  analysis  of  ranked  observations  of  soil  structure  using  indicator  geostatistics. 

Kovaƒçeviƒá, M., Bajat, B., & Gajiƒá, B. (2010). Soil type classification and estimation of soil properties using support vector 

Geoderma, 140, 397‚Äì416.

machines. Geoderma, 154, 340‚Äì347.

LeCun, Y., Bengio, Y., & Hinton, G. (2015). Deep learning. Nature, 521, 436‚Äì444.
Lees, B. G., & Ritman, K. (1991). Decision-tree and rule-induction approach to integration of remotely sensed and GIS 

data in mapping vegetation in disturbed or hilly environments. Environmental Management, 15, 823‚Äì831.

Li, W. (2007). Markov chain random fields for estimation of categorical variables. Mathematical Geology, 39, 321‚Äì335.
Li, W., & Zhang, C. (2007). A random-path Markov chain algorithm for simulating categorical soil variables from random 

point samples. Soil Science Society of America Journal, 71, 656‚Äì668.

McBratney, A. B., Mendon√ßa Santos, M. D. L., & Minasny, B. (2003). On digital soil mapping. Geoderma, 117, 3‚Äì52.
Oliver, M. A., & Webster, R. (2014). A tutorial guide to geostatistics: Computing and modelling variograms and kriging. 

Catena, 113, 56‚Äì69.

Pearson, R. G., Dawson, T. P., Berry, P. M., & Harrison, P. A. (2002). SPECIES: A spatial evaluation of climate impact on the 

Qi,  F.,  &  Zhu,  A.  X.  (2003).  Knowledge  discovery  from  soil  maps  using  inductive  learning.  International  Journal  of 

envelope of species. Ecological Modelling, 154, 289‚Äì300.

Geographical Information Science, 17, 771‚Äì795.

Schmidhuber, J. (2015). Deep learning in neural networks: An overview. Neural Networks, 61, 85‚Äì117.
Scull, P., Franklin, J., & Chadwick, O. A. (2005). The application of classification tree analysis to soil type prediction in a 

Stockwell, D. R., & Peterson, A. T. (2002). Effects of sample size on accuracy of species distribution models. Ecological 

Szummer, M., & Jaakkola, M. S. T. (2002). Partially labeled classification with Markov random walks. Advances in Neural 

desert landscape. Ecological Modelling, 181, 1‚Äì15.

Modelling, 148, 1‚Äì13.

Information Processing Systems, 14, 945‚Äì952.

Royal Statistical Society, Series B, 63, 411‚Äì423.

Tibshirani, R., Walther, G., & Hastie, T. (2001). Estimating the number of data clusters via the Gap statistic. Journal of the 

Vapnik, V. N., & Vapnik, V. (1998). Statistical learning theory (Vol. 2). New York, NY: Wiley.
Wisz, M. S., Hijmans, R. J., Li, J., Peterson, A. T., Graham, C. H., & Guisan, A. (2008). Effects of sample size on the perfor-

mance of species distribution models. Diversity & Distributions, 14, 763‚Äì773.

Yang, L., Zhu, A., Qi, F., Qin, C., Li, B., & Pei, T. (2013). An integrative hierarchical stepwise sampling strategy for spatial 
sampling and its application in digital soil mapping. International Journal of Geographical Information Science, 27, 1‚Äì23.
Yao, X., Tham, L. G., & Dai, F. C. (2008). Landslide susceptibility mapping based on support vector machine: A case study 

on natural slopes of Hong Kong, China. Geomorphology, 101, 572‚Äì582.

Young, F. J., & Hammer, R. D. (2000). Defining geographic soil bodies by landscape position, soil taxonomy, and cluster 

analysis. Soil Science Society of America Journal, 64, 989‚Äì998.

Zhou, D., Bousquet, O., Lal, T. N., Weston, J., & Sch√∂lkopf, B. (2004). Learning with local and global consistency. Advances 

in Neural Information Processing Systems, 16, 321‚Äì328.

DU et al.‚ÄÉ‚ÄÇ ‚ÄÉ| ‚ÄÉ17

Zhu, A. X. (1997). A similarity model for representing soil spatial information. Geoderma, 77, 217‚Äì242.
Zhu, A. X. (2000). Mapping soil landscape as spatial continua: The neural network approach. Water Resources Research, 

36, 663‚Äì677.

Zhu, A. X., Hudson, B., Burt, J. E., Lubich, K., & Simonson, D. (2001). Soil mapping using GIS, expert knowledge, and fuzzy 

logic. Soil Science Society of America Journal, 65, 1463‚Äì1472.

Zhu, A. X, Liu, J., Du, F., Zhang, S. J, Qin, C. Z, Burt, J., Behrens, T., & Scholten, T. (2015). Predictive soil mapping with 

limited sample data. European Journal of Soil Sciences, 66, 535‚Äì547.

Zhu, A. X., Lu, G. N., Liu, J., Qin, C. Z., & Zhou, C. H. (2018). Spatial prediction based on third law of geography. Annals of 

GIS, 24(4), 225‚Äì240.

Zhu, A. X., Yang, L., Li, B. L., Qin, C. Z., English, E., Burt, J. E., & Zhou, C. (2008). Purposive sampling for digital soil mapping 
for areas with limited data. In A. E. Hartemink, A. B. McBratney, & M. de Lourdes Mendon√ßa-Santos (Eds.), Digital soil 
mapping with limited data (pp. 233‚Äì245). Amsterdam, the Netherlands: Springer.

Zhu, A. X., Yang, L., Li, B. L., Qin, C. Z., Pei, T., & Liu, B. Y. (2010). Construction of membership functions for predictive soil 

mapping under fuzzy logic. Geoderma, 155(3‚Äì4), 164‚Äì174.

Zhu,  X.,  &  Ghahramani,  Z.  (2002).  Learning  from  labeled  and  unlabeled  data  with  label  propagation  (Technical  Report 

CMU-CALD-02-107). Pittsburgh, PA: Carnegie Mellon University.

Zhu, X., Ghahramani, Z., & Lafferty, J. (2003). Semi-supervised learning using Gaussian fields and harmonic functions. 
In Proceedings of the 20th International Conference on Machine Learning, Washington, DC (pp. 912‚Äì919). Menlo Park, 
CA: AAAI Press.

Zhu, X., & Goldberg, A. B. (2009). Introduction to semi-supervised learning. Synthesis Lectures on Artificial Intelligence & 

Machine Learning, 3, 1‚Äì130.

How to cite this article: Du F, Zhu A-X, Liu J, Yang L. Predictive mapping with small field sample data using 

semi-supervised machine learning. Transactions in GIS. 2019;00:1‚Äì17. https ://doi.org/10.1111/tgis.12598 

DU et al.