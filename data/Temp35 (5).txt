International Journal of Geographical Information
Science

ISSN: 1365-8816 (Print) 1362-3087 (Online) Journal homepage: http://www.tandfonline.com/loi/tgis20

Integrating algebraic multigrid method in spatial
aggregation of massive trajectory data

Siying Wang, Yunyan Du, Chen Jia, Meng Bian & Teng Fei

To cite this article: Siying Wang, Yunyan Du, Chen Jia, Meng Bian & Teng Fei (2018) Integrating
algebraic multigrid method in spatial aggregation of massive trajectory data, International Journal of
Geographical Information Science, 32:12, 2477-2496, DOI: 10.1080/13658816.2018.1512713

To link to this article:  https://doi.org/10.1080/13658816.2018.1512713

Published online: 03 Sep 2018.

Submit your article to this journal 

Article views: 116

View Crossmark data

Full Terms & Conditions of access and use can be found at
http://www.tandfonline.com/action/journalInformation?journalCode=tgis20

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE
2018, VOL. 32, NO. 12, 2477–2496
https://doi.org/10.1080/13658816.2018.1512713

RESEARCH ARTICLE

Integrating algebraic multigrid method in spatial
aggregation of massive trajectory data

Siying Wang a, Yunyan Dub, Chen Jiaa, Meng Biana and Teng Feia

aSchool of Resource and Environmental Science, Wuhan University, Wuhan, PR China; bState Key
Laboratory of Resources and Environmental Information System, Institute of Geographic sciences and
natural Resources Research, CAS, Beijing, PR China

ARTICLE HISTORY
Received 2 February 2018
Accepted 8 August 2018

KEYWORDS
Spatial aggregation;
trajectory visualization;
algebraic multigrid; key
node identiﬁcation

ABSTRACT
The advanced technologies in location-based services and telecom
have yield large volumes of trajectory data. Understanding these
data eﬀectively requires intuitive yet accurate visual analysis. The
visual analysis of massive trajectory data is challenged by the
numerous interactions among diﬀerent locations, which cause
massive clutter. This paper presents a new methodology for visual
analysis by integrating algebraic multigrid (AMG) method in data
aggregation. The non-parametric method helps to build a multi-
layer node representation from a graph which is extracted from
trajectory data. The comparison with AMG and other methods
shows that AMG method is more advanced in both the spatial
representation and the importance of nodes. The new method is
tested with real-world dataset of cell-phone signalling records in
Beijing. The results show that our method is suitable for proces-
sing and creating abstraction of massive trajectory dataset, reveal-
ing inherent patterns and creating intuitive and vivid ﬂow maps.

1. Introduction

In a metropolitan setting, a large amount of population moves between diﬀerent places
throughout the day. Such location-to-location movements can be referred to as trajec-
tories, which represent the extent of human mobility in a particular area. With the
widespread use of location–acquisition technologies, trajectory data are generated by
most of the citizens everyday. Thus, a compilation of the data on the movements (ﬂows)
of people can help us to analyse the pattern of intra-urban human mobility and identify
important places, which are of great value for urban planning, transportation optimiza-
tion and related policy making.

User trajectory data can be obtained from various sources, such as traﬃc sensors,
public transportation usage records, and media websites which support geo-tagging. At
present, with the popularity of mobile terminals such as smart phones, mega-cities have
basically achieved full network coverage. The use of cell-phone signalling record data is
increasing as an emerging traﬃc detection data source (Isaacman et al. 2011, Zhang
2014). Mobile phone base stations can be treated as ﬁxed sensors and used to detect
the ﬂow of people, reﬂecting the mobility of urban residents. In addition, mobile phone

CONTACT Teng Fei
© 2018 Informa UK Limited, trading as Taylor & Francis Group

feiteng@whu.edu.cn

2478

S. WANG ET AL.

users’ locations are recorded in time sequence. A user’s trajectory is therefore repre-
sented by a sequence of mobile phone base station number with time stamps. The
signalling data from phone base stations have two primary advantages. First, the data
are collected for all active mobile phones because everyone who makes a phone call or
sends an SMS will trigger a record in real time. Second, the use of signalling data incurs
little marginal cost because it is already being collected to help operate the mobile
communication networks.

The visualization of trajectory data is particularly important to advance our understand-
ing and analysis of the dynamics unfolding in geographic domains (Andrienko et al. 2008,
Guo 2009, Guo et al. 2011, Andrienko and Andrienko 2013, Guo and Zhu 2014, Wang and
Yuan 2015). An accurate visualization should help us to illustrate information provided by
the data intuitively and vividly, so readers are able to understand the information and turn it
into knowledge and utilize it in decision-making processes. When dealing with massive
trajectory data within a city, the traditional visualization approach usually failed due to the
mutual occlusion of lines and massive clutter. Much work has been proposed to solve these
problems, such as edge bundling (Holten 2006, Holten and Van Wijk 2009, Ersoy et al. 2011),
graph partitioning (Guo 2009), spatial clustering (Andrienko and Andrienko 2010, Von
Landesberger et al. 2016), and data ﬁltering (Ellis and Dix 2006, Rae 2009) (see Section 2).
These methods can be classiﬁed as visual simpliﬁcation. However, there are still some
problems that remain to be addressed. First, existing approaches such as data ﬁltering
and edge bundling may suﬀer from loss of accurate geographical information. Second, in
the process of data aggregation with point-based data (such as taxi data, mobile phone
data), most methods only focus on the importance of points and do not consider their
spatial representation. Third, clustering-based methods, such as hierarchical clustering and
k-means clustering, are eﬀective and useful in data simpliﬁcation, but the parameter tuning
process is arbitrary and may harm the reproducibility of the visual analysis (Guo 2009,
Andrienko and Andrienko 2010, Von Landesberger et al. 2016).

To address these issues, our research presents an algorithm that explores the use of a
spatial simpliﬁcation method based on an algebraic multigrid (AMG) method for repre-
sentative base station extraction. This method solves the problem of complex parameter
adjustment and notably reduces the data size. AMG (Briggs et al. 2000, Stüben 2000,
Falgout 2006) was initially developed as a method for solving large partial diﬀerential
equations (PDEs) based on multigrid presentation, which requires information only
contained in the matrix. Thanks to the multigrid structure of AMG, the important mobile
phone base stations can be extracted at diﬀerent levels from the multi-scale grids of
AMG, and then they can be used as feature points to re-segment the space into regions
and choose nodes at diﬀerent scales for visualization. Thus, the original complex spatial
interactions among all base stations can be abstracted to interactions among just a few.
As a normal practice, a graph is used to represent the spatial interactions where each
node represents a mobile phone base station. Interactions among nodes are treated as
edges and edge weights are determined by ﬂow magnitudes. To present the importance
of each node of the graph, existing research commonly utilizes the concept of in–out
degree as an evaluation index, such as PageRank, degree centrality, and closeness
centrality (Vrotsou et al. 2011, Zhang et al. 2013, Liu et al. 2015, 2016). In this study, a
weighted graph is constructed and an exponential distance decay function is used to
form the strength matrix in the process of the AMG method, which does not only

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2479

location. Global

consider the impact of the degree of the nodes but also takes into account the distance
between nodes, which ensures that the mobile stations are not only advantageous in
terms of ﬂow magnitude but are also well represented so that not all nodes with a
indicators, such as support
higher degree cluster in a geographical
degree, distribution uniformity, and gravity, are calculated to evaluate the representa-
tiveness of the chosen points. The results show that our method can adaptively and
rationally select the representative nodes at diﬀerent scales based on the AMG method
without any parameter tuning. Based on the representative nodes, ﬂow maps clearly
show the interactions of Beijing at diﬀerent spatial scales and thus enable us to better
understand the movement pattern within the city at diﬀerent times throughout a day.
This paper is organized as follows. In Section 2, we introduce the background and
related work, followed by the methods we applied in Section 3. In Section 4, the results
of an application are reported. In Section 5, we discuss and conclude this work and
suggest future works.

2. Background and related work

This section summarizes related research in two aspects. The visualization of spatial
interaction data has recently drawn signiﬁcant attention in geographical studies. The
AMG method is an eﬃcient algebraic method for solving large sparse and unstructured
linear systems of equations.

2.1. Visualization of spatial interaction data

Graphs are mathematical structures that model pairwise relations between objects, con-
sisting of an ordered pair G = (V, E), comprising a set V of vertices together with a set E of
edges. In practice, spatial interactions (ﬂows), such as traﬃc ﬂows and population migra-
tion, can be considered as a weighted graph (network). The vertices in the graph represent
nodes in the actual network, the edges represent the connection relationships between the
nodes in the network, and the edge weights are measured by ﬂow magnitudes. Intuitive
and vivid visualization of spatial interaction data can help us eﬀectively understand the
movement patterns of people. There are two main types for ﬂow visualization: OD matrix
(Wood et al. 2010) and ﬂow map (Guo 2009, Guo and Zhu 2014). An OD matrix is a table in
which each row and each column correspond to an origin and a destination, and numbers
of matrix cells represent the ﬂow magnitudes. The ﬂow map is the most commonly used
method for the visual representation of ﬂow situations, which draws a straight or curved
line between the regions on the map and uses the width of the edge to indicate the ﬂow
magnitude (Marble et al. 1997). Traditional ﬂow maps do not scale well to large datasets.
The increasing number of locations and links overlapping on the map make it diﬃcult to
identify locations or ﬂows or their directions visually. This necessitated the simpliﬁcation of
ﬂow maps. Tobler (1987) proposed a way of ﬁltering out the ﬂow of small magnitude, and
Wood et al. (2011) reduced the opacity of minor ﬂows. These approaches notably simpliﬁed
the ﬂow data and improved the visual clarity of ﬂow maps, but their strategies can suﬀer
from information loss. Edge bundling is also a popular method to simplify the interactions
(Phan et al. 2005, Holten 2006, Ersoy et al. 2011), which merge spatially close ﬂows to
reduce overlap. Another approach is location aggregation. Von Landesberger et al. (2016)

2480

S. WANG ET AL.

used a graph-based method that combined spatial and temporal simpliﬁcations, and
revealed movement patterns that were hid in ﬂow maps. Guo (2009) partitioned US states
based on a hierarchical clustering method in order to control the number of ﬂows.
Andrienko and Andrienko (2010) devised a method of space partitioning by extracting
signiﬁcant points from the trajectories which conveys essential characteristics of the move-
ment. These methods eﬀectively summarized large ﬂow data while still maintaining major
patterns. However, the common drawback of them is that selection of the parameters of
these clustering methods (k-means, DBSCN, etc.) is diﬃcult, and it is sometimes hard to
determine the number of clustering classes.

2.2. AMG method

Multigrid methods (Brezina et al. 2011) refer to a family of iterative algorithms, and they
were originally applied to solve large sparse linear systems using the following equation:

Ax ¼ f

(1)

where A is an n × n matrix, f is a vector of length n and x denotes the solution of this
linear system. Traditional relaxation methods, such as Jacobi and Gauss–Seidel, eﬃ-
ciently reduce the high-frequency errors while there has been little progress on reducing
low-frequency errors. Hence, the multigrid method was developed based on these
traditional relaxation methods with its capability of damping the errors at all frequencies
and the ability to solve large-scale problems with high-performance computers. There
are two complementary requirements for the multigrid method (Stüben 2000): smooth-
ing (also called relaxation) and coarse-grid correction. Smoothing is generally accom-
plished by the iterative methods of either Jacobi or Gauss–Seidel (Briggs et al. 2000).
Coarse-grid correction uses eﬃcient coarse scale approximations to transferring infor-
mation from a ﬁne grid to a coarser grid. The coarsening process ends when the grid is
relatively small, and the accurate approximation is obtained at a small scale. The solution
can then be transferred back to the ﬁnest level through interpolation.

In general, there are two multigrid methods: a geometric method and an algebraic
method (AMG) (Briggs et al. 2000). The most important conceptual diﬀerence between
these methods lies in the mode of coarse-grid construction. In the geometric method, the
coarse grids are determined by the geometrical location which is simple and well-ordered.
On the contrary, the algebraic method determines coarse grids solely based on the given
matrix (i.e. samples the ﬁne grids non-uniformly), and the coarse grids are a set of vertices
selected to satisfy certain criteria based on the ﬁne grids (Brandt 1986). Since the algebraic
method is more robust on PDEs with highly nonlinear coeﬃcients than the classic geometric
method (Brandt et al. 1982), AMG is more appropriate when dealing with large amounts of
data. Recently, AMG has been introduced in image analysis (Weickert 1996, Acton 1998,
Kimmel and Yavneh 2006, Duarte-Carvajalino et al. 2007, Papandreou and Maragos 2007).

3. Methodology

Taking advantage of the multigrid structure, a novel procedure based on multigrid
methods is developed for visualizing trajectory data. The analytical workﬂow is com-
posed of (1) extracting representative nodes with the AMG method, (2) nodes selection

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2481

strategy comparison, (3) region segmentation and (4) aggregating and visualizing the
trajectory.

3.1. The AMG method

With the AMG method, one can build a hierarchical representation from ﬁne grid to
coarse grid to solve the problem (Falgout 2006). The multigrid structure appears like an
inverted pyramid shown in Figure 1. We use s to indicate the grid level. The ﬁnest grid,
s = 0, is constructed based on the original matrix A, and each layer of next coarser grids
is a subset of the previous ﬁner grid. Points in the coarse grid are chosen in directions of
strong connections of the matrix (Falgout 2006). Graph theory (VS, ES) is used to
represent the problem. In Equation (1) Ax = f,

x ¼ x1; x2; . . . ; xn

½

(cid:2)T

the set of vertices (VS) in the ﬁnest grid Ω0 is the indices {1, 2, . . ., n}, and edges (ES) of the
grid are determined by the adjacency graph of the matrix A (Figure 2).

After constructing the ﬁnest grid layer, the coarser grids are extracted from it,
which can be seen as a recursive procedure. We use superscripts to indicate the level
number s, where s = 0 donates the ﬁnest level. Each coarser grid is a subset of the
previous ﬁner grid, so the relationship of the multi-grid can be represented as
follows:

Ω0 (cid:3) Ω1 (cid:3) Ω2 (cid:3) . . . (cid:3) ΩS

In order to derive the coarse grid from the ﬁne grid, Ω° is split into two disjoint subsets with
C° representing those points contained in the coarse grid, and F° being the complementary

(2)

(3)

Figure 1. The multigrid structure of AMG.

2482

S. WANG ET AL.

Figure 2. The nonzero structure of A (a) and the resulting adjacency graph (b).

subset (Ω° = C°∪F°). After constructing the coarse grid, we recall the most basic relaxation
method and then use the coarse grids to focus the relaxation on the oscillatory components
of the error (Briggs et al. 2000). A two-grid procedure (also called the correction scheme) of a
V-cycle of AMG solver can be described by Briggs et al. (2000):

● Relax v1 times on Asxs = f s on Ωs with initial approximation vs.
● Compute the ﬁne-grid residual rs = f s – Asvs and restrict it to the coarse grid by

rs+1 = Rsrs.

● Solve As+1es+1 = rs+1 on Ωs+1.
● Interpolate the coarse-grid error to the ﬁne grid by es = Pses+1 and correct the ﬁne-

grid approximation by vs ← vs + es.

● Relax v2 times on Asxs = f s on Ωs with initial guess vs.

The restriction operator Rs is used to transfer solutions from a ﬁne grid to the next
coarser grid, and the interpolation operator Ps is used to transfer solutions from a coarse
grid to the previous ﬁner grid. Figure 3 depicts the V-cycle of the multigrid method. The
V-cycle is deﬁned as a recursive procedure. As the V-cycle ‘descends’ into coarser grids,
the ﬁnest grid coarsens down to the coarsest grid by restriction and solving the linear
system at the lowest scale. As the V-cycle ‘ascends’ through ﬁner grids, the solution
propagates back to the ﬁnest grid. After a few V-cycle iterations, the multigrid computa-
tions dramatically accelerate the convergence of the linear system to obtain a solution.
Note that the speciﬁc number of iterations in V-cycle is determined by the total number
of original matrix coeﬃcients. When the number of grid points at a level k is small
enough, AMG will automatically stop the coarse-grid construction and ﬁnally, a k-level
multigrid structure will be formed.

3.2. Representative stations extraction with AMG method

The coarsening procedure of AMG is the core part of our method, which is mentioned in
Section 3.1. The AMG method determines its components based only on the given
matrix, and it can be applied to a wide range of problems (Brandt 1986). In this section, a
detailed explanation is provided on how to extract representative stations using the
AMG method.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2483

Figure 3. Multigrid V-cycle.

3.2.1. Constructing the strength matrix
With the trajectory data, we can ﬁrst apply graph theory to form a graph which has the
ﬁnest grid Ω° in AMG structure and an adjacency matrix A to represent the graph. As a
result, the original trajectory is represented by a weighted graph (V°, E°), where the set of
vertices V° corresponds to the mobile phone base stations, and E° is the set of edges. Then,
the ﬁnest grid Ω° is split into two parts: a coarse grid C° and a ﬁne grid F° (Ω° = C°∪F°). This
process is deﬁned as ‘C/F splitting’, with C° representing those vertices (mobile phone base
stations) which will be contained in the next grid level Ω1. By recursively applying the C/F
splitting to each grid level, a multigrid structure of AMG is formed and the vertices in those
coarse grids can serve as the representative stations of the nodes in the network.

The key step to achieve the ‘C/F splitting’ procedure is to build a strength matrix. It is
used to measure the connection strength between coeﬃcients of the matrix A. Since not
all matrix coeﬃcients are equal in Equation (1), the task is to determine which coeﬃ-
cients are more important so that they can be selected in the next coarser grid. Let
points in ﬁne grid be F-points and points in the coarse grid be C-points. The construc-
tion of the multigrid structure requires F-points to be strongly connected to a common
C-point. Therefore, a concept of strong connection is introduced in the coarsening
process by several authors (Briggs et al. 2000, Yang 2006):

(cid:4)aij (cid:5) θ max
k(cid:1)i

(cid:4)aik
f

gð0 < θ (cid:6) 1Þ

(4)

In which, given a threshold θ (usually take 0.25), if the coeﬃcient aij is larger than others,
then we can say that grid point i strongly depends on grid point j or j strongly inﬂuences
i. The weight aij of (i,j)∈ES represents the connection strength between the mobile phone
station i and j in VS. Hence, we can form a strength matrix to quantify the importance of
nodes.

(5)

(6)

(7)

(8)

2484

S. WANG ET AL.

Two scalars of distance and degree are combined to construct the strength matrix. In
graph theory, the degree of a vertex of a graph is the number of edges incident to the vertex;
this is one of the key factors in considering the importance of a base station. The higher the
degree of a base station, the more the number of visits to the area. Furthermore, inspired by
the distance decay eﬀect (Miller 2004, Liang et al. 2012, Liu et al. 2014, 2015), the interaction
intensity can be a function of distance between two places. The most commonly used
distance decay functions include power law, exponential function and Gaussian function,
deﬁned (Liu et al. 2014) as follows:
The exponential distance decay function:

The power-law distance decay function:

The Gaussian distance decay function:

f ðdÞ ¼ Ce(cid:4)αdðα > 0Þ

f ðdÞ ¼ Cd(cid:4)β

ðβ > 0Þ

f ðdÞ ¼ Cd(cid:4)αd2

ðα > 0Þ

The exponential function has been widely used to examine the impact of distance in
geographic research and has proven well to characterize traveling displacements (Liang
et al. 2012). Taking the exponential distance decay function in our experiment, then the
strength (weight) gij between stations i and j, is given by

0

@

1

A

(cid:1) (cid:3)
(cid:4) 1
ki (cid:7)kj
σ2

gij ¼ e(cid:4)d (cid:7) e

where d is the distance between nodes (mobile phone station) i and j, ki and kj are the
degrees of node i and node j, andσis the standard deviation of the degree of all base stations.

3.2.2. Representative stations extraction
Once the strength matrix is constructed, the next step is to deﬁne coarse grids for AMG. The
following two conditions must be satisﬁed in the coarsening process (Brezina et al. 2011):

(1) For each point j that strongly inﬂuences an F-point i, then j is either a C-point or j

and i are strongly inﬂuenced by a common C-point.

(2) The C-points should be a maximally independent subset of all points and two

C-points should not be strongly dependent upon each other.

Fulﬁlling the ﬁrst condition ensures a strong ‘F-points to C-points’ connectivity, and the
second condition is to control the size of each coarse grid because C-points tend to be
farther apart. In general, it is not always possible to fulﬁl both conditions, so the ﬁrst one
is enforced while the second one is used as an additional condition.

Once the coarser grid is deﬁned, then interpolation and a restriction operator are con-
structed based on the original matrix A. The information of the matrix A will pass to the next
gird in the recursion of the V-cycle procedure described in 3.1, and ﬁnally a hierarchical
multigrid structure is formed. The vertices in these diﬀerent coarse grids can be taken as

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2485

representative mobile phone base stations. According to the regional segmentation method
in (Andrienko and Andrienko 2010), a Voronoi diagram is used to divide the research area into
sub-regions based on the vertices in the coarse grid. Note that no additional empty points will
be introduced to generating the Voronoi cell as in (Andrienko and Andrienko 2010) to improve
the spatial uniformity of the Voronoi diagram, as it has been considered by the AMG method.

3.3. Nodes selection strategy comparison

In order to measure the quality of the nodes selected from the coarse grid and prove the
superiority of our method, a comparison between our method and two other node
evaluating methods – PageRank and Degree Centrality – is made. In graph theory, these
two methods distinguish the importance of nodes in diﬀerent ways. The two methods are
applied to the same network which is formed by trajectory data mentioned in Section 3.2.1,
and then a ranking list of nodes according to their importance from high to low is generated
by each method (Lü et al. 2016). After that, three global indices, namely the distribution
uniformity (DU), the support degree (SD), and the gravitation (G) based on the gravity model
are proposed to evaluate the strategies from diﬀerent perspectives. The DU index evaluates
the spatial homogeneity of the representative points, SD evaluates the coverage quality of
the representative points, and G (taking distance into account) evaluates the importance of
the representative points to which they are connected. A detailed comparison of the results
of these methods is described in Section 4.2.

Deﬁnition 1: Distribution Uniformity (DU) is deﬁned as the ratio of the total length
Lmst and the number of links n, Lmst is the total length of the minimum spanning tree
formed by the extracted points as follows:

This indicator reﬂects the distribution of the extracted representative points in the city.
The larger the DU, the more uniform the distribution of the points. On the contrary, the
points may be concentrated in some area of the city.

Deﬁnition 2: SD is deﬁned as the average area of Delaunay Triangulation formed by

the extracted points as follows:

where m is the total number of triangles in the Delaunay Triangulation and Si donates the
area of triangle i. This indicator reﬂects the area coverage of the convex hull constructed
by extracted points in Beijing, where a higher SD represents a higher the coverage.

Deﬁnition 3: Gravitation (G) describes the average attractiveness of extracted points

as follows:

DU ¼

Lmst
n

Si

Pm

i¼1
m

SD ¼

Pm

i¼1

DiDj
rα

Pn

j¼1
n

m

G ¼

(9)

(10)

(11)

2486

S. WANG ET AL.

where Di and Dj are degree of point i and point j, n is the total number of points that are
connected with point i, m is the number of extracted points, and r represents the
distance between point i and point j. α is the distance decay coeﬃcient.

3.4. Data aggregation and visualization

3.4.1. Data aggregation
After regional segmentation in 3.2, the research area is divided into several sub-regions. At
ﬁrst, each base station can be renumbered according to the sub-region to which the base
station belongs. Then, each trajectory containing multiple base stations can be simpliﬁed as
a sequence between only several regions. On this basis, the original large number of
trajectories between all mobile base stations can be aggregated into simple links between
the sub-regions.

3.4.2. Flow visualization
Flow maps are used to visualize the aggregated trajectory data. For pair of sub-regions
(rn,rm), the ﬂow magnitude between them is counted. A straight line is used to visualize
edges between origin and destination, the width of each line is proportional to its ﬂow
magnitude, and the node size of the ﬂow map is proportional to its degree.

Various mapping designs are experimented in ﬂow mapping. First, an undirected ﬂow
map with no direction between each pair of nodes can be used in which the width is
determined by the sum of visits between the two sub-regions. Second, a directed ﬂow
map can be used. One of the various design principles for ﬂow maps summed up by
Jenny et al. (2018) showed that ﬂow direction is best indicated with arrowheads. Edge
arrows are used to indicate the direction. To overcome the poor readability resulting
from the cluttering of arrows, both colour gradient and edge arrows are used to encode
direction, and edges from light to dark indicate outgoing. Third, ﬂow maps can be used
at diﬀerent times. Clearly the movement patterns of people are diﬀerent at various times
of a day; therefore, dividing the time into intervals may help in capturing the diﬀerences
of ﬂow throughout a day. Following the methods described in (Andrienko et al. 2017), a
working day can be divided into diﬀerent periods according to an hourly base station
activation volume distribution curve and then visualizing the ﬂow maps for each period.

4. Applications

To test our methodology, we performed our method with a real-world dataset in Beijing.
As the capital city of the People’s Republic of China, Beijing is the nation’s political and
cultural centre with a population of 21.7 million people including 16 urban and sub-
urban districts. The dataset is collected from a Chinese mobile communication service
provider within Beijing. Every time users make a phone call, there is a connection to a
base station, which generates a record with a location and a timestamp. The dataset
contains 10,000 users and 155,851 records in total during one day (2016.12.27). A total of
12,550 mobile phone base stations have been involved with station IDs varying from 1
to 20,713. The original ﬂow map of Beijing is shown in Figure 4, which seems cluttered
and one can hardly get useful information from it.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2487

Figure 4. The original ﬂow map of Beijing.

4.1. Beijing’s representative stations extraction

A representative stations extraction method is applied to the cell-phone signalling record
data of Beijing. To start the AMG method, the analyst must predeﬁne a parameter, which
is the number of grid levels. First, a level number of 10 is estimated and the AMG method
begins, while ﬁnding the recursion of AMG stops after ﬁve times, so that the speciﬁc grid
level number is set at 5. Then, a 5-level multigrid structure is constructed and it is
represented as {C1, C2,. . ., C5 }. Each level of the coarse grid consists of a set of mobile
phone base stations (Vs) which are treated as the candidates of the representative points
of Beijing. Table 1 shows the numbers of points and percentage in comparison with the
total station numbers at each level of the coarse grid. In the ﬁnest grid C0, the total
number of mobile phone base stations is contained. As shown, nodes in C1 decreased
signiﬁcantly with 1,715 nodes remaining, which is 13.665% of the nodes in C0. The number
of nodes in C2 is 232, which is 1.849% compared with that of C0 and is approximately
13.528% compared with that of C1. Next, there is a decrease in the 3rd, 4th grid until only

Nodes

Table 1. The number and percentage of each grid.
Grid level
C0
C1
C2
C3
C4
C5

12,550
1,715
232
51
12
3

Percentage

100%
13.665%
1.849%
0.406%
0.096%
0.024%

2488

S. WANG ET AL.

three nodes remain in the 5th grid (the coarsest grid). Figure 5 shows how the number of
base stations changes in a geographical space during the recursion. The blue dots
represent the original distribution of all base stations in Beijing, and the pink dots
represent the distribution of base stations in each level of the coarse grid.

Figure 5. The distribution of base stations represented by each layer of coarse grids.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2489

As shown in Figure 5(a), after coarsening, the geographical distribution of the base
stations represented by the 1st grid in Beijing is still very dense, especially in the centre
area. In Figure 5(b) and 5(c), base stations represented by the 2nd and the 3rd grids are
uniform and have a decentralized distribution throughout the entire city. As the grid level
increases in Figure 5(d) (level 4), the number of base stations decreases to 12, and there are
no representative base stations in the northern suburban districts, such as Yanqing district,
Miyun and Huairou. For the last grid in Figure 5(e), there are only three base stations
remaining in the coarsest grid, which are distributed in Haidian, Fengtai and Shunyi districts.
In our prototype, a hierarchy is made to visualize the data at diﬀerent spatial scales, and
user decides which scale should be chosen on his/her needs. For example, in Figure 5, the
nodes in the 4th grid contain enough amount of information while keep the map neat. In
addition, as the 12 representative base stations are almost uniformly distributed in 12 of the
16 districts in Beijing and well represent the overall ﬂow patterns throughout the city, the
4th grid level is chosen in the follow-up experiments.

4.2. Result assessment of the mobile phone stations extraction

Nodes in the 4th grid are used to generate Voronoi cells and after that the study area is
divided into 12 compartments, as illustrated in Figure 6(a). The uniformity of coarse-grid
points allows us to obtain cells of more even sizes and shapes. The regional segmentation
results of the Voronoi diagram, in the periphery of Beijing, show that a base station
represents two suburban districts. These suburban districts are relatively remote in geo-
graphical position and their population is not as dense as the central urban area. For
example, in the northernmost area of Figure 5, the number of original base stations is
small and the distribution is relatively sparse. With PageRank and Degree Centrality algo-
rithm, respectively, top 12 points are located by each measurement, for a fair comparison
among diﬀerent methods (see Figure 6). The points selected by the PageRank method (see
Figure 6b) are more concentrated in the central urban areas (such as Haidian, Xicheng,
Chaoyang) and distributed along the northwest-southeast direction. In addition, the size of
resulting cells appears heterogynous. Meanwhile, the results of the segmentation Degree
Centrality method (see Figure 6c) are also uneven. Furthermore, the presence of ﬁve visually
overlapping pairs of nodes suggests that the nodes are not suitable as representative base
stations. These diﬀerent results also indirectly show that the segmentation based on the
AMG method seems to be more reasonable. Although the traditional methods of evaluating
the importance of complex network nodes can be used to identify the city’s hot spots, their
lacking of distance factor considerations preclude them from being a suitable way to
perceive representatives of the city.

Next, a quantitative evaluation of the nodes extracted by the three methods i.e. DU, SD
and G, are performed here (Table 2). To enrich the comparison, points at the 3rd and the
4th grid levels of the AMG outcome are taken. With AMG, at the 3rd grid level, 51 points
were identiﬁed, and at the 4th level, 12 points. To ensure comparability, the numbers of
points extracted by PageRank and Degree Centrality methods were controlled to be
consistent with the AMG method. In Part I of Table 2, evaluation indices were calculated
with 51 points identiﬁed by diﬀerent methods including AMG. In Part II of Table 2, indices
were calculated with 12 points. The columns represent the three evaluation indices and
the rows show values of the three diﬀerent methods. The results show that AMG performs

2490

S. WANG ET AL.

Figure 6. Regional segmentation of Voronoi cells generated by the AMG method (a) and PageRank
method (b) and degree centrality method (c).

Table 2. Comparison of three extraction methods.
Number of points

Method

DU

I (51 points)

II (12 points)

DC
PR
AMG
DC
PR
AMG

3.472
3.579
8.573
8.244
5.785
16.238

SD

20.012
18.054
73.826
63.206
22.03
133.745

G

40.468
3.033
45.4101
27.285
0.549
2.3250

best in part I as deduced by comparing each column of data. The highest DU and SD
values obtained in AMG are 8.573 and 73.826, respectively. In addition, AMG produced the
highest value (45.410) in G. In part II, the highest DU and SD values were also obtained in
AMG. The DU value of AMG (16.238) was three times that of PageRank (5.785) and twice
that of Degree Centrality (8.244). Larger diﬀerences are reﬂected by a comparison of SD.
AMG produced the highest value of 133.745, which is six times that of PageRank (22.03)
and twice that of Degree Centrality (63.206). However, it should be noted that the G value
of Degree Centrality was very high. The main reason is that the degree of points selected
by the Degree Centrality was high, and the points are more aggregated while ﬁve node
pairs overlapped (Figure 6c). Therefore, the distance between these points is very close,
leading to a high value of G. However, this extreme value represents an over-concentra-
tion of points, which should be removed.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2491

4.3. Human ﬂow visualization of Beijing in one day

With the city segmented into meaningful and natural regions, it becomes possible to
visualize the original large spatial interaction data at a higher abstraction level. After
segmentation described in Section 4.2 Beijing was divided into 12 regions. For each pair
of regions, we calculated a new net ﬂow value with the inﬂow and outﬂow values, which
reﬂect the width of the edges in the ﬂow maps.

A spatial

interaction situation is represented by a ﬂow map (see Figure 7). An
undirected ﬂow map is shown in Figure 7(a). The general feature of the map is that
the central area interacts more frequently than the surrounding area, which is charac-
terized by the high mobility in the central area of Beijing. It can be seen that the main
structure in these areas preserves a hexagonal form with another central node, which is
prominent and strongly links with the hexagon. This suggests that mobility topology in
Beijing corresponds to the social and economic structure of the city with the central area
playing an important role here. In addition, the node closest to the centre has the largest
size and is located in Chaoyang district, which suggests that visits to and from this area
is most frequent throughout the day. At the same time, an interaction between nodes
located in Haidian district is the most frequent. Among others, one interesting discovery
is that each region interacts most frequently with the region closest to it. Reﬂected in
the map is that any node has the thickest edge with the node closest to it, which also
veriﬁes the distance decay eﬀect.

In order to more clearly show ﬂow directions within these regions, a directed
ﬂow map was designed (see Figure 7b). Arrows are used to indicate directions. To
avoid clutter of incoming and outgoing edges at each node, coloured one-sided
arrows are used in the map. The colour of arrow follows the rule: if the endpoint’s x
coordinate value is greater than the starting point’s x coordinate value, the colour
of the arrow is blue, otherwise, orange. In addition, a colour gradient is used in this
design to allow us to focus more on the end of the edge, so that the starting point
of the edge will not appear too crowded. The features reﬂected from the directed
ﬂow map are similar to those of the undirected ﬂow map. However,
it is worth
mentioning that the edge width between any two regions is roughly the same in
diﬀerent directions, which means that the amount of travel between any two
regions is balanced.

Figure 7. Zoom-in ﬂow map of Beijing city.

2492

S. WANG ET AL.

4.4. Flow maps at diﬀerent time periods

By observing the hourly base station activation volume distribution curve (Figure 8),
we divided a day into four parts: t1: [5:00, 10:00), t2: [10:00, 16:00), t3: [16:00, 22:00),
t4: [22:00, 5:00). Four ﬂow maps at diﬀerent time points provide the opportunity to
determine the commonality and diﬀerences between them.

A comparison of the ﬂow maps at four diﬀerent periods is shown in Figure 9. The ﬂow
map of period t4 (Figure 9d) diﬀered signiﬁcantly from that of the other periods. The
ﬂow magnitude and spatial interactions of period t4 was expectedly low compared with
that of the other three periods. This results from the late-night hour being the quietest
time period in the city during which people are barely traveling. In the morning hours
(Figure 9a), people start to move and activities within the central area increase com-
pared to the night hours. Although the ﬂow magnitudes between places are not much,
peoples’ activities have started in all directions. The liveliest time of the day is business
hours (Figure 9b), which has thicker edges than those of the other time periods. Peoples’
calling behaviour and movements increase during the day because work people, and
leisure people gather in the central business districts. It is also interesting to observe
that the ﬂow magnitude between the regions maintains a balance for each pair of
nodes, in which the width of the orange edge remains the same as that of the blue one.
However, in the evening hours (Figure 9c), some of the balance begins to break because
the outgoing ﬂows from the centre node are more than the ingoing ﬂows, and the size
of the node (which is centred in the hexagon structure) becomes smaller than in the
previous period. These results suggest that people move back to home places or other
leisure places.

Based on these observations, the movement patterns in Beijing correspond well
to our background knowledge. Now in Beijing, the majority of people do not live in
the central city. Daily oﬃce workers commute from remote locations into the city
centre at the beginning of each work day, and when the evening comes the
workers return to the suburbs and the original
lively central area then slowly
becomes quiet.

Figure 8. Hourly base station activation volume distribution curve.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2493

Figure 9. Flow map at diﬀerent time periods.

5. Discussion and conclusion

Our paper presents an approach for ﬂow visualization of large trajectory data using the
AMG method. The essence of this method is using AMG to build a hierarchical presenta-
tion of stations from ﬁne grids to coarse grids. To the best of our knowledge, this is the
ﬁrst time that an AMG method has been used in trajectory visualization.
It reveals
essential spatial ﬂow trends and ﬁlters minor ﬂows of the interactions, which signiﬁ-
cantly reduces the amount of clutter in visualization of the interactions. Therefore, the
original data are sequentially reduced (i.e. 12,550 to 1,715 to 232 to 51 in each level and
the running time of AMG method for the dataset is about 6 min). The application
conducted in the previous section indicates that the AMG method is very eﬀective in
data extraction by maintaining the strong connection portion in the graph formed by all
base stations, so that the remaining mobile phone base stations are adequately repre-
sented. Additionally, a comparison between our method and the other two node
evaluation methods (PageRank and Degree Centrality) indicates that AMG has advan-
tages in both spatial distribution and node importance representations. Although the
degree of nodes extracted by our method is not the greatest, the advantages of these
nodes are regionally representative. That is to say, the importance of nodes extracted in
our method are not governed simply by the number of visits in a day, but its spatial
accessibility and relationship with its surrounding stations are also factors we have
considered, which makes them play the role of prime city hubs. When considering the
selection of grid level, the choice is dependent on the size of the area and the number of
trajectories. Together, these factors allow a clear visualization of the results.

2494

S. WANG ET AL.

Unlike the other methods for ﬂow visualization (Guo 2009, Andrienko and Andrienko
2010, Von Landesberger et al. 2016, Andrienko et al. 2017), our approach eliminates a lot of
eﬀorts in parameter setting for reducing the size of trajectory data. Because AMG does not
work like clustering methods (k-means, DB-SCAN, etc.), it can automatically construct a
hierarchical presentation of important nodes. In addition, the multi-scale structure allows us
to analyse the interactions at diﬀerent scales from ﬁne to coarse grid, and the representa-
tive base stations satisﬁes the characteristics of high spatial reachability due to the con-
struction of the strength matrix. Moreover, major ﬂow patterns are extracted and visualized
in multi-style and clear form of ﬂow maps. However, our approach has disadvantages yet
due to the high computational cost in the AMG process, which is also a common problem
in big data studies. To compensate for this, parallel computing should be considered to
speed up the calculation when dealing with a larger amount of trajectory data.

We have tested our approach on cell-phone signalling record data in Beijing. The
result is consistent with conventional wisdom that Beijing has a clear central structure.
The spatial interaction intensity of the central urban area is obviously higher than that of
the surrounding areas. It is also notable that the travel pattern in Beijing is consistent
with the ﬁrst law of geography. Our approach can be applied to any trajectory data such
as people migration, taxi trip data and so on. Further research can consider how to
simplify both the spatial and temporal data based on the AMG method and diversify the
visualization analysis method.

Disclosure statement

No potential conﬂict of interest was reported by the authors.

This work was supported by the National Key Research and Development Plan of China [grant
number 2017YFB0503601].

Funding

ORCID

References

Siying Wang

http://orcid.org/0000-0001-5377-1181

Acton, S.T., 1998. Multigrid anisotropic diﬀusion.

IEEE Transactions on Image Processing A

Publication of the IEEE Signal Processing Society, 7, 280–291. doi:10.1109/83.661178.

Andrienko, G., et al., 2008. Geovisualization of dynamics, movement and change: key issues and
Information Visualization, 7, 173–180.

developing approaches in visualization research.
doi:10.1057/IVS.2008.23.

Andrienko, G., et al., 2017. Revealing patterns and trends of mass mobility through spatial and
temporal abstraction of origin-destination movement data. IEEE Transactions on Visualization
and Computer Graphics, 23, 2120–2136. doi:10.1109/TVCG.2016.2616404.

Andrienko, N. and Andrienko, G., 2010. Spatial generalization and aggregation of massive move-
ment data. IEEE Transactions on Visualization & Computer Graphics, 17 (2), 205–219. doi:10.1109/
TVCG.2010.44.

INTERNATIONAL JOURNAL OF GEOGRAPHICAL INFORMATION SCIENCE

2495

Andrienko, N. and Andrienko, G., 2013. Visual analytics of movement: a review of methods, tools,

and procedures. Journal of Information Visualization, 12 (1), 3–24.

Brandt, A., 1986. Algebraic multigrid theory: the symmetric case. Applied Mathematics and

Computation, 19 (1–4), 23–56. doi:10.1016/0096-3003(86)90095-0.

Brandt, A., Mccormick, S.F., and Ruge, J.W., 1982. Algebraic multigrid (AMG) for automatic multigrid
solution with application to geodetic computations. Fort Colins, CO: Institute for Computational
Studies, Technical report.

Brezina, M., Hu, J., and Tuminaro, R., 2011. Algebraic multigrid. In: D. Padua, ed. Encyclopedia of

parallel computing. Boston, MA: Springer US, 23–33.

Briggs, W.L., Henson, V.E., and Mccormick, S.F., 2000. A multigrid tutorial: second edition.

Philadelphia: Society for Industrial and Applied Mathematics.

Duarte-Carvajalino, J.M., Castillo, P.E., and Velez-Reyes, M., 2007. Comparative study of semi-
implicit schemes for nonlinear diﬀusion in hyperspectral imagery. IEEE Transactions on Image
Processing, 16, 1303–1314.

Ellis, G. and Dix, A., 2006. Enabling automatic clutter reduction in parallel coordinate plots. IEEE
Transactions on Visualization & Computer Graphics, 12 (5), 717–724. doi:10.1109/TVCG.2006.138.
Ersoy, O., et al., 2011. Skeleton-based edge bundling for graph visualization. IEEE Transactions on

Visualization and Computer Graphics, 17, 2364–2373. doi:10.1109/TVCG.2011.233.

Falgout, R.D., 2006. An introduction to algebraic multigrid computing. Computing in Science &

Engineering, 8, 24–33. doi:10.1109/MCSE.2006.105.

Guo, D., 2009. Flow mapping and multivariate visualization of large spatial interaction data. IEEE
Transactions on Visualization and Computer Graphics, 15 (6), 1041–1048. doi:10.1109/TVCG.2009.143.
Guo, D. and Zhu, X., 2014. Origin-destination ﬂow data smoothing and mapping. IEEE Transactions

on Visualization and Computer Graphics, 20, 2043–2052. doi:10.1109/TVCG.2014.2346271.

Guo, H., et al. 2011. TripVista: triple perspective visual trajectory analytics and its application on
IEEE Paciﬁc Visualization Symposium 2011,

microscopic traﬃc data at a road intersection.
PaciﬁcVis 2011––Proceedings, 163–170.

Holten, D., 2006. Hierarchical edge bundles: visualization of adjacency relations in hierarchical

data. IEEE Transactions on Visualization & Computer Graphics, 12 (5), 741.

Holten, D. and Van Wijk, J.J., 2009. Force-directed edge bundling for graph visualization. Computer

Graphics Forum, 28, 983–990. doi:10.1111/cgf.2009.28.issue-3.

Isaacman, S., et al., Identifying important places in people’s lives from cellular network data. ed.

International Conference on Pervasive Computing, 2011, 133–151.

Jenny, B., et al., 2018. Design principles for origin-destination ﬂow maps. Cartography and

Geographic Information Science, 45, 62–75. doi:10.1080/15230406.2016.1262280.

Kimmel, R. and Yavneh, I., 2006. An algebraic multigrid approach for image analysis. Siam Journal

on Scientiﬁc Computing, 24, 1218–1231. doi:10.1137/S1064827501389229.

Lü, L., et al., 2016. Vital nodes identiﬁcation in complex networks. Physics Reports, 650, 1–63.

doi:10.1016/j.physrep.2016.06.007.

Liang, X., et al., 2012. The scaling of human mobility by taxis is exponential. Physica A: Statistical

Mechanics and Its Applications, 391, 2135–2144. doi:10.1016/j.physa.2011.11.035.

Liu, J., et al., 2016. Evaluating the importance of nodes in complex networks. Physica A: Statistical

Mechanics and Its Applications, 452, 209–219. doi:10.1016/j.physa.2016.02.049.

Liu, X., et al., 2015. Revealing travel patterns and city structure with taxi trip data. Journal of

Transport Geography, 43, 78–90. doi:10.1016/j.jtrangeo.2015.01.016.

Liu, Y., Gong, L., and Tong, Q., 2014. Quantifying the distance eﬀect in spatial interactions. Beijing
Daxue Xuebao (Ziran Kexue Ban)/Acta Scientiarum Naturalium Universitatis Pekinensis, 50 (3), 526–
534.

Marble, D.F., et al., 1997. Recent advances in the exploratory analysis of interregional ﬂows in space

and time. Innovations in Geographic Information Systems.

Miller, H.J., 2004. Tobler’s ﬁrst law and spatial analysis. Annals of the Association of American

Geographers, 94, 284–289. doi:10.1111/j.1467-8306.2004.09402005.x.

Papandreou, G. and Maragos, P., 2007. Multigrid geometric active contour models.

IEEE
Transactions on Image Processing A Publication of the IEEE Signal Processing Society, 16, 229–240.

2496

S. WANG ET AL.

Visualization, 2005, 29.

Phan, D., et al., Flow map layout. ed. Proceedings of the 2005 IEEE Symposium on Information

Rae, A., 2009. From spatial interaction data to spatial interaction information? Geovisualisation and
spatial structures of migration from the 2001 UK census. Computers Environment and Urban
Systems, 33, 161–178. doi:10.1016/j.compenvurbsys.2009.01.007.

Stüben, K., 2000. Algebraic multigrid (AMG) : an introduction with applications. Multigrid, 90 (2), 115.
Tobler, W.R., 1987. Experiments in migration mapping by computer. Cartography and Geographic

Information Science, 14, 155–163.

Von Landesberger, T., et al., 2016. MobilityGraphs: visual analysis of mass mobility dynamics via
IEEE Transactions on Visualization and Computer

spatio-temporal graphs and clustering.
Graphics, 22, 11–20. doi:10.1109/TVCG.2015.2468111.

Vrotsou, K., et al., 2011. Exploring city structure from georeferenced photos using graph centrality
measures. Joint European Conference on Machine Learning and Knowledge Discovery in
Databases, 6913 (1), 654–657.

Wang, Z. and Yuan, X., 2015. Visual analysis of trajectory data. Journal of Computer-Aided Design &

Computer Graphics, 27 (1), 9–25.

Weickert, J., 1996. Anisotropic diﬀusion in image processing. B.G.teubner Stuttgart, 16 (1), 272.
Wood, J., Dykes, J., and Slingsby, A., 2010. Visualisation of origins, destinations and ﬂows with OD

maps. The Cartographic Journal, 47, 117–129. doi:10.1179/000870410X12658023467367.

Wood, J., Slingsby, A., and Dykes, J., 2011. Visualizing the dynamics of London’s bicycle hire
and

for Geographic

Cartographica:

International

Information

scheme.
the
Journal
Geovisualization, 46, 239–251. doi:10.3138/carto.46.4.239.

Yang, U.M., 2006. Parallel algebraic multigrid methods – high performance preconditioners. Lecture

Notes in Computational Science & Engineering, 51, 209–236.

Zhang, K., et al., 2013. Evaluation method for node importance in directed-weighted complex
networks based on pageRank. Journal of Nanjing University of Aeronautics & Astronautics, 45 (3),
429–434.

Zhang, Y. 2014. User mobility from the view of cellular data networks. Proceedings - IEEE INFOCOM,

1348–1356.

