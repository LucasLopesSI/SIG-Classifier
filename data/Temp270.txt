This article was downloaded by: [University of Hawaii at Manoa]
On: 24 December 2014, At: 22:28
Publisher: Taylor & Francis
Informa Ltd Registered in England and Wales Registered Number: 1072954 Registered office: Mortimer
House, 37-41 Mortimer Street, London W1T 3JH, UK

International Journal of Geographical Information
Science
Publication details, including instructions for authors and subscription information:
http://www.tandfonline.com/loi/tgis20

Vectorial algebra algorithms for calculating terrain
parameters from DEMs and solar radiation modelling
in mountainous terrain
Javier G. Corripio a
a Centre d'Etudes de la Neige, Météo France/CNRM, 1441 rue de la piscine, 38406 St
Martin d'Heres, CEDEX, France
Published online: 03 Dec 2010.

To cite this article: Javier G. Corripio (2003) Vectorial algebra algorithms for calculating terrain parameters from DEMs
and solar radiation modelling in mountainous terrain, International Journal of Geographical Information Science, 17:1,
1-23, DOI: 10.1080/713811744

To link to this article:  http://dx.doi.org/10.1080/713811744

PLEASE SCROLL DOWN FOR ARTICLE

Taylor & Francis makes every effort to ensure the accuracy of all the information (the “Content”) contained
in the publications on our platform. However, Taylor & Francis, our agents, and our licensors make no
representations or warranties whatsoever as to the accuracy, completeness, or suitability for any purpose of
the Content. Any opinions and views expressed in this publication are the opinions and views of the authors,
and are not the views of or endorsed by Taylor & Francis. The accuracy of the Content should not be relied
upon and should be independently verified with primary sources of information. Taylor and Francis shall
not be liable for any losses, actions, claims, proceedings, demands, costs, expenses, damages, and other
liabilities whatsoever or howsoever caused arising directly or indirectly in connection with, in relation to or
arising out of the use of the Content.

This article may be used for research, teaching, and private study purposes. Any substantial or systematic
reproduction, redistribution, reselling, loan, sub-licensing, systematic supply, or distribution in any
form to anyone is expressly forbidden. Terms & Conditions of access and use can be found at http://
www.tandfonline.com/page/terms-and-conditions

. .   , 2003
. 17, . 1, 1–23

Research Article

Vectorial algebra algorithms for calculating terrain parameters from
DEMs and solar radiation modelling in mountainous terrain

JAVIER G. CORRIPIO
Centre d’Etudes de la Neige, Me´te´o France/CNRM, 1441 rue de la piscine,
38406 St Martin d’Heres, CEDEX, France

(Received 24 July 2001; accepted 13 May 2002)

Abstract. Terrain parameters derived from digital elevation models (DEMs),
such as slope gradient, aspect and cell surface area, are represented as a vector
normal to the surface and calculated using the minimum areal unit of the DEM,
that is enclosed between four data points. The position of the Sun is calculated
by applying rotational matrices to a unit vector deﬁned at noon as a function of
latitude and declination. The direct component of insolation intercepted by the
cell surface is then calculated as a dot product between the unit vector in the
direction of the Sun and the unit vector normal to surface, multiplied by direct
normal irradiation. Hillshading is computed by scanning the projection of cells
onto a solar illumination plane perpendicular to the Sun direction. Horizon angles
and estimated sky view factor are calculated using a more economical algorithm
than a rigorous evaluation of all the angles subtended by every grid cell to each
other. The performance of the slope algorithm is evaluated using a synthetic
surface and real world examples are given for the Mont Blanc Massif, in the
French Alps.

1.

Introduction
Digital elevation models (DEMs) are mathematical models of the Earth’s surface
that, at present, are the most powerful method of representing relief (Stocks and
Heywood 1994). They are extensively used in environmental modelling and play an
important role in geographic information systems (GIS).

Terrain parameters such as slope gradient and orientation of slope (aspect) are
important controls in a number of surface processes, such as water runoﬀ, erosion
(Moore et al. 1993) and incoming solar radiation (Nun˜ ez 1980, Barry 1992). These
factors alone or combined are major controls in biological, glaciological and geo-
morphological processes, and thus have a decisive inﬂuence in biodiversity (Kumar
and Skidmore 2000), tree line height (Kirckpatrick and Nun˜ ez 1980), human settle-
ment, fauna distribution (Stefanovicˇ and Wiersema 1985), tourism and recreation
(e.g. ski slopes), local climatic conditions (Barry 1992), snow line and glacier mass
balance (Willis et al. 1998, Brock et al. 2000).

It is therefore understandable that considerable eﬀort has been expended in
developing fast and eﬃcient algorithms to calculate the gradient of the surface from
DEMs (Skidmore 1989) and the variation of surface solar radiation with topography

International Journal of Geographical Information Science
ISSN 1365-8816 print/ISSN 1362-3087 online © 2003 Taylor & Francis Ltd
http://www.tandf.co.uk/journals
DOI: 10.1080/13658810210157796

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 2

J. G. Corripio

(Williams et al. 1972, Nun˜ ez 1980, Dozier and Frew 1990, Duguay 1995, Varley et al.
1996, Kumar et al. 1997).

Mountainous terrain is characterized by irregular and rapid changes in elevation
over short distances. It is an environment where thresholds play an important role,
for example in the inﬂuence of slope on landslides or avalanches (Wadge 1988,
Dakhal et al. 2000). It is desirable to derive terrain parameters for these regions
using algorithms that retain real extreme values minimizing any smoothing eﬀect.
Many methods for calculating slope from DEMs are based on a 3×3 kernel or
‘roving window’ displaced along the grid cells (Evans 1980, Horn 1981, Zevenbergen
and Thorne 1987, Skidmore 1989). This approach has the advantage of minimising
the eﬀect of data errors in general, as it takes into consideration the 8 surrounding
points to a given one (Horn 1981). However, as Hodgson (1995) has shown, the
undesirable side eﬀect is the computation of the slope for an equivalent area of up
to twice the cell size. These methods also tend to underestimate slope on rough
terrain and in coarse resolution grids (Chang and Tsai 1991, Gao 1997). According
to Hodgson’s (1995) work, the most accurate algorithms for the combined estimation
of surface and slope are those which use the four nearest neighbour elevations in
the grid. On most applications a compromise will be required between the original
data quality and the accuracy or degree of smoothing of slope calculation algorithms.
By using just one cell, the user keeps the ﬁnal decision, as to whether the results are
reliable or it is advisable to perform any further ﬁltering or smoothing.

This paper presents an algorithm for calculating the gradient of the surface using
the minimum areal unit in a DEM, that of the surface enclosed between four data
points. To avoid confusion by the diﬀerent deﬁnitions of the word gradient (Burrough
1986, p. 50), when used alone in this paper it refers to the mathematical deﬁnition,
and in this particular case, the gradient is deﬁned as a three dimensional unit vector
perpendicular to the surface. From this vector slope and aspect can be calculated,
although this step is unnecessary for solar radiation modelling using the Sun
position algorithm derived here. The Sun position is deﬁned as another unit vector
in its direction, and thus, ﬁnding the angle between the Sun and the normal to sur-
face is equivalent to ﬁnding the solution to a dot product between both vectors.
These algorithms make optimal use of the array handling power of modern
computer programming languages, allowing fast implementation and running times.
Furthermore the concept is easy to grasp and visualize.

2. Vector deﬁning an inclined surface

i,j

i,j

, z

, z

, z

i+1,j

i+1,j+1

, where z

We consider the smallest surface unit in a regularly gridded DEM as the plane
enclosed by four data points: z
is the elevation of
i,j+1
a point at row i, column j (see ﬁgure 1). Although it would be possible to extend the
surface division into a triangular mesh (Wang et al. 2000a), we prefer to keep the
cell as the surface area unit for compatibility with other applications, such as raster
information extracted from orthorectiﬁed photographs or satellite images, and for
compatibility with existing models in glaciology, hydrology or snow studies, which
are cell based (Arnold et al. 1996, Richards et al. 1996, Purves et al. 1998). It is also
unreliable interpolating values from the interior of a cell in mountain areas, character-
ized by non-uniform change. However, as a plane is deﬁned by three points in space,
then the four points at the corners of the grid cell may delimit more than one single
plane. As the resolution of the data does not permit deﬁning the geometry of the
area enclosed, a good approximation is to ﬁnd an average between the two triangles

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

3

Z

n 

c

d

b

a

zi,j+1

zi+1,j+1

zi,j

zi+1,j

Y

X

Figure 1. Vector normal to a grid cell surface. Vector n is the average of cross products a×b
and c×d. Its length approximates the surface area of the grid cell with accuracy
depending on resolution.

at both sides of the cell diagonal. It can be shown that the result is the same
whichever diagonal we choose. A vector normal to these surfaces is deﬁned by half
the sum of cross products of vectors along the sides of the grid cell, deﬁned as in
equation (1). In ﬁgure 1 these triangular surfaces are comprised between vectors ab
and cd. The gradient will be the average of cross products a×b and c×d. Ritter
(1987) has previously used a vector based approach, although the approach taken
in this paper diﬀers in the selection of points to compute the slope and in the
subdivision of the cell into two planes. The computation of surface area is also a
new addition.

The resulting vector of a cross product has the length of the parallelogram whose
sides are the vector factors. Thus, the modulus of the vector normal to surface
calculated in this way will approximate the value of the surface area of the grid cell
with accuracy proportional to the resolution of the grid.

In a regular square grid of cell size l, as in ﬁgure 1, the x, y, z components of the

vectors along the side of the grid cell are deﬁned as:

),

Ga=(l, 0, Dz

a
b=(0, l, Dz
),
b
c=(−l, 0, Dz
c
d=(0, −l, Dz

with Dz
with Dz
), with Dz
), with Dz

a

=z
=z
b
=z
=z

c

−z
−z
+z
−z

i+1,j
i,j+1
i,j+1
i+1,j

i,j
i,j+1
i+1,j+1
i+1,j+1

d

d

(1)

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 4

J. G. Corripio

The vector normal to the grid cell, n, will be:

n=

(a×b)
2

+

(c×d)
2

=

1

2K i

l

0

K+

1

2K i

j

k

−l
Dz
0
0 −l Dz

K

c

d

j

k

0 Dz
l Dz

a

b

Simplifying the result of equation (2) gives the components of the vector normal to
surface in terms of grid elevation points and cell spacing as:

n=A1/2 l(z

1/2 l(z

−z
+z

i,j

i,j

i+1,j
i+1,j

+z
−z
l2

−z
−z

i,j+1
i,j+1

i+1,j+1
i+1,j+1

)

)

B

The surface area of this cell will be |n|, the length of vector n. The unit vector in

the direction of n will be denoted n

.

u

This algorithm makes optimal use of the array handling capabilities of many
computer languages and can be implemented very eﬃciently. The CPU time used
for processing a DEM of about 250 000 cells, implementing the algorithm in IDL,
on a Sun Enterprise 450 workstation was about 0.5 seconds excluding data input,
and another half a second for the computation of the corresponding unit vectors
and the area of every cell. Figure 2 shows a grey-scale representation of every
component of the vector gradient for a DEM of the Mont Blanc Massif, French
Alps, while ﬁgure 3 shows the derived aspects.

If the slope and aspect of the surface need to be used, these can be calculated

from the components of n

as follows:

u

uz

where z is the slope and n

is the z coordinate of vector n
The aspect w is not deﬁned for slopes of 0°, a vertical vector gradient. In any
other case it can be calculated from the x, y components of n
. To make the
gradient vector compatible with the Sun vector, a left handed coordinate system has
been chosen, with the X-axis (columns) increasing eastwards and the Y-axis (rows)
increasing southwards. Counting clockwise from north, the aspect would be:

u

u

.

z=cos−1 n

,

uz

w=

+tan−1

p
2

n
n

.

uy
ux

u

lies on the Y-axis (n

The sign of the coordinates needs to be taken into account to decide in which
quadrant the vector lies. The tangent is not deﬁned when the horizontal projection
=0) and it is ambiguous when it lies on the X-axis.
of n
ux
could be used (Horn 1981).
Alternatively, a ratio between the sine and cosine of n
The above coordinate system is a mirror image of those commonly used in DEMs,
with the Y-axis increasing northwards. To apply equation (5) in this case we only
need to invert the y-coordinate of vector n
. The graphic visualisation of these results
are shown in ﬁgures 2(c) and 3.

uxy

u

(2)

(3)

(4)

(5)

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

5

(a)

(b)

(c)

Figure 2. Relative grey-scale representation of the values of coordinates x, y, z for the vector
normal to surface in a digital elevation model of the Mont Blanc Massif. To make the
coordinates agree with solar position convention, white is a high positive eastwards,
southwards and upward component. The grid is 338 columns by 444 rows, with a
resolution of 50 m (16.9×22.2 km). The inverted Y -shaped feature in the lower centre
is the Mer de Glace, the largest glacier in the French Alps. The sharp border on the
right and lower areas is the national boundary plus a buﬀer area, as the relief of Italy
and Switzerland is not shown, and the main valley running NE to SW is the Valley
of Chamonix. North is up.

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 6

J. G. Corripio

Figure 3. Relative grey-scale representation of surface aspects in the Mont Blanc DEM.
White is North-east and black is South-west.

3. Vector deﬁning the position of the Sun

The vector in the direction of the Sun can be calculated from the solar azimuth
and zenith angles (Horn 1981, Paterson et al. 1985, Wang et al. 2000b), and these
angles can be calculated using spherical trigonometry (Nautical Almanac Oﬃce
1974, Iqbal 1983). However, for completeness and consistency with the vectorial
approach, a new procedure is explained here. We deﬁne a topocentric coordinate
system as an orthogonal reference system with origin at the observer position on

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

7

the surface of the Earth (ﬁgure 4). To follow the conventions normally used in solar
radiation studies regarding the position of the Sun (Iqbal 1983, p. 15), the coordinate
axes are deﬁned as follows:

$ the X-axis is tangential to the Earth’s surface in direction East–West and

positive eastwards;

$ the Y-axis is tangential in direction North–South and positive southwards;
$ and the Z-axis lies along the Earth’s radius and is positive upwards.

By deﬁnition, the Sun lies on the ZY-plane (i.e. it is on the vertical plane) at
noon local apparent time (LAT). At this time, the x-coordinate of a unit vector
pointing to the Sun (solar vector from now on) will be null. The solar declination
(d) is the angle between the solar rays and the plane of the Earth’s equator. The

1

Figure 4. Rotation of the topocentric coordinate system XYZ at angle v, from time t

to
time t
. This movement can be decomposed in three rotations: (i) rotation around
axis X at angle c=p/2−Q, where Q is the latitude; (ii) rotation around axis Z at angle
v; and (iii) rotation back around axis X at angle −c. Translation is ignored as the
maximum parallax of the Earth is 8.8 seconds of arc (Nautical Almanac Oﬃce 1974),
and therefore negligible for most solar radiation applications.

0

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 8

J. G. Corripio

geographical latitude (Q) is the angle between the radius of the Earth at the observer
position (that is the Z-axis in our coordinate system) and the equatorial plane. Thus,
the solar vector, s

, at noon LAT will be:

0

=(0, sin(Q−d), cos(Q−d)).

s

0

(6)

At any given time t, the Earth will have rotated away from noon at hour angle
v at an angular speed of 2p radians or 360° per day. The hour angle is the angle
between the observer meridian and the solar meridian, the convention is that v is
zero at noon and positive before noon (Iqbal 1983, p. 15). At this time the topocentric
coordinate system will have changed position in relationship to the Sun at noon.
This movement can be decomposed in three rotations (see ﬁgure 4): one around the
X-axis, to place the Z-axis parallel to the axis of rotation of the Earth; a second
rotation around the Z-axis at angle v and a third rotation back around the X-axis
to the observer position. To ﬁnd the coordinates of the solar vector in the new,
rotated reference system we multiply the original coordinates by three rotational
matrices describing these movements. For a brief description of rotational matrices,
a common procedure in computer graphics, see for example Foley et al. (1990) and
related references. Thus, at any time, and assuming no atmospheric refraction, the
solar vector s will be:

s=r

(c)r

(v)r

(−c)s

x

z

x

,

0

where r is a rotation matrix around axis in subscript and angle in brackets, c is the
angle between Earth’s axis and the topocentric coordinate system Z-axis, and the
hour angle v is zero at noon and has the following value in radians at any time t
(LAT) given in hours and decimal fraction:

v=pA t

12

−1B

In matrix notation:

s=A1

0

0

0

0

1BA1
cos cBAcos v −sin v 0

cos v

sin v

0

0

0

0

0

cos c −sin c
sin c

0

0

cos (−c)BAs

s

cos (−c) −sin (−c)
sin (−c)

B

0x
s

0y

0z

This rotation of the Earth also involves a translation of the deﬁned reference
, but the maximum parallax of the Earth is 8.8◊ of arc (Nautical Almanac
system, s
Oﬃce 1974), that is 4.4◊ if we take as reference noon for the hour angle. This is
much smaller than the precision of other quantities involved, so the extra computa-
tional eﬀort to account for this translation can be saved for most applications.

0

This equation can be fed directly into most programming languages, simplifying
the programming eﬀort, or can be solved for every coordinate (see Appendix A). In
this case, the values for the x, y, z coordinates of the solar vector would be:

(7)

(8)

(9)

(10)

cos Q cos v cos d+sin Q sin dB
s=A

−sin v cos d
sin Q cos v cos d−cos Q sin d

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

9

From this equation, the solar zenith angle h can be calculated as:

and the solar azimuth w as:

h=cos−1 s

,

z

w=

+tan−1

p
2

s
s

y
x

where s

, s

and s

are the coordinates of the solar vector.

x

y

z

Due to the obliquity of the ecliptic, the declination can change from −23° 26∞ 12◊
at the winter solstice (Northern Hemisphere) to +23° 26∞ 12◊ at the summer solstice,
with a variation of less than 10◊ over the next 20 years due to precession and nutation
in the obliquity of the ecliptic and to general precession of the longitude of the Sun
(Nautical Almanac Oﬃce 1974). Calculating the declination is not a trivial problem,
as its value is aﬀected by long-term orbital changes (i.e. at Milankovitch time scales)
and by the interaction with the Moon and other planets.

Many authors have given diﬀerent solutions to the problem of ﬁnding the
solar declination with diﬀerent degrees of accuracy (Spencer 1971, Walraven 1977,
Page 1986). Here a Fourier series approximation derived by Bourges (1985) that
estimates the declination with a mean error of 0.008° and a maximum error of 0.02°
is used. Bourges explains clearly the procedure and astronomical assumptions, so
that the series can be corrected for the required epoch. For the present day, we
have:

d=0.3723

+23.2567 sin D−0.758 cos D

+0.1149 sin 2D+0.3656 cos 2D

−0.1712 sin 3D+0.0201 cos 3D,

D=(360/365.25)×(J−79.346),

where D is the day number:

(11)

(12)

(13)

(14)

and J is the Julian day, 1 on the ﬁrst of January and 365 on the 31st of December
(more strictly, the diﬀerence between the Julian day in consideration and the Julian
day on January the ﬁrst at noon for that given year, plus 1).

The maximum daily variation in declination is less than 0.5° of arc at the
equinoxes and less than 1 minute of arc at the solstices (Spencer 1971), thus, when
accuracy to the nearest degree is required, a single value of d can be used over a
whole day, with considerable simpliﬁcation in the calculations. To keep within an
error similar to that of the selected method of calculating declination, the coordinates
of the Sun vector at noon (s
) can be recalculated every time, adding to the day
number t/24 days, where t is the number of hours from noon LAT.

0

In order to integrate the amount of solar radiation over the whole day, it is
necessary to know the duration of daylight and therefore the time of sunrise and

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 10

J. G. Corripio

sunset. Astronomical sunrise and sunset will occur at the time when the z coordinate
of the Sun vector equals zero. Thus, solving for z in equation (10):

z=cos Q cos v cos d+sin Q sin d=0,

gives:

cos v=

−sin Q sin d
cos Q cos d

,

v=cos−1(−tan Q tan d),

(15)

(16)

(17)

which is the absolute value of the hour angle at sunrise or sunset. Note that this
solution is in agreement with the results derived following spherical trigonometrical
equations (e.g. Iqbal 1983, p. 16).

The sunrise will be at t=12(1−v/p) hours and the sunset at t=12(1+v/p). The
day length will be 2v2p/24. The equation has no solution if |−tan Q tan d|>1, in
this case, if the latitude has the same sign of the declination, that is, Q/|Q|=d/|d| it
is the polar day, and if they are of diﬀerent sign then it is the polar night. These
equations do not take into account the height of the observer above the horizon
or crepuscular diﬀuse solar irradiation: for a detailed treatment of the astronomical
parameters involved in this case, see the Nautical Almanac Oﬃce (1974).

3.1. Angle of incidence of the Sun on inclined surfaces

The fraction of light intercepted by the inclined surface will be proportional to
the cosine of the angle between the normal to the surface and the sun rays. Having
calculated a unit vector gradient normal to the surface and a unit vector in the
direction of the Sun, the dot product of both gives the cosine of the angle between
them; thus the angle between the Sun and the normal to surface, h

is:

h

s

=cos−1(s · n

)

u

s

(18)

Figure 5 shows the application of these algorithms to produce a map of solar
radiation over an area of high relief, the Mont Blanc Massif in the French Alps.
Incoming solar radiation was modelled for clear skies at 15-minute intervals from
sunrise to sunset at the time of the spring equinox, following an updated parametric
model based on Iqbal (1983). Irradiation at every grid cell is evaluated according
to the angle of incidence of the Sun and the shading of surrounding terrain as
described in §4. Diﬀuse incoming solar radiation is evaluated according to the
hemispherical portion of sky visible from every grid cell as described in §5.

4. Shaded relief

The Sun can be considered as a point light source at inﬁnite distance, and thus,
all illumination rays arriving at a grid can be considered parallel. For computational
convenience we consider an ‘illumination plane’ perpendicular to the solar rays
(ﬁgure 6). All solar rays traverse this plane at a right angle. By checking the projection
of a grid cell over this plane, following the direction of the Sun, we can determine
whether a point is in the Sun or in the shade of another cell. In ﬁgure 6 this is
illustrated for a two-dimensional example: the projection of P
, has a
value higher than any previous one (as it is the ﬁrst point to be scanned), so it is in
the Sun. Similarly for P∞
has a lower value than P∞
, however, P∞
and therefore
4
3
2
is in its shadow. The projection of a point P∞
on the solar plane SP is the dot product
i
, which is a vector in the direction of the
of the vector OP

, that is, P∞
1

and the unit vector s

and P∞
3

1

i

p

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

11

Figure 5. Colour coded map of insolation received at the Mont Blanc Massif at the spring
equinox. Incoming solar radiation is modelled for clear skies at 15 minutes interval
from sunrise to sunset following Iqbal’s (1983) parametric model. Incident solar
radiation for every grid cell is evaluated according to the angle of incidence of the
Sun and the shading of surrounding terrain. Diﬀuse incoming solar radiation is
evaluated according to the hemispherical portion of sky visible from every grid cell.
Reﬂected radiation from surrounded terrain is not computed. Values range from 2.2
to 29.96 M Jm−2.

plane SP and perpendicular to the solar vector s. A cell will shade itself if the angle
between the Sun and the vector normal to the cell’s surface is higher than p/2.

By scanning the grid across the Sun path, we can determine which cells are
shaded or not by comparing their projection values. In order to speed up the
implementation of the algorithm, an array of cells is deﬁned for every cell on the
Sun side of the grid border. The length of this array is given by the ﬁrst intersection
of a line along the vector opposite to the Sun and the DEM boundaries. The x, y
position of the cells under consideration in the original grid are estimated by integer
increments of the vector opposite to the Sun for the largest x, y coordinate. Figure 7

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 12

J. G. Corripio

Z

SP

P'3

P'4

sp

P'2

P'1

s

O

P1

P2

P3

P4

X

Figure 6. Hillshading. As the Sun can be considered as a point source at inﬁnite distance,
all solar rays are parallel and cross the plane SP perpendicularly. By checking the
projection of a grid cell over this plane we can determine whether a point is in the
, that is P∞
Sun or in the shade of a previous cell. In the ﬁgure the projection of P
,
1
has a value higher than any previous one (as it is the ﬁrst point to be scanned), so it
is in the Sun. Similarly for P∞
and
2
therefore is in its shadow. The projection of a point P∞
on the ‘solar plane’ SP is the
i
dot product of the vector OP
, which is a unit vector perpendicular
and the vector s
p
to s, the unit vector in the direction of the Sun.

has a lower value than P∞
3

, however, P∞
4

and P∞
3

1

i

shows the application of the hillshading algorithm to the Mont Blanc Massif DEM.
The Sun is assumed to be at 315° (north-west) and the zenith angle is 45°, an
unrealistic position traditionally chosen to avoid a pseudoscopic eﬀect, that is the
reversal of the relief or valleys appearing like mountains and mountains looking like
valleys when illumination is applied from the south. The image has a minimum
illuminance of 18% to account for diﬀuse radiation and the reﬂected light is mod-
. Computation time was about one-sixth of a second for a
iﬁed according to cos h
grid of 150 000 cells (ﬁgure 7) on an Intel Xeon CPU 2 GHz 523 276 KB RAM and
1.6 seconds on a SunSparc 450.

s

The coordinates of the vectors involved in these calculations for the three dimen-
at column i,

sional case are as follows: the vector from the origin to any point P
row j is:

i,j

the elevation of cell at i, j. For simplicity we assume
where l is the cell size and z
that the solar plane crosses the grid at the origin (0, 0, 0). The unit vector in the
direction of the solar plane is calculated as a combination of two cross products:

i,j

where the second term is the unit vector perpendicular to the Sun in the horizontal
direction and s

is (XY ) plane. The projection P∞
i,j

of P

xy0

is:

i,j

P

i,j

=(l

, l

, z

i

j

),

i,j

=s×

s

p

s×s
|s×s

| ,

xy0
xy0

=P

P∞
i,j

· s

p

i,j

(19)

(20)

(21)

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

13

Figure 7. Hillshading of Mont Blanc DEM. The incident light is modiﬁed according to the
cosine angle of incidence of the Sun on the slope. A minimum illuminance of 18% is
introduced to account for diﬀuse radiation. Illumination is from the North-west at
45° elevation.

5. Sky view factor

The sky view factor is deﬁned as the hemispherical fraction of unobstructed sky
visible from any point (ﬁgure 8). This is an important parameter for the calculation
of incoming diﬀuse radiation and for the net balance of long wave radiation (Dubayah

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 14

J. G. Corripio

zm,n

zi,j

zp.q

θ

r = sin θ

R = 1

Figure 8. Sky view factor: the fraction of sky visible from any point is evaluated as the ratio
of the projected area of the visible hemisphere to the area of the base of a unit sphere.
The ﬁgure illustrates the calculation for a given cell z
with visibility obstructed by
neighbouring cells z
and z
, where the portion of visible sky is the shaded area.
The sky view factor will be r2/R2=r2=sin2h:, where h: is the average zenithal angle
for all azimuth directions. Note that for clarity in the illustration the projected visible
surface area is selected only for two points and not for the average, thus the resulting
geometry is an ellipse instead of a circle.

m,n

p,q

i,j

and Rich 1995, Duguay 1995, Varley et al. 1996). The complementary parameter,
‘ground view factor’, is important in the evaluation of diﬀuse and multiple scattered
short wave radiation, especially in areas of high albedo, like snow covered mountains,
as well as for the long wave radiative budget (Olyphant 1986a, 1986b, Greuell et al.
1997). It is also important in other ﬁelds, such as cosmogenic dating, in order to
evaluate the topographical shielding from cosmic radiation (Dunne et al. 1999). It
is a common practice to measure the zenithal angle of the horizon at a given azimuth
interval and then average for all the compass directions to compute the ratio of
visible hemisphere to the whole hemisphere (Nun˜ ez 1980, Dozier and Frew 1990).

Following the unit-sphere method (Iqbal 1983, p. 298) the sky view factor is
evaluated as the ratio of the projected surface of the visible part of the hemisphere,
to the area of a whole hemisphere of unitary radius (ﬁgure 9). The radius of the
projection of the visible part of the hemisphere is equal to the sine of the average

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

15

Figure 9. Relative grey-scale representation of sky view factor for the Mont Blanc DEM.
Dark areas have lower sky visibility, while white ones, such as higher ridges, have
unobstructed visibility of the upper hemisphere. Values range from 0.5 to 1, with the
lowest value corresponding to the steepest slope, 81°, on the western face of Les Drus,
centre right of the image.

zenithal angles in all azimuth directions. Here a variation of the hillshading algorithm
described above is used to ﬁnd the horizon zenithal angles for selected azimuths. By
repeating the shading algorithm from a given azimuth direction in decreasing steps

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 16

J. G. Corripio

of elevation values, we can ﬁnd the horizon angles for every cell in that direction:
this angle will be complementary to the current elevation angle at the cell’s transition
from Sun to shadow. The initial elevation value need not be higher than the maximum
cell slope in the grid. This is repeated at the required azimuth interval over 360° and
the results averaged. Thus the ratio of the two surfaces (visible and unobstructed
hemispherical planar projections) will be:

v=

pr2
p

=sin2h:,

(22)

where v is the sky view factor, r is the radius of the circle corresponding to the
planar projection of the visible sky and h: is the average zenithal angle of the
surrounding horizon.

A typical calculation for a terrain with slopes up to 45° and at 15° azimuthal
intervals will require 45×24×N operations if N is the number of cells in the DEM,
which is considerably faster than the N2 operations required for a rigorous estimation
of all the angles subtended by every cell with any other cell in the grid.

Averaging h: implies the assumption of isotropy in the diﬀuse radiation ﬁeld,
which is an unrealistic simpliﬁcation. If this were not acceptable, the suggested
algorithm can be used to store horizon angles at any given direction, at the expense
of more memory requirements. For a rigorous evaluation of the inﬂuence of sur-
rounding terrain on the radiation falling on any cell, it would be necessary to perform
a viewshed analysis, rather than the simpliﬁed parameter ‘ground view factor’. This
point is not addressed here, but the reader is directed to the work of Wang et al.
(2000a), which is probably the most eﬃcient viewshed algorithm to date.

Dozier et al. (1981) have developed a very eﬃcient algorithm for the calculation
of local horizons that can be applied to the calculation of casted shadows. The
shading algorithm in this paper might be more suitable for the calculation of shades
at a limited number of illumination angles, as it is fast and does not need to store
horizon information for every azimuth direction.

6. Comparison with other methods of calculating slope

It is questionable whether a synthetic surface is a valid comparison with real
topography, but it has the advantage of providing error and artifact-free data.
Similar approaches have been used successfully in the past (Hodgson 1995, 1998).
Additionally, by choosing a continuous diﬀerentiable function to generate the
surface, the gradient can be derived mathematically at every point, thus providing
an analytical value for comparison.

A simple trigonometrical function with two terms, one for the base elevation and
a second one to add a surface of rapidly changing relief, was chosen to generate a
DEM of 10 000 cells sampled at regular intervals (ﬁgure 10). The function generating
this surface is:

f (x, y, z)=−cos x cos y−a sin bx sin by+z=0,

(23)

where a and b are constants with values 0.1 and 10 respectively.

The gradient of this function at any point x, y, z is calculated by ﬁnding the
partial derivatives of every coordinate, as shown in appendix B. The results were
compared to those obtained from the algorithms described here and with the output
of a commonly used GIS software that uses a 3×3 kernel algorithm (ESRI 2000).
The software manufacturer refers to Burrough (1986, p. 50, equation 3.4), which is

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

17

Figure 10. Synthetic DEM, a surface of highly variable relief generated by equation (23).
Z values are in the range ±1.07474, horizontal cell spacing is 2p/100 units.

based on Horn (1981, p. 18). Figure 11 shows a scattergram comparing the slope
values. Both algorithms underestimate the slope, although the vectorial algorithm is
closer to the mathematically derived slope, presents less dispersion, smaller root
mean square error, smaller standard deviation and less mean absolute deviation
(table 1). Figure 12 shows a grey-scale representation of the spatial distribution of
errors in the computation of slope for the synthetic DEM.

7. Conclusions

The algorithms described in this work are particularly suitable for surfaces of
high and variable relief such as mountainous terrain. They minimize the area under
evaluation, keeping extreme values with minimum smoothing. The new algorithm
for the computation of the solar position permits straightfoward operation with the
other terrain parameters, expressed as vectors. The main advantages of the algorithms
described are the facility to operate vectors, the consistency of vector representation
for all the procedures involved, easier conceptual visualisation in three dimensions
and optimization of array handling capabilities in computer languages, which results
in a fast and eﬃcient implementation.

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 18

J. G. Corripio

Figure 11. Scattergrams of slope values generated with the algorithm described in this paper
and a 3×3 kernel algorithm compared to the slopes derived mathematically from a
synthetic surface (ﬁgure 10 and equation (31)).

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

19

Table 1. Correlation between slopes derived mathematically from a synthetic surface and
those calculated using the vector algebra algorithm and a 3×3 kernel algorithm.

Algorithm

Math. gradient
Vector algebra
3×3 kernel

Spearman’s rank
correlation

—
0.993804
0.980826

rms

—
0.7089
1.2430

s

—
1.7993
3.2623

Mean absolute
deviation

—
0.8205
1.7720

(a)

(b)

Figure 12. Grey-scale representation of the spatial distribution of errors in the computation
of slope for the synthetic DEM: (a) is between mathematically generated slopes and
vector algorithm, (b) is the diﬀerence with the 3×3 kernel algorithm. Note that
the location of errors is similar but these are accentuated in the right image. Values
range from −2.91 to 3.78 and from −8.19 to 8.12. Neutral grey is no error, darker is
overestimation and whiter is underestimation of slope.

Nomenclature
Symbol Deﬁnition
i
j
k
l
n
n
u
n
x
n
y
n
z
n
xy
s
0
s
d
c

unit vector in the direction of the X-axis
unit vector in the direction of the Y -axis
unit vector in the direction of the Z-axis
grid cell length
vector normal to the grid cell surface
unit vector in the direction of n
x-coordinate of vector n
y-coordinate of vector n
z-coordinate of vector n
projection of vector n on the XY -plane
unit vector in the direction of the Sun at noon LAT
unit vector in the direction of the Sun
solar declination angle
=p/2−Q, angle between topocentric Z-axis (along the Earth’s radius at
the observer position) and the axis of rotation of the Earth

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 20

w
Q
z
h
h:
h
n
v

s

J. G. Corripio

azimuth angle or aspect
latitude
slope gradient
zenith angle
average zenith angle of the horizon in all azimuth directions
angle between Sun and normal to surface
sky view factor
hour angle, zero at noon and positive before noon

Acknowledgments

I would like to express my gratitude to Ross Purves (University of Zu¨ rich) for
lengthy discussions on these topics and for a detailed revision of the draft manuscript.
This paper was written while enjoying a Carnegie Scholarship at the University of
Edinburgh. I am also grateful to the anonymous reviewers for useful and referenced
suggestions that improved the ﬁnal content of this paper.

Appendix
A. Calculation of the solar vector coordinates

As c is the angle between the Z-axis (or Earth’s radius at the observer) and the

Earth axis, it follows:

c=

−Q,

p
2

thus, equation (9) can be expressed as:

s=A1

0

0

0

0

1BA1
sin Q BAcos v −sin v 0

cos v

sin v

0

0

0

sin Q −cos Q
cos Q

0

0
sin Q
0 −cos Q

0

sin QBAs

cos Q

s

0x
s

0y

0z

B

Using the equivalences for the y and z coordinates of s

:

0

=sin(Q−d)=sin Q cos d−cos Q sin d

=cos(Q−d)=cos Q cos d−sin Q sin d

s

0y

s

0z

solving equation (25) and simplifying using sin3=sin−sin cos2 and cos3=cos−
cos sin2, the x, y, z coordinates of the solar vector at hour angle v will be:

(24)

(25)

(26)

(27)

(28)

cos Q cos v cos d+sin Q sin dB.
s=A

−sin v cos d
sin Q cos v cos d−cos Q sin d

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

21

B. Gradient of synthetic surface
The gradient of function:

where a and b are constants is:

f (x, y, z)=−cos x cos y−a sin bx sin by+z=0,

( f (x, y, z)=A∂ f

∂x

∂ f
∂y

i,

∂ f
∂z

kB

j,

Solving the partial derivatives gives the components of this vector

( f (x, y, z)=G(sin x cos y−ab cos bx sin by) i

(cos x sin y−ab sin bx cos by) j
k

H,

and from these, the slope, z, is calculated as:

z=cos−1

( f
z
|( f | .

(29)

(30)

(31)

(32)

References
A, N. S., W, I. C., S, M. J., R, K. S., and L, M. J., 1996,
for a small valley glacier. Journal of

A distributed surface energy-balance model
Glaciology, 42, 77–89.

B, R. G., 1992, Mountain Weather and Climate (London: Routledge).
B, B., 1985, Improvement in solar declination computation. Solar Energy, 35, 367–369.
B, B. W., W, I. C., S, M. J., and A, N. S., 2000, Modelling seasonal and
spatial variations in the surface energy balance of Haut Glacier d’Arolla, Switzerland.
Annals of Glaciology, 31, 53–62.

B, P. A., 1986, Principles of Geographical Information Systems for L and Resources

Assessment (New York: Oxford University Press).

C, K., and T, B., 1991, The eﬀect of DEM resolution on slope and aspect mapping.

Cartography and Geographic Information Systems, 18, 69–77.

D, A. M., A, T., and A, M., 2000, Landslide hazard mapping and its evalu-
ation using GIS: an investigation of sampling schemes for a grid-cell quantitative
method. Photogrammetric Engineering and Remote Sensing, 66, 981–989.

D, J., B, J., and D, P., 1981, A faster solution to the horizon problem.

Computers & Geosciences, 7, 145–151.

D, J., and F, J., 1990, Rapid calculation of terrain parameters for radiation modelling
from digital elevation data. IEEE T ransactions on Geoscience and Remote Sensing,
28, 963–969.

D, R., and R, P., 1995, Topographic solar radiation models for GIS. International

Journal of Geographical Information Systems, 9, 405–419.

D, C. R., 1995, An approach to the estimation of surface net radiation in mountain
terrain data. T heoretical and Applied

areas using remote sensing and digital
Climatology, 52, 55–68.

D, J., E, D., and M, P., 1999, Scaling factors for the rates of production
of cosmogenic nuclides for geometric shielding and attenuation at depth on sloped
surfaces. Geomorphology, 27, 3–11.

ESRI, 2000, Arc Info online documentation ArcDoc Version 8.0.2. Environmental Systems

Research Institute technical documentation, Redlands, California.

E, I. S., 1980, An integrated system of terrain analysis and slope mapping. Zeitschrift fu¨r

Geomorphologie, Suppl-Bd 36, 274–295.

F, J. D.,  D, A., F, S. K., and H, J. F., 1990, Computer graphics,

principles and practice (Reading, Massachusetts: Addison-Wesley).

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 22

J. G. Corripio

G, J., 1997, Resolution and accuracy of terrain representation by grid DEMs at a micro-
scale. International Journal of Geographical Information Science, 11, 199–212.
G, W., K, W. H., and S, P. C., 1997, Elevational changes in meteorological
variables along a midlatitude glacier during summer. Journal of Geophysical Research,
102, 25 941–25 954.

H, M. E., 1995, What cell size does the computed slope/aspect angle represent?

Photogrammetric Engineering and Remote Sensing, 65, 513–517.

H, M. E., 1998, Comparison of angles from surface slope/aspect algorithms.

Cartography and Geographic Information Systems, 25, 173–185.

H, B. K. P., 1981, Hillshading and the reﬂectance map. Proceedings of the IEEE, 69, 41–47.
I, M., 1983, An Introduction to Solar Radiation (Toronto: Academic Press).
K, J. B., and N˜ , M., 1980, Vegetation-radiation relationships in mountainous
terrain: eucaliptus dominated vegetation in the Ridson Hill, Tasmania. Journal of
Biogeography, 7, 197–208.

K, L., and S, A. K., 2000, Radiation-vegetation relationships in a eucalyptus

forest. Photogrammetric Engineering and Remote Sensing, 66, 193–204.

K, L., S, A. K., and N, E. K., 1997, Modelling topographic variation in
solar radiation in a GIS environment. International Journal of Geographical Information
Science, 11, 475–497.

M, I. D., G, J. C., G, L., and K, J. D., 1993, Modelling the spatial
variability of hydrological processes using GIS. In HydroGIS 93: Applications of
Geographic Information Systems in Hydrology and Water Resources Management
(Proceedings of the V ienna Conference, April 1993) (Wallingford: IAMS), IAHS
Publication no. 211, pp. 161–169.

N A O, 1974, Explanatory Supplement to the Astronomical Ephemeris and

the American Ephemeris and Nautical Almanac (London: HMSO).

N˜ , M., 1980, The calculation of solar and net radiation in mountainous terrain (Risdon,

Tasmania), Journal of Biogeography, 7, 173–186.

O, G. A., 1986a, The components of incoming radiation within a mid-latitude Alpine

watershed during the snowmelt season. Arctic and Alpine Research, 18, 163–169.

O, G. A., 1986b, Longwave radiation in mountainous areas and its inﬂuence on the

energy balance of alpine snowﬁelds. Water Resources Research, 22, 62–66.

P, J. K. (editor), 1986, Prediction of solar radiation on inclined surfaces, Solar energy R & D
in the European Community. Series F. Solar radiation data; v. 3, Dordrecht; Lancaster:
Reidel for the Commission of the European Communities.

P, W. A., D, I., and H, R. L., 1985, A theoretical model to determine

solar and diﬀuse irradiance in valleys. Solar Energy, 35, 503–510.

P, R. S., B, J. S., M, W. A., and S, D. E., 1998, The development
of a rule-based spatial model of wind transport and deposition of snow. Annals of
Glaciology, 26, 197–202.

R, K., S, M., A, N., G, A., C, M., T, M., N,
P., B, G., and L, W., 1996, An integrated approach to modelling hydrology
and water quality in glacierized catchments. Hydrological Processes, 10, 479–508.

R, P., 1987, A vector-based slope and aspect generation algorithm. Photogrammetric

Engineering and Remote Sensing, 53, 1109–1111.

S, A. K., 1989, A comparison of techniques for calculating gradient and aspect from
a gridded digital elevation model. International Journal of Geographical Information
Systems, 3, 323–334.

S, J. W., 1971, Fourier series representation of the position of the Sun. Search, 2, 172.
Sˇ , P., and W, G., 1985, Insolation from digital elevation models for mountain

habitat evaluation. IT C Journal, 3, 177–186.

S, A. M., and H, D. I., 1994, Terrain modelling for mountains. In Mountain
Environments and Geographic Information Systems, edited by M. F. Price and
D. I. Heywood (London: Taylor & Francis), pp. 25–40.

V, M. J., B, K. J., and O, H. R., 1996, Modelling solar radiation in steeply

sloping terrain. International Journal of Climatology, 16, 93–104.

W, G., 1988, The potential of GIS modelling of gravity ﬂows and slope instabilities.

International Journal of Geographical Information Science, 2, 143–152.

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 Vectorial algebra algorithms for calculating terrain parameters

23

W, R., 1977, Calculating the position of the Sun. Solar Energy, 20, 393–397.
W, J., R, G. J., and W, K., 2000a, Generating viewsheds without using

sightlines. Photogrammetric Engineering and Remote Sensing, 66, 87–90.

W, J., W, K., and R, G., 2000b, Estimating surface net solar radiation by use
of Landsat-5 TM and digital elevation models. International Journal of Remote Sensing,
21, 31–43.

W, L. D., B, R. G., and A, J. T., 1972, Application of computed global
radiation for areas of high relief. Journal of Applied Meteorology, 11, 526–533.
W, I., A, N., S, M., B, J. M., and H, B. P., 1998, Mass balance
and ﬂow variations in Haut Glacier d’Arolla, Switzerland, calculated using digital
terrain modelling. In L andform monitoring, modelling and analysis, edited by S. Lane,
K. Richards and J. Chandlers (Chichester: Wiley), pp. 343–362.

Z, L. W., and T, C. R., 1987, Quantitative analysis of land surface topo-

graphy. Earth Surface Processes and L andforms, 12, 47–56.

Downloaded by [University of Hawaii at Manoa] at 22:28 24 December 2014 