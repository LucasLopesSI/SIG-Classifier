 

 

 
 

 

 
 

 

 
 

 

 

 
 

 
 

 

Transactions in GIS

, 2008, 12(4): 459–474

XXX 
© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
1467-9671
1361-1682
TGISTransactions in GIS
Blackwell Publishing Ltd
Oxford, UK

Research Article

Research Article
Estimating Shallow Groundwater Recharge and Discharge
Y-F Lin, A J Valocchi and J Wang

A New GIS Approach for Estimating 
Shallow Groundwater Recharge and 
Discharge

Yu-Feng Lin
Illinois State Water Survey and
University of Illinois at Urbana-
Champaign

Jihua Wang
Department of Civil and 
Environmental Engineering
University of Illinois at Urbana-
Champaign

Albert J Valocchi
Department of Civil and 
Environmental Engineering 
University of Illinois at Urbana-Champaign

Abstract
Groundwater  recharge  and  discharge  define  the  relationships  among  groundwater
storage,  precipitation,  evapotranspiration,  and  surface  water.  Understanding  and
quantifying groundwater recharge and discharge is crucial for developing effective
management options for water supply. Traditional recharge and discharge studies usually
require time-consuming (months or years) and labor-intensive field characterization.
Therefore, a fast initial recharge and discharge estimation will help scientists and decision
makers design more accurate and cost-effective research plans and management strategies.
A new GIS based methodology along with an ArcMap plug-in package, PRO-GRADE,
was  developed  to  help  hydrogeologists  estimate  recharge  and  discharge  in  a  more
efficient way than conventional methods. The Groundwater Recharge And Discharge
Estimator (GRADE-GIS) in the PRO-GRADE package uses a mass balance approach
for steady state two-dimensional unconfined aquifers. GRADE-GIS only requires relatively
short preparation time (hours) using readily available data for water table and bedrock
elevations, and hydraulic conductivities. The Pattern Recognition Organizer (PRO-
GIS)  in  the  PRO-GRADE  package  uses  multiple  image  processing  algorithms  to
estimate and visualize shallow recharge and discharge patterns and rates with GIS. The
output of PRO-GRADE can be used as an initial guideline for conventional field study
planning and decision making, or an initial condition for numerical simulations.

Address for correspondence:
Urbana-Champaign, 2204 Griffith Drive, Champaign, IL 61820-7495, USA. E-mail: yflin@uiuc.edu

 Yu-Feng Lin, Illinois State Water Survey and University of Illinois at

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
doi: 10.1111/j.1467-9671.2008.01113.x

 

 

 
 
 
 

 

460

Y-F Lin, J Wang and A J Valocchi

1 Introduction

Groundwater  recharge  and  discharge  are  the  hydrologic  processes  by  which  water  is
exchanged between the saturated zone, unsaturated zone, land surface and atmosphere
(Figure  1).  Arguably  the  most  poorly  understood  flow  paths  in  the  hydrologic  cycle,
recharge and discharge reflect relationships between stored groundwater, precipitation,
evapotranspiration  and  surface  water.  Despite  a  long  history  of  investigation,  the
complex interaction of factors influencing rates and locations of recharge and discharge
remains unclear (Scanlon et al. 2002). Yet the rational management of water resources
requires  estimates  of  recharge  and  discharge.  Although  recharge  and  discharge  are
known to relate to geospatial factors such as surface water distribution, soil types, land
use  and  topography,  the  limitations  of  current  methods  for  estimating  recharge  and
discharge and the importance of these processes within the hydrologic cycle have led the
National Research Council to conclude:

“. . . The  feedbacks  between  soil  water  evaporation,  precipitation,  and  runoff
are  an  integral  part  of  the  hydrological  cycle . . . Currently  our  confidence  in
regional  projections  is  limited  by  our  lack  of  understanding  of  the  processes  and
feedbacks controlling the precipitation-evaporation difference.” (CRC 2003)

“Our  ability  to  quantify  spatial  and  temporal  variability  in  recharge  and
discharge  is  inadequate  and  must  be  improved  given  the  importance  of
groundwater in the hydrologic cycle, the contribution of groundwater to base
flow  in  streams  and  inflow  to  lakes,  and  society’s  reliance  upon  groundwater
for water supply.” (COHS 2004)

With its advanced capacities for processing of geospatial data and for cross-analysis
of datasets, GIS can improve several shortcomings of traditional approaches to recharge
and  discharge  estimation.  First  of  all,  GIS  permits  a  more  thorough  assessment  of
uncertainty  in  recharge  and  discharge  estimations  than  is  possible  with  traditional
approaches. Evaluation of uncertainty is one of the greatest challenges in recharge and
discharge studies and, in fact, in all hydroscience research. Researchers have sought to

Figure 1 Atmospheric  water,  surface  water,  and  groundwater  are  linked,  and  recharge/
discharge  includes  flows  across  the  interfaces  between  these  domains  (from  Illinois  State
Water Survey webpage, http://www.sws.uiuc.edu/docs/watercycle/)

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
, 2008, 12(4)

Transactions in GIS

 

 

 
 
 
 

 
 

 
 

 
 

 
 

 

 
 

 
 

 

 
 

 
 

 
 

 
 

 

 
 

 
 

Estimating Shallow Groundwater Recharge and Discharge

461

identify and characterize sources of naturally occurring uncertainty in order to analyze
and predict it in a systematic manner. While randomness, the lack of direct measurements,
and the limited accuracy of direct measurements are important contributors to uncertainty,
the  most  poorly  understood  contributor  may  be  structural  uncertainty  (IPCC  2005).
Structural uncertainty includes uncertainty resulting from such factors as inadequate or
incomplete conceptual models, model structure, and boundary condition characterization.
To  ascertain  the  effects  of  structural  uncertainty  requires  the  use  of  multiple  methods
accompanied by cross-analysis of results against related observations.

The potential of GIS for efficient processing of geospatial data allows rapid mapping
of  recharge  and  discharge  using  multiple  approaches.  As  mentioned  in  the  previous
paragraph, use of multiple methods is critical to assessing structural uncertainty, but it
is  also  vital  for  establishing  multiple  working  hypotheses  about  the  distribution  of
recharge  and  discharge  in  a  study  area.  Studies  of  rates  and  patterns  of  recharge  and
discharge  frequently  suffer  from  a  failure  to  employ  multiple  methods,  yet  no  single
method can be used to estimate recharge and discharge rates and patterns for all practical
applications (Cherkauer 2004). In fact, traditional recharge and discharge studies usually
rely  on  time-consuming  (months  or  years)  and  labor-intensive  field  characterization.
Furthermore, the delineation of recharge and discharge zones is often based on arbitrary
and subjective decisions that are to some degree based on professional experience (Lin
et al. 2008).

Last  but  not  least,  the  data-processing  capabilities  of  GIS  allows  researchers  of
recharge and discharge to use geospatial and hydrologic data sets made widely available
by advances in remote sensing and other monitoring technologies (e.g. the French ERO
program,  de  Dreuzy  et  al.  2006;  CUAHSI  Hydrologic  Information  System,  http://
www.cuahsi.org/his.html)  and  by  research  institutes  (e.g.  U.S.  Geological  Survey  and
State  Surveys).  The  information  in  these  data  sets  might  have  great  potential  use  in
developing or evaluating alternative conceptual models in hydrological science. Since it
is  difficult  to  directly  measure  recharge  and  discharge,  there  is  great  potential  for  GIS
approaches  (e.g.  the  PRO-GIS  method  in  this  article)  to  improve  indirect  estimation
methods that use geospatial data (e.g. the GRADE-GIS method in this article). Employing
these widely available digital datasets will permit rapid initial estimation and mapping
of  recharge  and  discharge  and  will  help  scientists  and  decision  makers  design  more
accurate  and  cost-effective  research  plans  and  management  strategies  before  initiating
labor-intensive field measurements.

Scientists  at  the  University  of  Illinois  have  developed  a  new  methodology  that
employs widely available GIS datasets to estimate and cross-analyze alternative ground-
water  recharge  and  discharge  models.  The  estimation  and  cross-analysis  utilize  a  mass
balance approach, image processing algorithms, and pattern recognition techniques.

2 Methodology

In many regions, shallow unconfined aquifers are important water sources and undergo
significant  interactions  with  streams,  wetlands,  and  lakes.  Groundwater  flow  in  these
aquifers is described by a form of Darcy’s law which defines one-dimensional flow in a
prism of porous material (Figure 2a) as:

Q

 = 

−

 
K

 
·

 
A

 (
·

 
h
2

−
 

) 
h
1

 
·

1

−
L

(1)

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS

, 2008, 12(4)

 

 

 
 
 

462

Y-F Lin, J Wang and A J Valocchi

Figure 2 (a) Prism of porous material illustrating Darcy’s law (from Harbaugh et al. 2000);
(b) Stoertz and Bradbury (1989) developed a 2D steady state groundwater recharge and discharge
mapping  method  which  modifies  MODFLOW-88  to  compute  a  water  balance  whereby
lateral flow in and out of a cell is balanced by water that enters or leaves via groundwater
recharge or discharge; and (c) grid orientation and notation for numerical computation

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
, 2008, 12(4)

Transactions in GIS

 

 

 
 
 
 

 
 

 
 

 
 

 

 
 

 
 

 
 

 
 

 
 

 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 

 
 

 
 

 
 

 
 

Estimating Shallow Groundwater Recharge and Discharge

463

Q

3
where 
 
l
 is the volumetric flow [
 is the hydraulic conductivity of the material
 
·
1
 
l
  is  the  cross-sectional  area  perpendicular  to  the  flow
A
]; 
in  the  direction  of  flow  [
−
2
h
 
l
 is the head (water table elevation) difference across the prism parallel to flow
 
h
]; 
[
2
1
].
l
 is the length of the prism parallel to the flow path [
L
]; and 
l
[

1
]; 

−
t

K

 
·

−
t

 
·

−
t

2
 
l
[
T

Stoertz  (1989)  and  Stoertz  and  Bradbury  (1989)  developed  a  two-dimensional
recharge  and  discharge  mapping  model  by  modifying  the  finite  difference  FORTRAN
code,  MODFLOW  (McDonald  and  Harbaugh  1988),  to  compute  a  water  balance
(Figure  2b).  That  approach  balances  lateral  flow  in  and  out  of  a  finite  difference  cell
with water entering or leaving via the processes of groundwater recharge or discharge.
The  mapping  method  requires  three  types  of  input  datasets:  water  table  elevation
(hydraulic head), the hydraulic conductivity, and bedrock (aquifer bottom) elevation in
each cell. This technique estimates recharge and discharge rates for each finite difference
1
], as shown in the
cell. This methodology is very sensitive to the transmissivity (
following  equations)  and  water  table  gradient.  The  method  is  also  scale-dependent  in
that a finer grid size results in higher average recharge rates. This is in agreement with
the  findings  of  Stoertz  and  Bradbury  (1989)  who  note:  “Local  flow  systems,  which
account  for  much  of  the  recharge  and  discharge  within  a  basin,  occur  at  all  scales,  so
by using a smaller cell size, one accounts for more local flow and hence more recharge.”
If the grid spacing is too small relative to the spacing between observations, the method
will  fail  due  to  errors  in  the  hydraulic  gradient  between  adjacent  cells  resulting  from
errors in the interpolation of the water table (Figure 2b). This mass balance estimation
method was improved by coupling it with: (1) a pattern recognition approach utilizing
several  algorithms  for  image  processing;  and  (2)  parameter  estimation  procedures  (Lin
2002,  Lin  and  Anderson  2003).  This  recharge  and  discharge  pattern  recognition  and
rate  estimation  procedure  works  well  with  smaller  model  grid  spacings  (80  by  80  m
compared to the 805 by 805 m as finest spacing used by Stoertz and Bradbury in 1989),
allowing for improvement in model accuracy and stability. However, the delineation of
recharge and discharge zones is arbitrary and subjective in the approaches of Lin (2002),
and Lin and Anderson (2003) due to their limited capacity to manage databases.

This study employed current GIS technologies to integrate these approaches into a
seamless,  flexible  interface  with  enhanced  capabilities  for  mapping  and  display  and
advanced image processing tools. This GIS tool has been developed as an ArcMap plug-
in package, Pattern Recognition Organizer and Groundwater Recharge And Discharge
Estimator  (PRO-GRADE),  to  help  hydrogeologists  estimate  recharge  and  discharge
using existing datasets.

2.1 Groundwater Recharge And Discharge Estimator (GRADE-GIS)

GRADE-GIS  uses  the  mass  balance  approach  developed  by Stoertz  (1989)  and  Stoertz
and  Bradbury  (1989).  It  requires  only  three  input  raster  files  representing  hydraulic
conductivity,  water  table  elevation  and  bedrock  elevation  (Figure  3).  These  rasters  are
formatted in advance with an identical projection and coordinate system, raster dimension,
and  total  raster  cell  count.  GRADE-GIS  employs  the  input  rasters  to  estimate  cell-by-
cell recharge and discharge rates in a raster file which is formatted identically with the
input raster files. There are four assumptions in the GRADE-GIS computation:

1. The  groundwater  system  has  horizontal  two-dimensional  flow  under  steady-state

conditions with isotropic hydraulic conductivity.

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS

, 2008, 12(4)

 

 

 
 
 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 

 
 

 
 

 
 

 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 
 

 

464

Y-F Lin, J Wang and A J Valocchi

Figure 3 The  graphical  user  interface  of  Groundwater  Recharge  And  Discharge  Estimator
(GRADE-GIS)

2. There are no source and sink terms except recharge and discharge (i.e. recharge and

discharge are the lump sums for all source and sink terms).

3. The water table elevation is always higher than the bedrock elevation. If the water
table  elevation  is  less  than  or  equal  to  the  sum  of  the  bedrock  elevation  and  the
minimum saturated thickness, the cell is considered an inactive cell (NoData value
in ArcGIS) and will be excluded from computation.

4. Cells in the resultant recharge and discharge raster are assigned NoData values for

the cells having NoData values in any of the input raster files.

As  shown  in  Figure  2b,  if  all  the  finite  difference  cells  are  the  same  size  (which  is
 multiplied by
)  and  out  of
)  in  two-dimensional  space  (Figure  2c),  the
j
,
i
).  Thus,  for  every  raster  cell  (

) for cell 
C
R
C
  area  should  be  equal  to  the  difference  between  the  flow  rate  (
X-Y
Q
Q
(
C 

required for the raster file), the recharge and discharge rate (
its 
cell 
mass balance can be expressed as

CD

BC

 + 

Q

in_north

in_south

 + 

Q

−

Δ

Δ
 = 
y
j
,
i

 
·

 
·

Δ

Q

−
 

 
j
1,

in_east

 + 

h
−
i

x
−
i

in_west

 
x
j
,
i

 = (

 
j
1/2,

 
R
,j
i

 = 
Q
in

Q
Ti−1/2,j · Δyi,j
Q
)/
h
west
_
in
j
,
i
Qin_east = (hi+1,j − hi,j)/Δxi+1/2,j · Ti+1/2,j · Δyi,j
Qin_north = (hi,j+1 − hi,j)/Δyi,j+1/2 · Ti,j+1/2 · Δxi,j
Qin_south = (hi,j−1 − hi,j)/Δyi,j−1/2 · Ti,j−1/2 · Δxi,j

 
·

(2)

(3)

(4)

(5)

(6)
where Δxi,j and Δyi,j are horizontal cell dimensions [l]; Δxi,j and Δyi,j with ±1/2 in i and j
subscripts represent the lengths between centers of cell (i,j) and its four adjacent cells
[l]; Ri,j is recharge and discharge rate of cell (i,j) [l · t−1]; hi,j is the hydraulic head (water
table elevation) of cell (i,j) [l · t−1]; Ti,j is the transmissivity of cell (i,j), Ti,j = Ki,j · bi,j for
an unconfined aquifer [l2 · t−1]; Ti+1/2,j is the harmonic mean of transmissivity between cell
(i  +  1,  j)  and  cell  (i,j)  [l2  ·  t−1];  Ki,j  is  the  hydraulic  conductivity  of  cell  (i,j)  [l  ·  t−1];  and
bi,j is the saturated thickness and equal to hydraulic head minus bedrock elevation [l].
If cell (i,j) is on the boundary, the flow rate from a neighboring NoData cell is equal
to zero. In GRADE-GIS, the user can specify the minimum saturated thickness as equal

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
, 2008, 12(4)

Transactions in GIS

Estimating Shallow Groundwater Recharge and Discharge

465

to or greater than 0.0, as noted previously in assumption 3 (Figure 3). The output raster
file of recharge and discharge rates from GRADE-GIS is format-ready for PRO-GIS, as
described next, which utilizes pattern recognition techniques to identify the recharge and
discharge zones.

2.2 Pattern Recognition Organizer (PRO-GIS)

The Pattern Recognition Organizer (PRO-GIS) in the PRO-GRADE package uses multiple
image  processing  algorithms  to  estimate  and  visualize  recharge  and  discharge  patterns
and  rates  (Figure  4).  Figures  5,  6  and  7  show  recharge  and  discharge  maps  estimated
using  the  FORTRAN  code  of  Stoertz  (1989)  and  the  same  estimates  post-processed
using PRO-GIS. The test dataset is from the Buena Vista Groundwater Basin in Wiscon-
sin  (Stoertz  and  Bradbury  1989).  Patterns  of  recharge  and  discharge  from  previous
estimations are difficult to discern in data that have not been post-processed, which are
noisy  due  to  the  scale  and  sensitivity  problems  described  previously.  PRO-GIS  allows
the analyst to employ multiple image processing algorithms, all of which are organized
into  a  graphical  user  interface  (GUI).  Additional  image  processing  algorithms  can  be
added to the GUI through approaches described in the “Implementation” section of this
article. PRO-GIS can work with three methods of image processing: (1) existing ArcObjects,
(2)  existing  codes  for  traditional  algorithms,  and  (3)  code  written  within  PRO-GIS  to
employ  new  algorithms.  Future  developers  will  be  able  to  use  these  three  methods  to
expand the capabilities of PRO-GIS and tailor the application to the needs of individual
projects.  This  organization  provides  an  efficient  and  systematic  approach  for  scientists
to  analyze  images  by  using  image  processing  methods  and  compare  the  images  with
relevant, but not necessarily quantifiable, ancillary information. For example, recharge

Figure 4 The Graphic User Interface of PRO-GIS with the 2D Moving Average function enabled

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

466

Y-F Lin, J Wang and A J Valocchi

Figure 5 Recharge and discharge map, and image histogram of the Buena Vista Groundwater
Basin,  Wisconsin  generated  by  (a)  the  FORTRAN  code  of  Stoertz  (1989)  and  (b)  following
post-processing  by  normalization  in  PRO-GIS.  The  X  and  Y  histogram  axes  represent  raster
values (recharge and discharge rates) and raster counts (numbers of cells), respectively

and  discharge  are  known  to  be  related  to  surface  water  features,  soil  types,  land  use,
and topography, yet there is no deterministic function to define these relationships. The
current version of PRO-GIS implements three methods of image processing using three
different approaches:

1. 2D Moving Average directly inherits several functions from Neighborhood ArcObjects
in  the  ArcGIS  Spatial  Analyst  Extension.  Based  on  different  2D  window  moving
mechanisms, there are two options in 2D Moving Average: Focal statistics (FocalStatistics)
and Block statistics (BlockStatistics). The neighborhoods in the block statistics function
do  not  overlap,  while  the  neighborhoods  in  the  focal  statistics  function  are  based
around  a  processing  cell  and  always  overlap.  In  a  block  function,  a  block  of  cells
corresponding to the minimum bounding rectangle of a neighborhood receives the
resultant value, while in a focal function only the processing cell receives the resultant
value. For each option, several statistical calculations are available, including Majority,
Maximum,  Median,  Minimum,  Minority,  Range,  Standard  Deviation  (STD)  and
Variety. The default method is Focal Statistics – Median. As shown in Figure 4, the

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

Estimating Shallow Groundwater Recharge and Discharge

467

Figure 6 Recharge  and  discharge  map  and  image  histogram  of  the  Buena  Vista  Ground-
water Basin, Wisconsin generated using the 2D Moving Average process from Figure 5a and
the FocalStatistics and Median functions with various window sizes in PRO-GIS. The X and
Y  histogram  axes  represent  raster  values  (recharge  and  discharge  rates)  and  raster  counts
(numbers of cells), respectively

width and height of the moving window for averaging computations can be speci-
fied  in  the  corresponding  textboxes.  The  window  width  and  height  must  be  equal
to or greater than 2 in order to generate sufficient results. If the Lock Aspect Ratio
of Width and Height checkbox is activated, the width and height will be modified
simultaneously. A larger moving window usually results in a smoother image (Fig-
ure 6) but requires more computation time.

2. Normalization implements normal score transform algorithms based on the existing
FORTRAN code, nscore.f, in GSLIB (Deutsch and Journel 1998). This option trans-
forms the original input data to a normal distribution, which is helpful in reducing the
skewness  of  the  image  histogram  shown  in  Figure  5b.  The  default  parameters  for
numerical computation suggested by Deutsch and Journel were used and no weight
for declustering was applied for cumulative distribution function computation.
3. TVL1  Low  Pass  Filter  is  a  modified  version  of  a  new  algorithm,  Total  Variation
Regularized L1 Function Approximation (TV + L1), which was originally developed
by Chan and Esedoglu (2005). TV + L1 minimizes the total variation of the image

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

468

Y-F Lin, J Wang and A J Valocchi

Figure 7 Recharge and discharge map and image histogram of the Buena Vista Groundwater
Basin,  Wisconsin  generated  using  the  TVL1  Low  Pass  Filter  process  from  Figure  5a  using
Maximum  200  Iterations  with  various  Lambda  values  in  PRO-GIS.  The  X  and  Y  histogram
axes  represent  raster  values  (recharge  and  discharge  rates)  and  raster  counts  (numbers  of
cells), respectively

subject to an L1-norm fidelity term. The main advantages of this algorithm include
edge-preserving  capacity,  simplicity  of  parameter  selection,  minimal  signal  distortion
and  the  flexibility  to  extract  variable  degrees  of  spatial details  (Chen  et  al.  2006).
This  recently  developed  image-processing  algorithm  has  been  applied  in  several
advanced  pattern  recognition  applications  (Yin  et  al.  2005,  Chen  et  al.  2006),
including a current study for identifying human brain anomalies in Magnetic Resonance
Imaging (MRI) scans. TV + L1 includes a high-pass filter for extracting detail features
and a low-pass filter for removing noise and identifying the overall pattern. It min-
imizes  the  total  variation  of  the  image  subject  to  preserving  the  pattern  edge  with
simplified  computational  parameter  selection,  minimal  signal  distortion,  and  the
flexibility  to  extract  variable  degrees  of  spatial  details.  Only  the  low-pass  filter  of
TV  +  L1  was  implemented  in  PRO-GIS,  hence  the  approach  is  called  TVL1  Low
Pass Filter. The approach requires two parameters: Lambda and Max Iterations.

There is an option for Include Normalization and Back Transformation in the TVL1
option (Figure 4) in order to transform the original data into a normal score before the

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

Estimating Shallow Groundwater Recharge and Discharge

469

TVL1  process  and  then  back-transform  to  the  original  range.  This  is  an  option  to
preprocess a dataset with a small number of extreme values and keep the resultant data
range in the same scale as the original data range. Two parameters are needed:

1. Lambda  (λ)  is  the  Lagrange  multiplier.  The  determination  of  lambda  is  based  on

the radius (r) of the pattern desired. For a 2D image, λ = 2/r.

2. Max Iterations is the stop condition of maximum iteration in computation.

In the TV-based framework, an image f is modeled as the sum of image pattern u (low
pass  signal)  and  texture v  (high  pass  signal),  where f,  u  and  v  are  defined  as  functions
in  appropriate  spaces.  Pattern u  contains  background  hues  and  significant  boundaries,
specifically the large-scale spatial patterns identified in PRO-GIS. The remainder of the
image v, which is texture characterized by small-scale oscillation patterns, is not utilized
in  PRO-GIS  because  noise  and  small  artifacts  are  excluded  from  the  result  of
PRO-GIS.

Since pattern u is more regular than texture v, we can obtain u by minimizing the
irregularity measure while being close to f with respect to a fidelity (distance) measure
(Yin et al. 2005). The TV + L1 model was formulated by Chan and Esedoglu (2005) as:

min 

∇
 

u x dx
( )

s t
         . .      

f x
( ) 

u x
  ( )

−

≤

  

σ
 

L1

(cid:2)

Ω

where Ω is the image domain, functions f and u are defined on Ω, and || · || denotes the
dual norm of total variation.

Since the above equation is a convex optimization problem, it can be formulated as

min 

∇
 

u x

( )  

+

λ

 

f x
    ( ) 

−

u x
  ( )

 

dx

]

(cid:2)

[

Ω

where λ is the Lagrange multiplier.

The  first  integral  is  the  regularization  term,  which  disfavors  oscillations  and  is
responsible  for  the  elimination  of  noise  in  noisy  images.  The  second  integral  is  the L1-
norm  fidelity  term,  which  encourages  the  solution u(x)  being  sought  close  to f(x).  The
TV + L1 model keeps the sharp object edges in u because minimizing the TV regularization
term  penalizes  all  intensity  variations  in  a  uniform  way.  Thus  the  decomposition  is
dependent  only  on  the  scale  of  the  pattern  (the  geometric  features)  but  is  independent
of the intensity of the pattern (the contrast of image features) (Chan and Esedoglu 2005).

The value of Lambda can be modified to any positive number less than 1.0. Usually,
a  smaller  value  of  Lambda  will  result  in  a  smoother  image,  with  fewer  details  (and
noise)  being  captured  (Figure  7).  The  output  of  TVL1  should  be  similar  to  the  input
image if Lambda is very close to 1.0 (e.g. 0.99). The value of Max Iterations is arbitrary;
generally 200 or greater should be used for a larger map. Usually, higher values of Max
Iterations  will  require  more  computation  time  but  generate  a  more  accurate  result.
Where  two  different  numbers  of  Max  Iterations,  with  the  same  Lambda  generate  the
same  image,  it  is  likely  that  the  smaller  iteration  number  is  sufficient.  The  PRO-GIS
default values of Lambda and Max Iterations are 0.1 and 200, respectively. If the data
structure  is  distributed  asymmetrically  with  a  few  extreme  values,  the  result  of  TVL1
may look unreasonable. This problem might be compensated by activating the checkbox
of Include Normalization and Back Transformation prior to saving the TVL1 result.

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

(7)

(8)

470

Y-F Lin, J Wang and A J Valocchi

3 Implementation

Both PRO-GIS and GRADE-GIS were coded using Microsoft Visual Basic (VB.NET) in
Microsoft  Visual  Studio  2005.  As  a  convenience  to  users,  PRO-GIS  and  GRADE-GIS
are  packaged  together  in  a  single  installation  program,  PRO-GRADE,  using  the Setup
Project  and  Installer  Class  for  the  Microsoft  Windows  Application  Project  in  VB.net.
PRO-GRADE requires the following preinstalled software: (1) ArcGIS 9.2 with Service
Pack  2,  (2)  ArcMap  Spatial  Analyst  Extension,  (3)  ArcGIS.NET  full  support,  and  (4)
Microsoft.NET  Framework  2.0  or  higher.  PRO-GRADE  can  be  installed  by  running
the  executable  setup  file  downloaded  from  the  Illinois  State  Water  Survey  website  (see
http://www.sws.uiuc.edu/gws/sware/prograde/ for additional details).1 After installation
in  Microsoft  Windows  is  completed,  start  ArcMap  and  then  click  Tools  |  Customize.
PRO-GRADE will be listed in the Categories window under the Commands tab. PRO-
GRADE  will  be  ready  to  use  after  dragging  the  icons  of  PRO-GIS  and  GRADE-GIS
from  the  Commands  window  to  the  ArcMap  toolbar.  In  addition,  the  Spatial  Analyst
extension  must  be  activated  in  ArcMap  in  order  to  utilize  the  2D  Moving  Average
section in PRO-GIS.

As  shown  in  Figures  2b  and  8,  GRADE-GIS  requires  the  inputs  of  water  table
elevation,  bedrock  elevation,  and  hydraulic  conductivity  as  raster  files  which  must  be
formatted  with  an  identical  projection  and  coordinate  system,  raster  dimension,  and
total raster cell count. The input raster files can be selected from a dropdown list or by
clicking Browse. After the Save button of GRADE-GIS is clicked, the resultant recharge
and  discharge  raster  layer  will  be  added  to  the  current  map.  In  addition,  a  text  file
named  recharge.txt,  which  contains  the  recharge  and  discharge  rates  and  coordinates,
will  be  saved  in  the  specified  output  directory.  The  computations  are  performed  in
double-precision  floating  point  number  format,  although  the  raster  files  store  the  data
in single-precision floating point format using scientific notation (Figure 8). If the Cancel
button  is  clicked,  the  GRADE-GIS  GUI  will  be  terminated  without  performing  any
calculation.  GRADE-GIS  will  not  overwrite  an  existing  output  file,  so  the  user  must
specify  a  new  output  file  name  in  the  output  directory.  The  default  symbology  for  the
output  raster  file  is  a  stretched  color  ramp,  but  this  symbology  can  be  modified  in
ArcMap.  The  input  and  output  structures  of  PRO-GIS  and  GRADE-GIS  are  similar
except that the output text file of PRO-GIS is named treatPRU.txt.

Development  of  PRO-GRADE  was  started  with  Microsoft  Visual  Basic  (VB6)  in
Microsoft  Visual  Studio  6.0  and  ArcGIS  9.1  to  leverage  the  numerous  sample  codes
available through the ESRI Developer Network (EDN) for ArcGIS 9.1. VB6 also provides
more programming flexibility than Visual Basic for Applications (VBA) in ArcGIS, despite
the fact that VBA is more convenient for writing a code in the ArcGIS environment. The VB6
code of PRO-GRADE Alpha version was translated to VB.NET in ArcGIS 9.2. The conver-
sion  enhanced  PRO-GRADE  by  embedding  the  greater  variety  of  VB  objects  available
through the Microsoft Developer Network (MSDN) library in order to make significant
improvements to the PRO-GRADE code. For example, an error during execution of
the Alpha version of PRO-GRADE (VB6 code) required that both the GUI of PRO-GRADE
and ArcMap be restarted. Such an error in the current version (VB.NET code) requires only
that the GUI of PRO-GRADE be restarted allowing ArcMap GUI to remain active.

A scrollbar feature was incorporated in both the Alpha and Beta versions of PRO-
GIS  to  illustrate  the  effect  of  parameter  change  in  the  image  processing  algorithms  on
output  rasters.  This  scrollbar  function  (Scrollbar_Keydown)  is  available  to  show  the

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

Estimating Shallow Groundwater Recharge and Discharge

471

Figure 8 Flow chart of PRO-GRADE

effect of changing the window size in the 2D Moving Average and the Lambda values
in  the  TVL1  Low  Pass  Filter.  By  moving  the  cursor  of  the  scrollbar  between  user-
specified  minimum  and  maximum  values,  the  user  can  observe  the  change  in  output
patterns dynamically as the parameters controlling the image processing algorithms are
continuously changed. This dynamic illustration of the effect of changing image processing
parameters can provide the user with key insights for improving the alternative recharge
and discharge maps. Unfortunately, the scrollbar feature only functions smoothly when
the  image  size  is  very  small  due  to  computational  constraints.  We  expect  the  scrollbar
feature will be a feasible addition as computational capabilities improve in the future.

4 Applications

PRO-GRADE has been tested using a dataset from the Buena Vista Groundwater Basin,
a well-understood system in the Central Sand Plains of Wisconsin (Figure 5a). Coupling

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

472

Y-F Lin, J Wang and A J Valocchi

Figure 9 The graphical user interface of GRADE-GIS and estimated recharge and discharge
in the Buena Vista Groundwater Basin, Wisconsin with surface water features superimposed
(blue and positive values represent recharge, and red and negative values represent discharge)

of  GRADE-GIS  and  PRO-GIS  enables  the  user  to  apply  alternative  sets  of  input  data
and various combinations of image processing methods in order to generate many alternative
recharge and discharge maps quickly. The alternative maps may then be compared with
external  information  in  GIS  (Figure  9)  to  evaluate  their  plausibility  and  rank  those
alternatives. The ranked recharge and discharge maps can be used as an initial guideline
for  field  study  planning  and  decision  making,  or  can  be  used  as  initial  conditions  for
numerical  simulation  and  parameter  estimation  for  more  detailed  analysis.  Another
advantage of this fast production is that these initial alternative maps and rates can be
leveraged  by  using  follow-up  calibration  and  evaluation  processes  (e.g.  Monte  Carlo
simulation),  which  usually  require  intensive  computation  resources  and  time.  The
ranked initial maps can serve as the first screening process for prioritizing the alternative
model  calibrations,  evaluations  of  model  predictions,  and  parameter  uncertainty
analysis.

PRO-GRADE  is  currently  being  used  for  several  studies,  including  an  ongoing
assessment  of  the  water  resources  of  northeastern  Illinois,  a  region  that  includes  the
Chicago  metropolitan  area.  The  population  of  the  six  Illinois  northeastern  counties  is
predicted to grow by 2 million from the year 2000 to 2030, an increase of 25 percent
(NIPC 2006). The projected growth will place unprecedented demands on the shallow
aquifers  of  the  region.  Analysis  using  PRO-GRADE  will  provide  an  understanding
of  the  distribution  of  recharge  and  discharge  in  northeastern  Illinois  and  will  assist
in continuing aquifer modeling and water resource planning efforts on multiple scales.

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

Estimating Shallow Groundwater Recharge and Discharge

473

5 Conclusions

PRO-GRADE provides utilities that address a common problem underlying the manage-
ment of natural resources, that of pattern recognition with noisy spatial data. Coupling
of GRADE-GIS and PRO-GIS enables users to generate many alternative recharge and
discharge  maps  in  a  timely  manner.  These  alternative  maps  can  be  compared  with
external  information  in  GIS  to  evaluate  their  plausibility  in  a  ranking  process.  The
ranked maps can be used for field study planning, formulation of policy and management
options, and as initial conditions for numerical simulation and parameter estimation for
more detailed analysis. Moreover, the ability to rank alternative recharge and discharge
maps  provides  a  potential  way  to  bridge  the  gap  between  traditional  subjective
approaches  for  initiating  conceptual  models  and  advanced  stochastic  and  uncertainty
analyses. Since it can be used to process any raster files (e.g. remote sensing images), not
just recharge and discharge maps, PRO-GIS can support virtually any Spatial Decision
Support System (SDSS) used for management of land use, water resources, and agricultural
developments. PRO-GRADE also has the potential for integrating additional processes
in a single software package; thus future development possibilities include machine learning,
parameter estimation and uncertainty analysis.

Acknowledgements

This  project  is  sponsored  by  U.S.  Geological  Survey  and  National  Institutes  for  Water
Resources, National Competitive Grants 104G. Data for the example case were provided
by  the  US  Geological  Survey,  Wisconsin  Water  Science  Center,  Middleton,  Wisconsin;
the  Wisconsin  Geological  and  Natural  History  Survey  and  the  Central  Wisconsin
Groundwater  Center  of  the  University  of  Wisconsin  –  Extension.  We  appreciate  the
advice on implanting TV + L1 from Drs. Chung-Hsien Huang and Terrence Chen in the
Department of Electrical and Computer Engineering at University of Illinois at Urbana-
Champaign.  We  would  like  to  thank  Dr.  Randall  J.  Hunt  from  the  U.S.  Geological
Survey (WRD, Middleton, Wisconsin), Dr. Ming Ye from Florida State University and
the  other  beta  testers  for  helping  us  to  improve  this  software  package.  We  sincerely
appreciate the comments from two anonymous reviewers which were extremely helpful.

1 The download package includes the installation program, user’s guide, and example
files. The source code is available free upon contacting the corresponding author.

Note

References

Chan T F and Esedoglu S 2005 Aspects of total variation regularized L1 function approximation.

SIAM Journal on Applied Mathematics 65: 1817–37

Chen T, Yin W, Zhou X S, Comaniciu D, and Huang T S 2006 Total variation models for variable
lighting  face  recognition.  IEEE  Transactions  on  Pattern  Analysis  and  Machine  Intelligence
28: 1519–24

Cherkauer D S 2004 Quantifying ground water recharge at multiple scales using PRMS and GIS

Ground Water 42: 97–110

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

474

Y-F Lin, J Wang and A J Valocchi

CRC (Climate Research Committee) 2003 Understanding Climate Change Feedbacks. Washington,

COHS (Committee on Hydrologic Science) 2004 Groundwater Fluxes Across Interfaces. Washington,

DC, National Academies Press

DC, National Academies Press

de Dreuzy J-R, Bodin J, Le Grand H, Davy P, Boulanger D, Battais A, Bour O, Gouze P, and Porel
G 2006 General database for ground water site information, Ground Water 44: 743–8
Deutsch  C  V  and  Journel  A  G  1998  GSLIB  Geostatistical  Software  Library  and  User’s  Guide

(Second Edition). New York, Oxford University Press

Harbaugh  A  W,  Banta  E  R,  Hill  M  C,  and  McDonald  M  G  2000  MODFLOW-2000,  The  U.S.
Geological  Survey  Modular  Groundwater  Model:  User  Guide  to  Modularization  Concepts
and the Groundwater Flow Process. U.S. Geological Survey Open-File Report 00-92

IPCC  (Intergovernmental  Panel  on  Climate  Change)  2005  Guidance  Notes  for  Lead.  WWW

document, http://www.ipcc.ch/activity/uncertaintyguidancenote.pdf

Lin Y-F 2002 Development of a Digital Method for Estimating Groundwater Recharge and Discharge.

Unpublished PhD Dissertation, University of Wisconsin-Madison

Lin  Y-F  and  Anderson  M  P  2003  A  digital  procedure  for  ground  water  recharge  and  discharge

pattern recognition and rate estimation. Ground Water 41: 306–15

Lin Y-F, Wang J, Valocchi A J 2008 Making groundwater recharge and discharge estimate maps
in one day: An ArcGIS 9.2 application for water resources research. ArcUser 11(1): 32–5
McDonald  M  G  and  Harbaugh  A  W  1988  A  Modular  Three-Dimensional  Finite-Difference
Groundwater Flow Model. Washington, DC, United States Geological Survey Techniques of
Water Resources Investigations Report 06-A1

NIPC  (Northeastern  Illinois  Planning  Commission)  2006  2030  Forecasts  of  Population,  Households
and Employment by County and Municipality. WWW document, http://www.chicagoareaplanning.
org/data/forecast/2030_revised/ENDORSED_2030_forecasts_9-27-06.pdf

Scanlon  B  R,  Healy  R  W,  and  Cook  P  G  2002  Choosing  appropriate  techniques  for  quantifying

groundwater recharge. Hydrogeology Journal 10: 18–39

Stoertz  M  W  1989  A  New  Method  for  Mapping  Groundwater  Recharge  Areas  and  for  Zoning
Recharge for an Inverse Model. Unpublished PhD Dissertation, University of Wisconsin-Madison
Stoertz M W and Bradbury K R 1989 Mapping recharge areas using a groundwater flow model:

A case study. Ground Water 27: 220–8

Yin W, Chen T, Zhou X S, and Chakraborty A 2005 Background correction for cDNA microarray

images using the TV + L1 model. Bioinformatics 21: 2410– 6

© 2008 The Authors. Journal compilation © 2008 Blackwell Publishing Ltd
Transactions in GIS, 2008, 12(4)

