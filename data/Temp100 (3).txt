DOI: 10.1111/tgis.12594  

R E S E A R C H   A R T I C L E

Error assessment of grid‐based terrain shading 
algorithms for solar radiation modeling over 
complex terrain

Shuhua Zhang1  |   Xingong Li2  |   Jiangfeng She1

1Jiangsu Provincial Key Laboratory of 
Geographic Information Science and 
Technology, School of Geography and 
Ocean Science, Nanjing University, Nanjing, 
China

2Department of Geography and 
Atmospheric Science, University of Kansas, 
Lawrence, KS, USA

Correspondence
Jiangfeng She, Jiangsu Provincial Key 
Laboratory of Geographic Information 
Science and Technology, School of 
Geography and Ocean Science, Nanjing 
University, 163 Xianlin Rd, Qixia District, 
Nanjing 210023, China.
Email: gisjf@nju.edu.cn

Funding information
National Natural Science Foundation of 
China, Grant/Award Number: 41701442; 
China Postdoctoral Science Foundation, 
Grant/Award Number: 2018M632281

Abstract

In  mountainous  regions,  solar  radiation  exhibits  a  strong 

spatial heterogeneity due to terrain shading effects. Terrain 

shading algorithms based on digital elevation models can be 

categorized  into  two  types:  area‐based  and  point‐specific. 

In  this  article,  we  evaluated  two  shading  algorithms  using 

designed mathematic surfaces. Theoretical shading effects 

over four Gauss synthetic surfaces were calculated and used 

to  evaluate  the  terrain  shading  algorithms.  We  evaluated 

the area‐based terrain shading algorithm, Hillshade tool of 

ArcGIS, and the point‐specific shading algorithm from Solar 

Analyst  (SA)  in  ArcGIS.  Both  algorithms  showed  shading 

overestimation, and Hillshade showed more accuracy with 

a mean absolute error (MAE) of 1.20%, as compared to the 

MAE  of  1.66%  of  SA.  The  MAE  of  Hillshade  increases  ex‐

ponentially as the spatial extent of the study area increases 

because  the  solar  position  for  all  locations  on  the  surface 

is  the  same  in  Hillshade.  Consequently,  we  suggest  that 

the  surface  should  be  divided  into  more  tiles  in  Hillshade 

when the discrepancy in the latitude of the whole surface 

is  greater  than  4°.  Skyshed,  which  represents  the  horizon 

angle distribution in SA, is error‐prone over more complex 

terrain  because  horizon  angle  interpolation  is  problematic 

for such areas. We also propose a new terrain shading algo‐

rithm, with solar positions calculated using local latitude for 

Transactions in GIS. 2019;00:1–23. 

wileyonlinelibrary.com/journal/tgis 

  |  1

© 2019 John Wiley & Sons Ltd2  |    

each cell and the horizon angle calculated for every specific 

time interval, but without projections. The new model per‐

forms better than Hillshade and SA with an MAE of 0.55%.

1 |  I NTRO D U C TI O N

Solar radiation is the main source of surface energy balance and the driving force of atmospheric, ecological and 

hydrological processes (Aguilar, Herrero, & Polo, 2010; Allen, Trezza, & Tasumi, 2006; Funk & Hoelzle, 1992; Li, 

Zhang, & Chen, 2016; Li & Williams, 2008; Marsh, Pomeroy, & Spiteri, 2012; Zhang, Li, & Chen, 2015). However, 

solar radiation shows a significant temporal and spatial heterogeneity over complex terrain, which is caused by 

altitude discrepancy and the terrain shading effect. The shading effect can result in a significant reduction in solar 

energy. Hanson, Deline, MacAlpine, Stauth, and Sullivan (2014) demonstrated an average loss of 8.3% of solar en‐

ergy due to shading based on a sample of 542 solar photovoltaic arrays. Marsh et al. (2012) proposed that the solar 

irradiance in a mountainous region is affected by the shadows from the surrounding terrain and the accumulation 

of errors in the estimation of solar irradiation can lead to significant errors while calculating the time and rate of 

snowmelt. Consequently, the impact of terrain shading in solar radiation modeling is very important for the energy 

budget over complex terrain.

Terrain shading includes terrain self‐shading and surrounding terrain shading. Terrain self‐shading is caused 

by the orientation (i.e., slope and aspect) of the terrain that can be derived from a digital elevation model (DEM). 

Calculating surrounding terrain shading is more complex because the horizon angle must be computed in each 

solar  direction.  In  the  last  two  decades,  various  grid‐based  solar  radiation  models,  which  are  based  on  a  DEM 

and consider the terrain shading effect, have been developed and implemented in GIS software (Corripio, 2003; 

Dubayah & Rich, 1995; Fu & Rich, 1999; Kumar, Skidmore, & Knowles, 1997; Li, Cheng, Chen, & Lu, 1999). Dozier, 

Bruno, and Downey (1981) and Dozier and Frew (1990) proposed grid‐based terrain shading algorithms for direct 

and diffuse solar radiation modeling over complex terrain. Kumar et al. (1997) developed a simple and easy‐to‐op‐

erate solar radiation model that uses the Hillshade function to consider terrain shading effects. Li et al. (1999) also 

proposed a solar radiation model based on DEMs and GIS. The shading algorithm used in this model was based 

on the ray‐tracing method. Fu and Rich (1999) developed a new solar radiation model, named Solar Analyst (SA), 

based on a DEM. The model provides a new sight for terrain shading effect calculation by overlaying Skyshed 

(called Viewshed in Solar Analyst) and a sun track map.

The grid‐based terrain shading algorithms used in the above solar radiation models can generally be catego‐

rized as either area‐based or point‐specific algorithms (Fu & Rich, 1999; Li et al., 2016; Liu, Bardossy, Li, & Jiang, 

2012; Zhang et al., 2015). The area‐based algorithm follows the sun's position and detects terrain shading for all 

the locations on a DEM at specific solar positions. In contrast, the point‐specific algorithm projects the horizon 

angle in all directions into a hemispherical map, called Skyshed, for a specific position on a DEM. The Skyshed 

overlays the sun track map to model the shading effect in unspecific time (Figure 1). The Hillshade function is a 

typical area‐based shading algorithm, and overlaying Skyshed and the sun track map in SA is a typical point‐spe‐

cific shading algorithm. Although the area‐based algorithm can calculate the shading effect over a landscape, the 

solar track is the same for all surface locations because it uses only one latitude over the landscape to simulate 

the  solar  tracking  which  is  unsuitable  for  a  relatively  large  region.  The  point‐specific  algorithm  calculates  the 

surrounding horizon angle distribution and solar tracking using the local geometry of surface and local latitude, 

respectively.  However,  the  horizon  angle  distribution  and  solar  tracking  are  projected  into  a  two‐dimensional 

hemispherical map which causes error in the shading calculation (Li et al., 2016; Zhang et al., 2015). Therefore, it 

is crucial to evaluate which shading algorithm is more accurate for solar radiation modeling over complex terrain, 

and the sensitive parameters for algorithms.

ZHANG et Al.    |  3

F I G U R E   1  Processes in (a, b) Hillshade and (c–e) SA: (a) Elevation profile for horizon angle in Hillshade; (b) 
Horizon angle determination for a specific point in Hillshade; (c) Sun track map in SA (i.e., sunmap); (d) Horizon 
angle in surroundings in SA (i.e., Skyshed); and (e) Overlaying Skyshed and sunmap to determine shading effect

In most cases, real DEMs were used to evaluate the shading algorithms. Zhang, Chang, and Liang (2017) com‐

pared two shading algorithms and two sky view factor algorithms based on DEMs with resolution of 1 m. Wu et 

al. (2018) compared sky view factor and terrain view factor algorithms using DEMs with different resolutions. The 

studies above can only compare the terrain shading algorithms, and cannot quantify the error of the algorithms. 

Marsh et al. (2012) developed a new terrain shading algorithm and validated it using field observations with pho‐

tos. However, the exact shading time is not easy to determine and the observation data are sparse and only avail‐

able at a few locations. In addition, real DEMs are discrete representations of the actual continuous topographic 

surface and include errors that are rarely known spatially. Using real DEMs cannot find the causes of the errors 

as errors may arise from the data and/or model. Data‐independent methods with designed artificial surface can 

avoid input data error (DEM error) and quantify the algorithm error (Jones, 1998). Therefore, the theoretical shad‐

ing effect was calculated over designed surfaces and used to evaluate the terrain shading algorithms.

Freeman (1991) used an artificial surface to assess divergent flow simulation algorithms. Zhou, Liu, and Sun 

(2006) used inverse ellipsoid and Gauss synthetic artificial surfaces to evaluate the terrain complexity and un‐

certainty of slope and aspect. Qin, Bao, Zhu, Hu, and Qin (2013) used artificial surfaces based on sine and cosine 

functions to evaluate grid‐based flow direction algorithms. Zhang et al. (2015) and Li et al. (2016) used V‐ and 

U‐shaped artificial surfaces to evaluate the grid‐based solar radiation models and the error of shading algorithms. 

However,  V‐  and  U‐shaped  surfaces  are  simple  surfaces  as  compared  to  actual  surfaces  such  as  mountainous 

regions, and they focused on solar radiation modeling. Qin et al. (2013) used sine and cosine function surfaces of 

convex‐centered, concave‐centered, saddle‐centered, and straight‐ridge slopes. However, these surfaces are also 

too simple and do not have sufficient topographic relief to perform as the DEM that is used to evaluate the terrain 

shading effect in solar radiation modeling.

In this research, we used Gauss synthetic surfaces with varied coefficients to simulate land surfaces with vary‐

ing topographic relief. A sensitivity analysis of the resolution of the DEM and the key parameters for the Hillshade 

function and the shading algorithm in SA were carried out and the two shading algorithms were evaluated. Based 

ZHANG et Al.4  |    

on a sensitivity analysis and evaluations of the two terrain shading algorithms, we also proposed a new terrain 

shading algorithm that avoided the disadvantages of Hillshade and SA and performed better than either of these 

two shading algorithms. The results can also be used as a reference for terrain shading algorithm selection and the 

improvement of solar radiation modeling over mountainous regions.

2 |  T WO S H A D I N G A LG O R ITH M S

Terrain  shading  effects  over  mountainous  regions  depend  on  the  solar  position  and  horizon  angle  in  the  solar 

direction. If the solar altitude angle is above the horizon angle in the solar direction, the terrain can be lighted, 

otherwise it is not. The area‐based shading algorithm, Hillshade, calculates the horizon angle for each DEM cell 

in a specific solar direction and compares the horizon angle with the solar altitude angle at the specific time to 

determine whether a cell is in shadow. The solar position used for the whole surface is the same, which is problem‐

atic over a large surface, and the solar beam is considered as parallel lines over the whole surface (Figure 1a). The 

horizon angle of points on every elevation profile along these parallel solar beam directions can be determined 

by searching the largest terrain shading angle (Figure 1b). Points that are not on any elevation profile fall on the 

nearest profile to determine the horizon angle (blue arrow in Figure 1a). The shading effect can be calculated using 

Hillshade in all time intervals that are divided equally for unspecified calculated periods (Dozier et al., 1981; Kumar 

et al., 1997; see also ArcGIS documentation).

The point‐specific method calculates shading effects at a specific point by overlaying rasterized Skyshed and 

sun track maps from SA in ArcGIS. The horizon angles in a specific set of directions that can be defined by the user 

are calculated and the other horizon angles in unsearched directions are interpolated. The horizon angles in all 

directions are projected on a rasterized map using a hemispherical projection, called Skyshed (Figure 1d). The sun 

track position (azimuth angle and altitude angle) was also projected in the same way, called Sunmap (Figure 1c). By 

overlaying the projected horizon angle and sun track map (Figure 1e), the unshaded time duration can be deter‐

mined (Fu & Rich, 1999). The resolution of rasterized Skyshed and sun track map which can be defined by the user 

is sensitive to the accuracy of terrain shading calculation.

3 |  A RTI FI C I A L S U R FAC E S A N D  TH EO R E TI C A L S H A D I N G E FFEC T

3.1 | Artificial surfaces

The assessment of the uncertainty of local topographic attribute algorithms based on real DEMs is more complex 

because the errors may arise from the DEM itself and/or the algorithm. Therefore, mathematical surfaces were 

designed to have a raster structure, like DEMs, and the theoretical value can be calculated on these mathematical 

surfaces. The slope, aspect, flow direction, and specific catchment area have been theoretically solved on some 

specific surfaces. The uncertainty of the algorithms can be assessed by comparing model and theoretical values. 

Mathematical surfaces such as straight slopes, saddle surfaces, ellipsoid and hyperbolic surfaces, Gauss synthetic 

surfaces, and V‐ and U‐shaped surfaces have been used to evaluate the topographic algorithms (Li et al., 2016; 

Qin et al., 2013; Zhang et al., 2015; Zhou et al., 2006). However, the straight slope, saddle, ellipsoid and hyperbolic 

surfaces are too simple and focus on only a few topographic changes. Zhou et al. (2006) used Gauss synthetic 

surfaces to evaluate the topographic complexity, and slope and aspect algorithms because these algorithms can 

be solved theoretically. Gauss synthetic surfaces are more similar to the real topography and have more relief 

changes.

The key for evaluation using artificial surfaces is that the parameter evaluated should be determined theoret‐

ically on surfaces. The main parameter for the terrain shading algorithm is the horizon angle in the solar direction. 

The horizon angle is the maximum shading angle between the specific point and the surrounding terrain (Figure 2). 

ZHANG et Al.    |  5

(1)

(2)

(3)

(4)

(5)

F I G U R E   2  Profile of relief changes and horizon angle in two directions for point P

If the horizon angle in all directions can be determined theoretically on mathematical surfaces, then the theoret‐

ical shading effect on mathematical surfaces can be calculated to evaluate the terrain shading algorithm. In this 

research, we have chosen Gauss synthetic surfaces as artificial surfaces, and the horizon angles on these surfaces 

have been calculated theoretically. Next, the theoretical horizon angle is compared with the solar altitude angle 

and the shading effect is determined theoretically. We also designed different Gauss synthetic surfaces that show 

different complexities with different parameters. The Gauss synthetic surfaces and parameters used to generate 

surfaces are explained in Section 4.

3.2 | Theoretical shading effect

The terrain shading effect is determined by the solar altitude angle and the horizon angle in the solar direction. 

Therefore, firstly, we should calculate the horizon angle in the solar direction. In this research, we present a solu‐

tion for the horizon angle on Gauss synthetic surfaces. We used the Gauss synthetic surface as selected by Zhou 

et al. (2006) and the function of the surface is expressed as:

z = A

1 −

2

x
M

x
M

e−
(

2

−

2

y
N

+1

)

(

)

− B

0.2

−

[

x
M

3

−

x
M

y
N

5

]

(

)

(

)

[

(

]

)

x
M

e−
(

2

2

−

y
N

)

(

)

− Ce−
(

x
M

+1

2

−

y
N

2

)

(

)

where A, B and C are parameters determining surface relief, and M, N are parameters controlling the spatial extent 

of the surface. To simplify Equation (1), let:

f1 = A

1 −

[

(

]

)

2

x
M

x
M

e−
(

2

−

2

y
N

+1

)

(

)

f2 = −B

0.2

[

x
M

−

x
M

3

−

y
N

5

]

x
M

e−
(

2

2

−

y
N

)

(

)

(

)

(

)

Hence, Equation (1) can be expressed as:

f3 = −Ce−

x
M

+1

2

−

y
N

2

(

)

(

)

z = f1(x, y) + f2(x, y) + f3(x, y)

For an arbitrary point P(x0, y0, z0), we shift the coordinate system origin to point P. The equation of the Gauss 

synthetic surface in the new coordinate system can be expressed as:

ZHANG et Al.6  |    

as:

z� = f1(x� + x0, y� + y0) + f2(x� + x0, y� + y0) + f3(x� + x0, y� + y0) − z0

Next, we calculate the intersection of the Gauss synthetic surface with the vertical plane surface in the solar 

azimuth direction α (from the east). The intersection is a curve in space and the equation of the curve is expressed 

zc = f1(x� + x0, kx� + y0) + f2(x� + x0, kx� + y0) + f3(x� + x0, kx� + y0) − z0

where k = tan (𝛼). So, the tangent of the horizon angle in the direction of the origin point P is:

�
The horizon angle in two directions can be determined by distinguishing the positive and negative values of x′. 

�

Consequently, the horizon angle in two directions of α and 𝜋+𝛼 is expressed as:

tan (HA) =

x�

1 + k2

zc

√

arctan

arctan

HA = ⎧
⎪
⎪
⎨
⎪
⎪
⎩

,

x� > 0

,

x� < 0

�

x�

1 + k2 �

�

−x�

1 + k2 �

zc

√

zc

√

(6)

(7)

(8)

(9)

The maximum horizon angle in two directions can be solved by considering the maximum value of HA on the 

two intervals [−xb 0] and [0 xb]. −xb and xb are the boundary limits of x′.

Subsequently, the solar altitude angle is compared with the maximum horizon angle. The solar altitude angle 

is calculated using the equation:

SA = a sin ( sin 𝛿 + sin 𝜙 + cos 𝛿 cos 𝜙 cos 𝜔)

(10)

where 𝛿 is the declination, 𝜙 is the geographic latitude, and ω is the hour angle. If the solar altitude angle is greater 

than the maximum horizon angle, the point can be irradiated, else the point will be shaded by terrain.

4 |  E X PE R I M E NT S

We designed four Gauss synthetic surfaces (G1, G2, G3, and G4) with varied parameters, expressed in Equation 

(1). The parameters and surfaces are shown in Figure 3. As the terrain shading effect is related to the orientation 

of the surface (i.e., slope and aspect) and variations in elevation in the surrounding terrain, the four surfaces we 

designed should have different terrain complexities so that they can help determine the performance of the ter‐

rain shading algorithms over different topographies. Here we use the coefficient of variation (CV) of the slope over 

the surface to represent its complexity. The CVs of the slopes over G1, …, G4 are 1.09, 0.55, 0.49, and 0.32, re‐

spectively, showing how the complexity in the surface terrain declines. There is also a decline in the local relief of 

the four surfaces. The declining trend of terrain complexity from G1 to G4 can also be seen in the surface plots in 

Figure 3, where G1 appears to have more terrain complexity than the other three surfaces and G4 is relatively flat.

The theoretical shading effect was calculated to compare the results from the Hillshade function in ArcGIS 

(hereafter simply Hillshade) and shading from SA. The sensitive parameters of two shading algorithms were ana‐

lyzed. For Hillshade, the spatial extent of the study area had to be limited because the solar position for all cells on 

the surface is the same. Surfaces with different spatial extents (1–8 degrees of latitude from the surface center to 

the boundary) were designed and the accuracy of Hillshade on these surfaces was calculated to find the largest 

ZHANG et Al.    |  7

F I G U R E   3  Gauss synthetic surfaces with different reliefs and complexities

spatial extent of the surface used in Hillshade. For SA, the horizon angle is calculated in certain directions (users 

can define the number; it is 32 by default) and horizon angles in unsearched directions are interpolated. The sky 

size is the resolution of the Skyshed map in SA. Theoretically, the sky size should be large enough to accurately 

represent the Skyshed boundary. Therefore, the sky size and the number of directions for Skyshed calculation 

are important parameters for terrain shading estimation in SA. We designed different values of these parameters 

(with the sky size accounting for 200, 400, 600, and 1,024 cells, in 32, 64, 128, and 360 directions) in SA to sim‐

ulate the terrain shading effect and then compared them with the theoretical shading effect to find the optimum 

value of the parameters. The resolution of the DEM influences the terrain shading effect for Hillshade and SA, 

so we designed surfaces with different resolutions (1, 5, 10, and 20 m) to analyze the sensitivity of the resolution 

for both algorithms. Based on this sensitivity analysis, the accuracy of these two terrain shading algorithms was 

evaluated over the four designed surfaces at the spring and autumnal equinoxes with a time step of 0.5 h. The 

spring and autumnal equinoxes are chosen because the solar position on these two days is not as high as during 

the summer solstice or as low as during the winter solstice. Furthermore, we compared the two terrain shading 

algorithms on a real DEM. A station in the Kunlun Mountains measured incoming solar radiation, and the terrain 

shading effects for the two algorithms were evaluated at the station and further compared spatially. Errors of 

direct radiation and of the sky view factor for diffuse radiation, which are caused by the uncertainty of terrain 

shading, were also evaluated.

Since the map of the shading effect is rasterized and the cells in the shading map have binary values of either 

0 or 1, the mean absolute error (MAE) of the shading algorithm is defined as the number of incorrectly identified 

cells compared to the theoretical shading map divided by the number of cells in the shading map. In addition, we 

ZHANG et Al.8  |    

defined the mean error (ME) of the shading algorithm as the difference between the overestimation and under‐

estimation errors. The overestimation error is the proportion of cells that show a shadow from the algorithm but 

do not show a shadow based on their theoretical value. Similarly, the underestimation error is the proportion of 

cells that show no shading effect from the algorithm but do have a shading effect based on their theoretical value. 

Therefore, the ME is a measure of the under‐ or over‐estimation of the shading algorithm. If the ME of the shading 

algorithm is positive, the shading algorithm shows more shading area than the theoretical shading map, otherwise 

it shows less shading area based on the shading algorithm. The error of the sky view factor was evaluated using 

the relative difference (RD) and absolute relative difference (ARD):

MAE =

× 100

NM
N0

ME =

× 100

NS − NN
N0

RD =

× 100

yi − xi
xi

ARD =

× 100

yi − xi
xi

|
|
|
|

|
|
|
|

(11)

(12)

(13)

(14)

where N0 is the number of cells in the shading map, NM is the number of incorrectly identified cells in the shading 
map, NS is the number of cells that show a shadow from the algorithm but do not show a shadow based on the 
theoretical value, and NN is the number of cells that show no shading effect from the algorithm but do have a 
shading effect based on the theoretical value. xi and yi are the ith value from the theoretical calculation and model 
simulation, respectively. RD is a measure of system error indicating the tendency of under‐/over‐estimation and is 

desired to be zero (Iqbal, 1983).

5 |  R E S U LT S A N D D I S CU S S I O N

As described in Section 4, we first analyzed the sensitivity parameters for two shading algorithms. Then the ac‐

curacy of two terrain shading algorithms was evaluated using mathematical surfaces. To confirm the evaluations 

using a data‐independent method, the two terrain shading algorithms were also evaluated over a real DEM. Based 

on the sensitivity analysis and evaluations, a new terrain shading algorithm that avoided the shortcomings of the 

two algorithms was proposed. In addition, the sensitivity of direct radiation and the sky view factor for diffuse 

radiation to uncertainty of two terrain shading algorithms was also analyzed.

5.1 | Sensitivity analysis for Hillshade and SA

To investigate how the resolution of the DEM influenced the two terrain shading algorithms, the artificial surfaces 

was resampled at resolutions of 1, 5, 10 and 20 m. The two terrain shading algorithms run on the DEMs were 

then  compared  to  the  theoretical  shading  effect.  Surfaces  that  had  the  same  topographic  relief  but  different 

spatial extents were extracted and used for spatial extent sensitivity analysis in Hillshade. For SA, the values of 

the number of directions and sky size for the Skyshed map were designed by following the sensitivity analysis in 

Fu and Rich (1999).

ZHANG et Al.    |  9

5.1.1 | Accuracy of shading algorithms over DEMs with different resolutions

The  horizon  angle  is  a  key  parameter  for  determining  the  shading  effect,  but  it  is  problematic  for  discretized 

surfaces  because  DEM  cell  centers  may  not  fall  in  the  elevation  profile  in  the  solar  azimuth  direction,  causing 

the elevation in the cell nearest to the profile to replace the real value (blue arrow in Figure 1a). Both Hillshade 

and SA demonstrate this problem. To further illustrate this, we analyzed the changes in MAE and ME of shading 

algorithms over DEMs with different resolutions because elevation interpolation in the profile may show greater 

error over a DEM with coarser resolution. We calculated the MAE and ME for the two shading algorithms over the 

four surfaces with resolutions of 1, 5, 10, and 20 m. Figure 4 shows the changes in MAE and ME over the DEMs 

with different resolutions. MAE and ME are the average error over all surfaces and at the spring and autumnal 

equinoxes. It shows that MAE increased with coarser resolution of DEM, which indicates that the elevation inter‐

polation in the horizon angle calculation is more problematic over coarser resolution surfaces. The ME decreased 

from overestimation to underestimation for coarser surfaces. It can be observed from Figure 4a that SA shows 

greater error than Hillshade with smaller resolution, but that the MAE at a resolution of 20 m is nearly the same 

for SA and Hillshade. Therefore, SA and Hillshade perform equally well, and SA tends to underestimate shading 

compared to Hillshade over DEMs with coarser resolution.

Table 1 shows the MAE and ME on the four surfaces at different resolutions. We can observe that the MAE 

increases with coarser resolutions of G1 and G2 for Hillshade and SA, but the same does not apply for G3 and G4—

indeed, the MAE decreases with coarser resolutions of G4. This indicates that SA and Hillshade perform better on 

surfaces with smaller raster size over more complex terrain, which also proves that the horizon angle over complex 

terrain should be calculated on surfaces with finer resolution. However, the elevation interpolation on a relatively 

flat surface does not significantly influence the shading determination over a surface with a coarser resolution. By 

comparing the ME for Hillshade and SA over different surfaces in different resolutions, we found that Hillshade 

tended to make overestimates more easily than SA did.

5.1.2 | Sensitivity analysis for Hillshade

Although Hillshade can calculate the shading effect for every location on a surface at each specific time, the solar 

position used in Hillshade is the same for the whole surface. The solar position is similar for every cell for surfaces 

with  a  relatively  small  spatial  extent;  however,  it  actually  varies,  particularly  for  study  areas  with  large  spatial 

extent. We analyzed the error of Hillshade for study areas with different spatial extents. We used the G2 surface 

F I G U R E   4  Changes in: (a) MAE; and (b) ME over DEMs with different resolutions

ZHANG et Al.10  |    

Hillshade

G1

G2

G3

G4

SA

G1

G2

G3

G4

TA B L E   1  MAE and ME on four surfaces with different resolutions

MAE (%)

ME (%)

Surface

1 m

5 m

10 m

20 m

1 m

5 m

10 m

20 m

1.24

1.20

1.02

1.34

2.02

1.97

1.34

1.29

1.60

1.22

0.97

1.25

2.02

1.96

1.21

1.21

2.68

1.38

0.88

1.17

2.55

2.18

1.21

1.27

6.25

2.83

1.39

1.13

4.98

3.55

1.53

1.50

0.44

0.33

0.29

0.23

0.24

0.79

0.34

0.12

0.60

0.29

0.26

0.12

−0.01

0.45

0.12

−0.11

0.37

0.12

0.05

0.07

−0.57

−0.06

−0.09

−0.26

−1.26

−1.29

−0.82

0.00

−1.74

−1.48

−0.74

−0.74

F I G U R E   5  Changes in MAE in Hillshade over surfaces with different spatial extent

at 9:00 a.m. and calculated its shading effect over surfaces with different spatial extents. Since the solar position 

is calculated chiefly on the basis of latitude, we designed surfaces with discrepancies in the spatial extents of the 

latitudes between 1 and 8° from the center of the surface to its boundary. These surfaces have the same relief 

changes. Changes in MAE over these surfaces are shown in Figure 5. We can observe that the MAE shows an 

exponential increase with increase in the discrepancy of latitude over surface. Therefore, Hillshade is not suitable 

for large surfaces.

Figure 6 shows the discrepancies in shading areas over surfaces with different spatial extent. By comparing 

the theoretical shading area and that from Hillshade, it can be found that the boundary of the shading effect is 

different due to solar position error. Hence, we proposed that the surface should be divided into more pieces for 

large surfaces when using Hillshade. Compared to the increase in MAE for a 1° increase in the spatial extent of 

ZHANG et Al.    |  11

F I G U R E   6  Discrepancy of shading area between Hillshade and theoretical shading over surfaces with 
different spatial extent: (a) 2°; (b) 4°; (c) 6°; and (d) 8°. Note: the spatial extent of a surface is the latitude 
difference between the surface center and the boundary of the surface

TA B L E   2  Sensitivity analysis of the number of directions in SA

MAE (%)

Spring equinox

Autumnal equinox

Number of 
directions

G1

G2

G3

G4

G1

G2

G3

G4

Mean

32

1.81

1.79

1.20

1.12

2.22

2.15

1.48

1.46

1.66

64

1.61

1.73

1.26

1.14

2.18

2.12

1.54

1.49

1.63

128

1.68

1.83

1.32

1.23

2.30

2.21

1.61

1.56

1.72

360

1.64

1.77

1.20

1.11

2.25

2.14

1.51

1.47

1.64

the surface, we found that the MAE shows a minimum increase from 1 to 2°. We assume that if the discrepancy in 

the latitude of a surface from its center to its boundary is more than 2°, it should be divided when using Hillshade.

5.1.3 | Sensitivity analysis of key parameters for SA

Horizon angles in SA are only traced in the number of directions that can be defined by the user, and then horizon 

angles in other directions are calculated by interpolation. Therefore, theoretically, it is better to calculate the ho‐

rizon angle in more directions for SA. We calculated the accuracy of SA with different numbers of directions (32, 

64, 128, and 360) used for horizon angle calculation, and the results are shown in Table 2. Overall, the accuracy of 

SA does not change much for different numbers of directions. However, it is significant that SA performs better 

with 360 directions than it does with 32 directions on G1 and G2. This indicates that the number of directions over 

which horizon angles are calculated is more important over more complex terrain.

The Skyshed map that represents the horizon angle distribution over surroundings in SA is the key to determining 

shading effects. Zhang et al. (2015) proved that horizon interpolation is the source of error for Skyshed. In addition, 

the resolution of Skyshed (sky size) is the key parameter for SA. However, Zhang et al. (2015) indicated that the error 

for Skyshed does not decrease with greater sky size. Despite this, the higher resolution should theoretically represent 

ZHANG et Al.12  |    

e
g
a
r
e
v
A

0
1
 
t
n
o
P

i

9
 
t
n
o
P

i

8
 
t
n
o
P

i

7
 
t
n
o
P

i

6
 
t
n
o
P

i

5
 
t
n
o
P

i

4
 
t
n
o
P

i

3
 
t
n
o
P

i

2
 
t
n
o
P

i

1
 
t
n
o
P

i

e
c
a
f
r
u
S

e
z
i
s
 
y
k
S

4
4
2

.

9
2

.

2

2
2

.

2

8
5
1

.

3
9
1

.

6
8
1

.

4
8
1

.

4
3
1

.

0
9
1

.

3
8
1

.

0
8
1

.

2
3
1

.

1
8
1

.

4
7
1

.

9
6
1

.

3
2
1

.

8
7
1

.

6
3
1

.

8
6
1

.

9
8
1

.

9
2
1

.

0
7
0

.

0
1
1

.

1
5
1

.

0
3
1

.

9
6
0

.

6
0
1

.

6
4
1

.

1
2
1

.

9
5
0

.

4
9
0

.

5
3
1

.

6
4
2

.

4
7
2

.

3
9
2

.

4
0
2

.

3
7
1

.

5
0
2

.

5
3
2

.

0
7
1

.

7
6
1

.

9
9
1

.

1
3
2

.

6
6
1

.

2
5
1

.

5
8
1

.

8
1
2

.

4
5
1

.

3
7
4

.

3
0
4

.

9
0
3

.

0
6
1

.

3
9
3

.

0
4
3

.

8
6
2

.

7
4
1

.

5
8
3

.

5
3
3

.

2
6
2

.

3
4
1

.

0
7
3

.

2
2

.

3

8
4
2

.

4
3
1

.

9
8
3

.

8
7
2

.

6
8
2

.

6
3
1

.

2
4
3

.

8
4
2

.

4
5

.

2

3
1
1

.

9
3
3

.

3
4
2

.

5
4
2

.

1
1
1

.

2
3
3

.

7
3
2

.

6
3
2

.

6
0
1

.

4
5
1

.

4
0
2

.

5
9
2

.

4
8
1

.

4
0
1

.

2
6
1

.

8
6
2

.

6
5
1

.

6
0
1

.

9
5
1

.

3
6
2

.

8
4
1

.

0
0
1

.

3
5
1

.

5
5

.

2

0
4
1

.

5
3
1

.

7
4
1

.

3
5
1

.

6
5
1

.

8
8
0

.

6
9
0

.

2
2
1

.

3
3
1

.

2
9
0

.

8
9
0

.

5
1
1

.

3
3
1

.

6
8
0

.

0
9
0

.

3
0
1

.

5
2
1

.

8
1
2

.

7
3
2

.

7
7
1

.

7
5
1

.

2
7
1

.

1
0
2

.

3
5
1

.

7
3
1

.

4
7
1

.

0
9
1

.

2
5
1

.

9
3
1

.

5
6
1

.

7
7
1

.

3
4
1

.

1
3
1

.

2
5
1

.

8
1
2

.

7
1
2

.

0
5
1

.

5
1
1

.

1
0
2

.

2
0
2

.

8
2
1

.

3
0
1

.

9
9
1

.

1
0
2

.

9
2
1

.

1
9
0

.

8
8
1

.

1
9
1

.

0
2
1

.

4
8
1

.

0
2

.

2

7
9
1

.

9
2
1

.

9
2
1

.

4
8
1

.

5
6
1

.

2
1
1

.

5
3
1

.

4
8
1

.

3
6
1

.

4
1
1

.

9
2
1

.

6
7
1

.

3
5
1

.

5
0
1

.

5
1
3

.

4
7
1

.

4
2
1

.

1
1
1

.

0
8
2

.

9
4
1

.

7
6
0

.

3
9
0

.

2
7
2

.

7
5
1

.

5
6
0

.

3
9
0

.

0
6
2

.

3
5
1

.

2
5
0

.

3
8
0

.

1
G

2
G

3
G

4
G

1
G

2
G

3
G

4
G

1
G

2
G

3
G

4
G

1
G

2
G

3
G

4
G

0
0
2

0
0
4

0
0
6

4
2
0
1

,

s
e
c
a
f
r
u
s
 
r
u
o
f
 
e
h
t
 
n
o
 
s
t
n
o
p
 
t
n
e
r
e
f
f
i
d
 
t
a
 
t
s
y

i

l

a
n
A
 
r
a
o
S
n

 

l

i
 

 

d
e
h
s
y
k
S
 
f
o
y
c
a
r
u
c
c
A
 
3

 

E
L
B
A
T

ZHANG et Al.    |  13

the Skyshed boundary more accurately. The possible reason for the result in Zhang et al. (2015) is different with the‐

oretical background is that Zhang et al. (2015) used relatively simple terrain unit V‐surfaces. Therefore, we compared 

Skyshed from SA and theoretical Skyshed with different sky size and over surfaces with different complexities.

We selected 10 points in the same position on every surface (G1, …, G4), calculated the theoretical horizon 

angle, and projected it on a hemispherical projection to give the theoretical Skyshed. The error is measured using 

the MAE between theoretical Skyshed and Skyshed from SA. Table 3 shows the error of Skyshed with different 

sky  size  for  different  points  on  the  four  surfaces.  The  overall  error  of  Skyshed  for  all  points  on  all  surfaces  is 

1.80%. Based on the average error presented in Table 3, the error of Skyshed decreases from G1 to G4 with the 

same sky size. In addition, the error of Skyshed decreases from 2.13 to 1.62% for sky size from 200 to 1,024, which 

indicates that Skyshed with higher resolution shows more accuracy. This is inconsistent with Zhang et al.'s (2015) 

findings that evaluated error only on V‐shaped surfaces. This also indicates that the error of Skyshed increases 

over more complex terrain. It may be caused by the fact that the horizon angle is interpolated in unsearched direc‐

tions in Skyshed. In addition, the horizon angle algorithm in SA also has the disadvantage of elevation interpolation 

in the solar beam direction when the solar beam cannot go through all cells due to the rasterization of the DEM 

(Figure 1a). To illustrate the problems of horizon angle mentioned above, we selected four points' error of Skyshed 

map, which have the largest error for each surface as shown in Figure 7. For G2, G3, and G4, the Skyshed in SA 

underestimates in most directions. This indicates an overestimation of the horizon angle, especially in directions 

with relatively smaller horizon angle. However, Skyshed overestimates in directions with relatively greater horizon 

angle. We can also observe that the shape of boundary where error occurs is irregular, caused by the horizon angle 

interpolation in Skyshed.

5.2 | Error assessment of the two terrain shading algorithms

Based on the sensitivity analysis, we selected the optimum values of sensitive parameters to compare the two 

algorithms. The DEM used for Hillshade and SA had a resolution of 1 m and the mean latitude over the surface was 

36°. The discrepancy of the latitude over every surface is less than 0.002°. Hillshade modeled the shading effect 

at each specific time. However, SA could not directly model the shading at the specific time. To obtain the shad‐

ing effect for SA at each time, we used a sun track map with time‐step of 1 min. The shading effect on each time 

was determined by Skyshed's cell value in the corresponding sector that represents the selected time interval by 

overlaying Skyshed and sun track map. Sky size, the resolution of Skyshed and the sun track map was 2,000 cells 

(the size of the Skyshed map is 2,000 × 2,000 cells), which was relatively large compared to the default value of 

200 cells, because the sensitivity analysis indicated that a larger sky size is better for SA. Another reason for this 

was that the time‐step and resolution of Skyshed should be matched, otherwise the shading effect would acquire 

considerable error, as shown by Zhang et al. (2015). For the Skyshed map, we used the default number of direc‐

tions (32) for horizon angle calculation because the sensitivity analysis showed that error did not change much 

F I G U R E   7  Skyshed error map for the four surfaces. “0” means that Skyshed from SA is consistent with 
theoretical Skyshed; “1” means overestimation by Skyshed; “−1” means underestimation by Skyshed

ZHANG et Al.14  |    

using different values for this parameter. We used the ME and MAE discussed in Section 4 to evaluate the shading 

algorithm by comparing the Hillshade and SA shading maps with the theoretical shading map.

Table 4 shows the ME and MAE over the four surfaces for the two shading algorithms at the spring and autum‐

nal equinox. The ME of the Hillshade and SA algorithms is 0.32 and 0.37%, respectively. This means that Hillshade 

and SA will introduce more shading areas than there are real shading areas over surfaces. The MAE of Hillshade 

and SA is 1.20 and 1.66%, respectively. Hillshade shows more accuracy than SA which is consistent with the study 

of Zhang et al. (2015) that indicates Hillshade performs better than SA (sky size used in SA is 200). Over the four 

surfaces, the MAE decreases with the decrease in the complexity of surface from G1 to G4 for SA, which indicates 

that SA performs better on relatively flat surfaces than on more complex terrain. In addition, the error variation in 

SA from G1 to G4 is consistent with the error of Skyshed. This means that Skyshed is crucial to calculate shading 

effect in SA. The MAE of Hillshade decreases from G1 to G3 but increases for the relatively flat surface G4.

Figure  8  shows  how  the  MAE  changes  from  sunrise  to  sunset  over  the  four  surfaces  at  the  spring  and  au‐

tumnal equinox. From G1 to G4, the times with 0% error increase for the two shading algorithms and these are 

observed around 12:00 noon. The possible reason for this is that the solar altitude angle around noon is relatively 

high. However, a relatively large error occurred around sunrise and sunset where more shading occurs. Based on 

Figure 8, the MAE from Hillshade is smaller than or equal to that from SA for all surfaces except for G4 at the 

autumnal  equinox.  Combined  with  the  MAE  that  increased  over  G4,  we  can  conclude  that  Hillshade  performs 

inadequately so good on relatively flat surfaces.

We also calculated the ME and MAE for Hillshade and SA over four new surfaces (NG1, …, NG4)—these are 

the surfaces G1, …, G4 with added random errors. The random error surfaces were generated using randomly 

rough surfaces by means of fractals (Kanafi, 2016). The parameters used to generate random error surface are 

calculated based on G1 to G4, respectively. The mean error of NG1, …, NG4 is 3.2% that is larger than error over 

G1, …, G4. Surfaces NG1, …, NG4 can be considered as real DEMs which typically have some errors. The results 

in Table 5 show that the MEs and MAEs are larger than those for surfaces G1, …, G4 (Table 4). Those larger MEs 

and MAEs are caused by the errors in the DEM, which usually cannot be quantified by using real DEMs to evaluate 

the shading algorithm. This also indicates that the data‐independent method we used is a good way to assess the 

error of terrain shading algorithms.

To confirm the effectiveness of our method, the two terrain shading algorithms were also evaluated using the 

30 m ASTER DEM (Figure 9a). We compared the spatial terrain shading pattern over the DEM in Hillshade and SA 

and evaluated two terrain shading algorithms by the measured terrain shading effect which is determined using 

solar  radiation  observations.  One  station  at  36.97°N  measured  solar  radiation  over  the  study  area  (Figure  9a), 

which is located in the upstream region of the Tizinafu River Basin in the Kunlun Mountains. When terrain shading 

TA B L E   4  Error assessment of Hillshade and SA

Surface

ME (%)

MAE (%)

ME (%)

MAE (%)

Model

Statistic

Spring equinox

Autumnal equinox

Average

G1

G2

G3

G4

G1

G2

G3

G4

 

Hillshade

0.17

0.10

0.07

0.07

0.70

0.57

0.50

0.39

0.32

0.83

0.86

0.76

1.10

1.65

1.54

1.28

1.58

1.20

SA

0.04

0.64

0.20

0.03

0.44

0.94

0.48

0.21

0.37

1.81

1.79

1.20

1.12

2.22

2.15

1.48

1.46

1.66

ZHANG et Al.    |  15

F I G U R E   8  Error assessment of the two shading algorithms over the four surfaces at (a–d) the spring and 
(e–h) autumnal equinox: (a) spring equinox over G1; (b) spring equinox over G2; (c) spring equinox over G3; (d) 
spring equinox over G4; (e) autumnal equinox over G1; (f) autumnal equinox over G2; (g) autumnal equinox over 
G3; and (h) autumnal equinox over G4

ZHANG et Al.TA B L E   5  Error assessment of Hillshade and SA over surfaces with random error

16  |    

Model

Statistic

Spring equinox

Autumnal equinox

Average

Surfaces

ME (%)

MAE (%)

ME (%)

MAE (%)

Hillshade

0.34

0.13

0.07

0.35

0.86

0.59

0.48

0.64

0.43

1.14

1.08

1.11

1.42

1.90

1.62

1.54

1.74

1.44

SA

0.22

0.66

0.20

0.33

0.60

0.96

0.46

0.47

0.49

1.96

1.89

1.48

1.45

2.36

2.20

1.75

1.67

1.84

NG1

NG2

NG3

NG4

NG1

NG2

NG3

NG4

 

F I G U R E   9  Comparison of the two terrain shading algorithms using a real digital elevation model (DEM): (a) 
the DEM for the study area; (b) the difference between the results of SA and Hillshade using a real DEM, in 
which SA > Hillshade represents the cells shaded based on SA but not on Hillshade, Hillshade > SA represents 
cells shows shaded based on Hillshade but not on SA, and SA = Hillshade represents the same shading effect 
from both SA and Hillshade; (c) terrain shading map based on SA; and (d) terrain shading map based on Hillshade

occurs, direct radiation is blocked by the terrain; it is only diffuse radiation that is very low compared with direct 
radiation. Therefore, we selected the times when solar radiation was very low (less than 100 W/m2) and the sky 
was clear to represent the times at which the terrain shading effect occurred. The threshold value of 100 W/m2 for 

radiation was determined by manually examining the daily solar radiation curve because solar radiation changes 

abruptly  on  clear  sky  days  when  terrain  shading  occurs.  Clear  sky  conditions  were  determined  by  Moderate 

ZHANG et Al.    |  17

Resolution Imaging Spectroradiometer (MODIS) cloud observations as moments when the cloud fraction was less 

than 10%. Finally, we selected 49 observations when the terrain shading effect occurred because we could only 

detect the shading effect based on the time at which the MODIS Terra satellite passed over the study area, and we 

only had 2 years' observations over the station. The error in Hillshade was 35%, and that in SA was much larger at 

98%. One possible reason for the latter is the low resolution of the DEM and the small number of samples used. 

Figures 9c and d shows the similar spatial terrain shading pattern for Hillshade and SA. We calculated the differ‐

ence between SA and Hillshade in Figure 9b, which shows that SA introduces more shading areas than Hillshade; 

this is consistent with the evaluation using artificial surfaces.

5.3 | The new terrain shading effect algorithm

The  sensitivity  analysis  and  evaluations  of  the  two  terrain  shading  algorithms  showed  that  the  mean  latitude 

over the surface used to determine terrain shading is the source of error in Hillshade; however, the horizon angle 

projected into the hemispherical Skyshed map is the main source error in SA. Therefore, to overcome the short‐

comings of both Hillshade and SA for terrain shading modeling over complex terrain, we propose that the solar 

positions for each cell should be calculated using its own latitude and the horizon angle in the solar directions 

should  be  calculated  for  every  specific  time  without  projections.  A  new  terrain  shading  algorithm  is  proposed 

based on these rules. First, solar altitude and azimuth angle are calculated, based on the local latitude for every 

cell over the surface, as:

SAi,j,t = a sin ( sin 𝛿t sin 𝜙i,j + cos 𝛿t cos 𝜙i,j cos 𝜔i,j,t)

SAAi,j,t = a cos (( sin SAi,j,t sin 𝜙i,j − sin 𝛿t)∕ cos SAi,j,t cos 𝜙i,j)

where SAi,j,t and SAAi,j,t are solar altitude angle and solar azimuth angle over cell (i, j) at time t, respectively; 𝛿t is 
declination at time t; 𝜙i,j is the geographic latitude of cell (i, j); and 𝜔i,j,t is the solar hour angle for cell (i, j) at time t.
Then  the  elevation  profile  along  the  solar  azimuth  direction  for  the  cell  (i,  j)  is  extracted  over  the  surface 

(Figure 10a). Lastly, the horizon angles along the elevation profile (Figure 10b) are calculated as follows:

(15)

(16)

(17)

HAi,j,k = a tan

Ak − A0

sk )

(

where Ak is the elevation of the kth point in the profile; A0 is the elevation of the target cell; and sk is the horizontal 
distance between the kth point and target point. The maximum horizon angle in the solar azimuth direction is used 

for comparison with the solar altitude angle to determine the terrain shading effect.

We calculated the shading effect over surfaces G1, …, G4 at the spring and autumnal equinox using the new 

model. The MAE of the new model is 0.55%, which is lower than that of both Hillshade and SA. We also compared 

the spatial terrain shading effect over surface G2 using Hillshade, SA, and the new method (Figure 11). Figure 11 

shows the difference between the theoretical terrain shading effect and the shading effect calculated using the 

three models. The incorrect terrain shading area is mainly over the shading boundary; the largest incorrect area 

occurred in SA, while the smallest was in the new model. The three models were also compared over a real DEM 

(Figure 9a). Since we cannot obtain the true spatial terrain shading effect over the real DEM, we instead compared 

the  visual  spatial  terrain  shading  for  the  three  models  (Figures  12a–c).  Although  the  terrain  shading  effect  for 

the three models shows slight spatial differences, mostly at the shading boundary (Figures 12d–e), they still have 

remarkably similar spatial patterns for the three models, which indicates that the new algorithm is effective on 

the real DEM. Therefore, the shading effect calculated using local latitude and geometry without projecting the 

horizon angle is better than the conventional methods, and can be achieved given current rapid developments in 

computation.

ZHANG et Al.18  |    

F I G U R E   1 0  Processes used in the new terrain shading algorithm: (a) elevation profile in the solar direction; 
and (b) horizon angle calculated based on the elevation profile in the solar direction

F I G U R E   1 1  Difference between theoretical terrain shading effect and shading effect determined using: (a) 
Hillshade; (b) SA; and (c) the new model

5.4 | The sensitivity of solar radiation to uncertainties in terrain shading

Estimates of solar radiation are significantly influenced by the accuracy of the terrain shading effect. The amount 

of direct radiation is 0 when a solar beam is shadowed, and diffuse radiation can only come from the visible sky. 

ZHANG et Al.    |  19

F I G U R E   1 2  Comparison of spatial terrain shading effect for the three models on a real DEM: (a) shading 
effect from Hillshade; (b) shading effect from the new model; (c) shading effect from SA; (d) spatial terrain 
shading difference between the new model and Hillshade (Hillshade minus the new model); and (e) spatial terrain 
shading difference between the new model and SA (SA minus the new model)

Therefore,  we  calculated  the  errors  in  direct  radiation  and  sky  view  factor  for  diffuse  radiation  caused  by  the 

uncertainty of the terrain shading effect.

5.4.1 | Direct solar radiation

We compared the direct radiation calculated with shading effect modeled by Hillshade and SA, and with theo‐

retical shading effect, respectively. We used the same atmospheric processes for the models and the theoretical 

values, therefore the errors of direct radiation estimates are from shading effect algorithm errors. The summed 

absolute deviation (SAD) was calculated over the surfaces G1, …, G4 at the spring and autumnal equinox and is 

shown in Figure 13. The SAD is relatively higher for the more complex terrain of G1 and G2 than for G3 and G4. 

SA shows very large error (near 250 kW) over G1 at around 10 a.m. In addition, the shading effect error shows 

more significant influence on direct radiation in the morning and afternoon (around 10 a.m. and 3 p.m.) for SA and 

Hillshade, as shown in Figure 8. SA also has larger error than Hillshade, which is consistent with the shading effect 

error in Figure 8.

5.4.2 | Sky view factor for diffuse radiation

The sky view factor is a key parameter to calculate diffuse radiation over complex terrain. It can be used to deter‐

mine the amount of solar beam radiation received at the station. We calculated the theoretical sky view factor, 

defined by Dozier and Frew (1990) as two integrations in zenith and azimuth angle directions. Li et al. (2016) indi‐

cated that the sky view factor is sensitive to divisions in zenith directions. For theoretical sky view factor, firstly, 

the  integration  under  zenith  angles  are  calculated  theoretically,  then  these  theoretical  values  are  added  with 

azimuth angle step of 0.01 radians. We compared the theoretical sky view factor with that in SA under different 

numbers of zenith divisions (8, 16, 32 and 64). We calculated the sky view factor for points on two lines over each 

surface. The mean absolute relative difference (MARD) and mean relative difference (MRD) were calculated over 

ZHANG et Al.20  |    

F I G U R E   1 3  Error of direct radiation caused by uncertainty of terrain shading algorithms over the four 
surfaces at (a–d) the spring and (e–h) the autumnal equinox: (a) spring equinox over G1; (b) spring equinox over 
G2; (c) spring equinox over G3; (d) spring equinox over G4; (e) autumnal equinox over G1; (f) autumnal equinox 
over G2; (g) autumnal equinox over G3; and (h) autumnal equinox over G4

ZHANG et Al.TA B L E   6  Error of sky view factor with different numbers of zenith divisions

 

MARD (%)

Divisions

MRD (%)

G1

G2

G3

G4

G1

G2

G3

G4

8

1.31

1.33

1.08

0.61

−1.18

−1.33

−1.08

−0.61

16

1.08

0.96

0.79

0.32

−0.74

−0.96

−0.79

−0.32

32

1.08

0.96

0.79

0.32

−0.74

−0.96

−0.79

−0.32

    |  21

64

1.08

0.96

0.79

0.32

−0.74

−0.96

−0.79

−0.32

four surfaces (Table 6). The results show that the sky view factor in SA is underestimated on all surfaces with a 

MARD of 1.08% with 8 zenith divisions. The underestimation of the sky view factor in SA shows consistency with 

Li et al. (2016). However, the error of the sky view factor over Gauss surfaces is greater than error in V‐shaped 

surfaces based on Li et al. (2016), which indicates that sky view factors in complex terrain have relatively greater 

error. Comparing MARDs of the sky view factor with different numbers of zenith divisions, we observe that the 

MARD shows relatively greater error when the number of zenith divisions is 8. For 16 or more zenith divisions, 

errors are smaller than for 8. Although 8 zenith divisions is the default value for SA, we suggest selecting 16 as the 

default to calculate diffuse radiation in SA, based on Table 6.

6 |  CO N C LU S I O N S

Solar radiation over complex terrain shows vast heterogeneity due to the terrain shading effect from itself and the 

surrounding terrain. GIS‐based terrain shading algorithms can be classified as area‐based (Hillshade) or point‐spe‐

cific (SA). In this research, we evaluated the terrain shading algorithms using a data‐independent method that can 

prevent errors from data. The data‐independent method can be used to evaluate errors of the model or algorithms 

by comparing the theoretical value of parameters on designed artificial surfaces with model results.

We designed four Gauss synthetic surfaces with different terrain complexities. The theoretical shading effects 

on  these  surfaces  were  calculated  and  used  to  evaluate  Hillshade  and  SA.  Both  terrain  shading  algorithms  are 

sensitive to the DEM resolution and exhibit greater error with coarser resolution, especially for more complex 

terrain. The MAE of Hillshade shows an exponential increase with increase in the spatial extent of the study area 

because the solar position for all locations on the surface is the same. Therefore, we suggest that the surface 

should be divided into more tiles using Hillshade to calculate the shading effect when the latitude discrepancy of 

the entire surface is greater than 4°. Skyshed in SA is error‐prone over more complex terrain and is more accurate 

with larger sky size.

We assessed Hillshade and SA by comparing the theoretical shading effect over four surfaces. Hillshade and 

SA overestimated the shading effect and Hillshade showed greater accuracy, with an MAE of 1.20%, than SA, at 

1.66%. The direct radiation modeled by Hillshade and SA was evaluated using model results based on the the‐

oretical terrain shading effect, and the shading effect error has a more significant influence on direct radiation 

estimation in the morning and afternoon over relatively complex terrain. We also evaluated the sky view factor 

based on Skyshed in SA, which is crucial for diffuse radiation. The sky view factor in SA is underestimated on all 

surfaces with MARD 1.08% for 8 zenith divisions. We observed that the error decreases with increasing number 

of zenith divisions. Although 8 zenith divisions is the default value for SA, we suggest selecting 16 zenith divisions 

as the default to calculate diffuse radiation in SA.

ZHANG et Al.22  |    

We  also  proposed  to  calculate  the  terrain  shading  effect  using  local  latitude  and  local  geometry  for  every 

cell on the surface; the MAE of our new model is 0.55%, which is smaller than that of Hillshade and SA. Finally, 

although Skyshed in SA is problematic because of its hemispherical projection, it is a better way to consider aniso‐

tropic diffuse radiation over a hemispherical sky.

AC K N OW L E D G M E N T S

This work is supported by the National Natural Science Foundation of China, Grant/Award No. 41701442 and 

China Postdoctoral Science Foundation (2018M632281).

O R C I D

Shuhua Zhang 

 https://orcid.org/0000‐0001‐8635‐9214 

Xingong Li 

 https://orcid.org/0000‐0003‐1636‐2922 

Jiangfeng She 

 https://orcid.org/0000‐0001‐8536‐8645 

R E F E R E N C E S

Aguilar, C., Herrero, J., & Polo, M. J. (2010). Topographic effects on solar radiation distribution in mountainous water‐
sheds and their influence on reference evapotranspiration estimates at watershed scale. Hydrology & Earth System 
Sciences, 14, 2479–2494.

Allen, R. G., Trezza, R., & Tasumi, M. (2006). Analytical integrated functions for daily solar radiation on slopes. Agricultural 

& Forest Meteorology, 139(1–2), 55–73.

Corripio, J. G. (2003). Vectorial algebra algorithms for calculating terrain parameters from DEMs and solar radiation mod‐

elling in mountainous terrain. International Journal of Geographical Information Science, 17(1), 1–23.

Dozier, J., Bruno, J., & Downey, P. (1981). A faster solution to the horizon problem. Computers & Geosciences, 7, 145–151.
Dozier, J., & Frew, J. (1990). Rapid calculation of terrain parameters for radiation modeling from digital elevation data. 

IEEE Transactions on Geoscience & Remote Sensing, 28(5), 963–969.

Dubayah,  R.,  &  Rich,  P.  M.  (1995).  Topographic  solar‐radiation  models  for  GIS.  International  Journal  of  Geographical 

Freeman, T. G. (1991). Calculating catchment area with divergent flow based on a regular grid. Computers & Geosciences, 

Information Systems, 9(4), 405–419.

17(3), 413–422.

Fu, P., & Rich, P. M. (1999). Design and implementation of the Solar Analyst: An ArcView extension for modeling solar radiation 
at  landscape  scales.  Retrieved  from  http://proce edings.esri.com/libra ry/userc onf/proc9 9/proce ed/paper s/pap86 7/
p867.htm

Funk, M., & Hoelzle, M. (1992). A model of potential direct solar radiation for investigating occurrences of mountain per‐

mafrost. Permafrost & Periglacial Processes, 3(2), 139–142.

Hanson, A. J., Deline, C. A., MacAlpine, S. M., Stauth, J. T., & Sullivan, C. R. (2014). Partial‐shading assessment of photo‐

voltaic installations via module‐level monitoring. IEEE Journal of Photovoltaics, 4(6), 1618–1624.

Iqbal, M. (1983). An introduction to solar radiation. Toronto, ON: Academic Press.
Jones, K. (1998). A comparison of algorithms used to compute hill slope as a property of the DEM. Computers & Geosciences, 

24, 315–323.

Kanafi, M. M. (2016). Surface generator: Artificial randomly rough surfaces. Retrieved from https ://ww2.mathw orks.cn/

matla bcent ral/filee xchan ge/60817‐surfa ce‐gener ator‐artif icial‐rando mly‐rough surfaces.

Kumar, L., Skidmore, A., & Knowles, E. (1997). Modelling topographic variation in solar radiation in a GIS environment. 

International Journal of Geographical Information Science, 11(5), 475–497.

Li,  X.,  Cheng,  G.,  Chen,  X.,  &  Lu,  L.  (1999).  Modification  of  solar  radiation  model  over  rugged  terrain.  Chinese Science 

Bulletin, 44(15), 1345–1350.

Processes, 22(19), 3931–3940.

Li, X., & Williams, M. W. (2008). Snowmelt runoff modelling in an arid mountain watershed, Tarim Basin, China. Hydrological 

Li, X., Zhang, S., & Chen, Y. (2016). Error assessment of grid‐based diffuse solar radiation models. International Journal of 

Geographical Information Science, 30(10), 2032–2049.

ZHANG et Al.    |  23

Liu, M., Bardossy, A., Li, J., & Jiang, Y. (2012). GIS‐based modelling of topography induced solar radiation variability in 
complex terrain for data sparse region. International Journal of Geographical Information Science, 26(7), 1281–1308.
Marsh, C. B., Pomeroy, J., & Spiteri, R. J. (2012). Implications of mountain shading on calculating energy for snowmelt 

using unstructured triangular meshes. Hydrological Processes, 26, 1767–1778.

Qin, C.‐Z., Bao, L. L., Zhu, A.‐X., Hu, X. M., & Qin, B. (2013). Artificial surfaces simulating complex terrain types for evalu‐
ating grid‐based flow direction algorithms. International Journal of Geographical Information Science, 27(6), 1055–1072.
Wu, S. B., Wen, J. G., You, D. Q., Zhang, H. L., Xiao, Q., & Liu, Q. H. (2018). Algorithms for calculating topographic param‐
eters and their uncertainties in downward surface solar radiation (DSSR) estimation. IEEE Geoscience Remote Sensing 
Letters, 15(8), 1149–1153.

Zhang, S., Li, X., & Chen, Y. (2015). Error assessment of grid‐based direct solar radiation models. International Journal of 

Geographical Information Science, 30(10), 2032–2049.

Zhang, Y. L., Chang, X. L., & Liang, J. (2017). Comparison of different algorithms for calculating the shading effects of 

topography on solar irradiance in a mountainous area. Environment Earth Science, 76, 295.

Zhou,  Q.  M.,  Liu,  X.  J.,  &  Sun,  Y.  Z.  (2006).  Terrain  complexity  and  uncertainties  in  grid‐based  digital  terrain  analysis. 

International Journal of Geographical Information Science, 20(10), 1137–1147.

How to cite this article: Zhang S, Li X, She J. Error assessment of grid‐based terrain shading algorithms for 

solar radiation modeling over complex terrain. Transactions in GIS. 2019;00:1–23. https ://doi.org/10.1111/

tgis.12594 

ZHANG et Al.